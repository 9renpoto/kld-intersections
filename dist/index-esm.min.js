function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function n(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}function i(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],i=!0,r=!1,s=void 0;try{for(var a,o=t[Symbol.iterator]();!(i=(a=o.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,s=t}finally{try{i||null==o.return||o.return()}finally{if(r)throw s}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var r=function(){function e(n,i){t(this,e),this.x=void 0!==n?n:0,this.y=void 0!==i?i:0}return n(e,[{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"add",value:function(t){return new this.constructor(this.x+t.x,this.y+t.y)}},{key:"subtract",value:function(t){return new this.constructor(this.x-t.x,this.y-t.y)}},{key:"multiply",value:function(t){return new this.constructor(this.x*t,this.y*t)}},{key:"divide",value:function(t){return new this.constructor(this.x/t,this.y/t)}},{key:"equals",value:function(t){return this.x===t.x&&this.y===t.y}},{key:"precisionEquals",value:function(t,e){return Math.abs(this.x-t.x)<e&&Math.abs(this.y-t.y)<e}},{key:"lerp",value:function(t,e){var n=1-e;return new this.constructor(this.x*n+t.x*e,this.y*n+t.y*e)}},{key:"distanceFrom",value:function(t){var e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)}},{key:"min",value:function(t){return new this.constructor(Math.min(this.x,t.x),Math.min(this.y,t.y))}},{key:"max",value:function(t){return new this.constructor(Math.max(this.x,t.x),Math.max(this.y,t.y))}},{key:"transform",value:function(t){return new this.constructor(t.a*this.x+t.c*this.y+t.e,t.b*this.x+t.d*this.y+t.f)}},{key:"toString",value:function(){return"point("+this.x+","+this.y+")"}}]),e}(),s=function(){function e(n,i){t(this,e),this.x=void 0!==n?n:0,this.y=void 0!==i?i:0}return n(e,[{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"magnitude",value:function(){return this.x*this.x+this.y*this.y}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"cross",value:function(t){return this.x*t.y-this.y*t.x}},{key:"determinant",value:function(t){return this.x*t.y-this.y*t.x}},{key:"unit",value:function(){return this.divide(this.length())}},{key:"add",value:function(t){return new this.constructor(this.x+t.x,this.y+t.y)}},{key:"subtract",value:function(t){return new this.constructor(this.x-t.x,this.y-t.y)}},{key:"multiply",value:function(t){return new this.constructor(this.x*t,this.y*t)}},{key:"divide",value:function(t){return new this.constructor(this.x/t,this.y/t)}},{key:"angleBetween",value:function(t){var e=this.dot(t)/(this.length()*t.length());e=Math.max(-1,Math.min(e,1));var n=Math.acos(e);return this.cross(t)<0?-n:n}},{key:"perp",value:function(){return new this.constructor(-this.y,this.x)}},{key:"perpendicular",value:function(t){return this.subtract(this.project(t))}},{key:"project",value:function(t){var e=this.dot(t)/t.dot(t);return t.multiply(e)}},{key:"transform",value:function(t){return new this.constructor(t.a*this.x+t.c*this.y,t.b*this.x+t.d*this.y)}},{key:"equals",value:function(t){return this.x===t.x&&this.y===t.y}},{key:"precisionEquals",value:function(t,e){return Math.abs(this.x-t.x)<e&&Math.abs(this.y-t.y)<e}},{key:"toString",value:function(){return"vector("+this.x+","+this.y+")"}}],[{key:"fromPoints",value:function(t,n){return new e(n.x-t.x,n.y-t.y)}}]),e}(),a=function(){function e(n,i,r,s,a,o){t(this,e),this.a=void 0!==n?n:1,this.b=void 0!==i?i:0,this.c=void 0!==r?r:0,this.d=void 0!==s?s:1,this.e=void 0!==a?a:0,this.f=void 0!==o?o:0}return n(e,[{key:"multiply",value:function(t){return this.isIdentity()?t:t.isIdentity()?this:new this.constructor(this.a*t.a+this.c*t.b,this.b*t.a+this.d*t.b,this.a*t.c+this.c*t.d,this.b*t.c+this.d*t.d,this.a*t.e+this.c*t.f+this.e,this.b*t.e+this.d*t.f+this.f)}},{key:"inverse",value:function(){if(this.isIdentity())return this;var t=this.a*this.d-this.b*this.c;if(0===t)throw new Error("Matrix is not invertible");var e=1/t,n=this.f*this.c-this.e*this.d,i=this.e*this.b-this.f*this.a;return new this.constructor(this.d*e,-this.b*e,-this.c*e,this.a*e,n*e,i*e)}},{key:"translate",value:function(t,e){return new this.constructor(this.a,this.b,this.c,this.d,this.a*t+this.c*e+this.e,this.b*t+this.d*e+this.f)}},{key:"scale",value:function(t){return new this.constructor(this.a*t,this.b*t,this.c*t,this.d*t,this.e,this.f)}},{key:"scaleAt",value:function(t,e){var n=e.x-t*e.x,i=e.y-t*e.y;return new this.constructor(this.a*t,this.b*t,this.c*t,this.d*t,this.a*n+this.c*i+this.e,this.b*n+this.d*i+this.f)}},{key:"scaleNonUniform",value:function(t,e){return new this.constructor(this.a*t,this.b*t,this.c*e,this.d*e,this.e,this.f)}},{key:"scaleNonUniformAt",value:function(t,e,n){var i=n.x-t*n.x,r=n.y-e*n.y;return new this.constructor(this.a*t,this.b*t,this.c*e,this.d*e,this.a*i+this.c*r+this.e,this.b*i+this.d*r+this.f)}},{key:"rotate",value:function(t){var e=Math.cos(t),n=Math.sin(t);return new this.constructor(this.a*e+this.c*n,this.b*e+this.d*n,this.a*-n+this.c*e,this.b*-n+this.d*e,this.e,this.f)}},{key:"rotateAt",value:function(t,e){var n=Math.cos(t),i=Math.sin(t),r=e.x,s=e.y,a=this.a*n+this.c*i,o=this.b*n+this.d*i,u=this.c*n-this.a*i,y=this.d*n-this.b*i;return new this.constructor(a,o,u,y,(this.a-a)*r+(this.c-u)*s+this.e,(this.b-o)*r+(this.d-y)*s+this.f)}},{key:"rotateFromVector",value:function(t){var e=t.unit(),n=e.x,i=e.y;return new this.constructor(this.a*n+this.c*i,this.b*n+this.d*i,this.a*-i+this.c*n,this.b*-i+this.d*n,this.e,this.f)}},{key:"flipX",value:function(){return new this.constructor(-this.a,-this.b,this.c,this.d,this.e,this.f)}},{key:"flipY",value:function(){return new this.constructor(this.a,this.b,-this.c,-this.d,this.e,this.f)}},{key:"skewX",value:function(t){var e=Math.tan(t);return new this.constructor(this.a,this.b,this.c+this.a*e,this.d+this.b*e,this.e,this.f)}},{key:"skewY",value:function(t){var e=Math.tan(t);return new this.constructor(this.a+this.c*e,this.b+this.d*e,this.c,this.d,this.e,this.f)}},{key:"isIdentity",value:function(){return 1===this.a&&0===this.b&&0===this.c&&1===this.d&&0===this.e&&0===this.f}},{key:"isInvertible",value:function(){return this.a*this.d-this.b*this.c!=0}},{key:"getScale",value:function(){return{scaleX:Math.sqrt(this.a*this.a+this.c*this.c),scaleY:Math.sqrt(this.b*this.b+this.d*this.d)}}},{key:"getDecomposition",value:function(){var t=.5*(this.a+this.d),e=.5*(this.a-this.d),n=.5*(this.b+this.c),i=.5*(this.b-this.c),r=Math.sqrt(t*t+i*i),s=Math.sqrt(e*e+n*n),a=r+s,o=r-s,u=Math.atan2(n,e),y=Math.atan2(i,t),l=.5*(y-u),c=.5*(y+u);return{translation:this.constructor.translation(this.e,this.f),rotation:this.constructor.rotation(c),scale:this.constructor.nonUniformScaling(a,o),rotation0:this.constructor.rotation(l)}}},{key:"equals",value:function(t){return this.a===t.a&&this.b===t.b&&this.c===t.c&&this.d===t.d&&this.e===t.e&&this.f===t.f}},{key:"precisionEquals",value:function(t,e){return Math.abs(this.a-t.a)<e&&Math.abs(this.b-t.b)<e&&Math.abs(this.c-t.c)<e&&Math.abs(this.d-t.d)<e&&Math.abs(this.e-t.e)<e&&Math.abs(this.f-t.f)<e}},{key:"toString",value:function(){return"matrix("+[this.a,this.b,this.c,this.d,this.e,this.f].join(",")+")"}}],[{key:"translation",value:function(t,n){return new e(1,0,0,1,t,n)}},{key:"scaling",value:function(t){return new e(t,0,0,t,0,0)}},{key:"scalingAt",value:function(t,n){return new e(t,0,0,t,n.x-n.x*t,n.y-n.y*t)}},{key:"nonUniformScaling",value:function(t,n){return new e(t,0,0,n,0,0)}},{key:"nonUniformScalingAt",value:function(t,n,i){return new e(t,0,0,n,i.x-i.x*t,i.y-i.y*n)}},{key:"rotation",value:function(t){var n=Math.cos(t),i=Math.sin(t);return new e(n,i,-i,n,0,0)}},{key:"rotationAt",value:function(t,n){var i=Math.cos(t),r=Math.sin(t);return new e(i,r,-r,i,n.x-n.x*i+n.y*r,n.y-n.y*i-n.x*r)}},{key:"rotationFromVector",value:function(t){var n=t.unit(),i=n.x,r=n.y;return new e(i,r,-r,i,0,0)}},{key:"xFlip",value:function(){return new e(-1,0,0,1,0,0)}},{key:"yFlip",value:function(){return new e(1,0,0,-1,0,0)}},{key:"xSkew",value:function(t){return new e(1,0,Math.tan(t),1,0,0)}},{key:"ySkew",value:function(t){return new e(1,Math.tan(t),0,1,0,0)}}]),e}();function o(t){return"number"==typeof t?t?t<0?-1:1:t==t?t:NaN:NaN}a.IDENTITY=new a,a.IDENTITY.isIdentity=function(){return!0};var u=function(){function e(){t(this,e),this.coefs=[];for(var n=arguments.length-1;n>=0;n--)this.coefs.push(n<0||arguments.length<=n?void 0:arguments[n]);this._variable="t",this._s=0}return n(e,[{key:"clone",value:function(){var t=new e;return t.coefs=this.coefs.slice(),t}},{key:"eval",value:function(t){if(isNaN(t))throw new Error("Polynomial.eval: parameter must be a number, got '".concat(t,"'"));for(var e=0,n=this.coefs.length-1;n>=0;n--)e=e*t+this.coefs[n];return e}},{key:"add",value:function(t){for(var n=new e,i=this.getDegree(),r=t.getDegree(),s=Math.max(i,r),a=0;a<=s;a++){var o=a<=i?this.coefs[a]:0,u=a<=r?t.coefs[a]:0;n.coefs[a]=o+u}return n}},{key:"multiply",value:function(t){for(var n=new e,i=0;i<=this.getDegree()+t.getDegree();i++)n.coefs.push(0);for(var r=0;r<=this.getDegree();r++)for(var s=0;s<=t.getDegree();s++)n.coefs[r+s]+=this.coefs[r]*t.coefs[s];return n}},{key:"divide_scalar",value:function(t){for(var e=0;e<this.coefs.length;e++)this.coefs[e]/=t}},{key:"simplify",value:function(t){void 0===t&&(t=1e-12);for(var e=this.getDegree();e>=0&&Math.abs(this.coefs[e])<=t;e--)this.coefs.pop()}},{key:"bisection",value:function(t,n){var i,r=this.eval(t),s=this.eval(n);if(Math.abs(r)<=e.TOLERANCE)i=t;else if(Math.abs(s)<=e.TOLERANCE)i=n;else if(r*s<=0)for(var a=Math.log(n-t),o=Math.LN10*e.ACCURACY,u=Math.ceil((a+o)/Math.LN2),y=0;y<u;y++){i=.5*(t+n);var l=this.eval(i);if(Math.abs(l)<=e.TOLERANCE)break;l*r<0?(n=i,s=l):(t=i,r=l)}return i}},{key:"toString",value:function(){for(var t=[],e=[],n=this.coefs.length-1;n>=0;n--){var i=Math.round(1e3*this.coefs[n])/1e3;if(0!==i){var r=i<0?" - ":" + ";i=Math.abs(i),n>0&&(1===i?i=this._variable:i+=this._variable),n>1&&(i+="^"+n),e.push(r),t.push(i)}}e[0]=" + "===e[0]?"":"-";for(var s="",a=0;a<t.length;a++)s+=e[a]+t[a];return s}},{key:"trapezoid",value:function(t,e,n){if(isNaN(t)||isNaN(e)||isNaN(n))throw new Error("Polynomial.trapezoid: parameters must be numbers");var i=e-t;if(1===n){var r=this.eval(t),s=this.eval(e);this._s=.5*i*(r+s)}else{for(var a=1<<n-2,o=i/a,u=t+.5*o,y=0,l=0;l<a;l++)y+=this.eval(u),u+=o;this._s=.5*(this._s+i*y/a)}if(isNaN(this._s))throw new Error("Polynomial.trapezoid: this._s is NaN");return this._s}},{key:"simpson",value:function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Polynomial.simpson: parameters must be numbers");for(var n=e-t,i=.5*n*(this.eval(t)+this.eval(e)),r=i,s=4*i/3,a=s,o=i,u=1,y=2;y<=20;y++){for(var l=n/u,c=t+.5*l,h=0,x=1;x<=u;x++)h+=this.eval(c),c+=l;if(s=(4*(i=r=.5*(r+n*h/u))-o)/3,Math.abs(s-a)<1e-7*Math.abs(a))break;a=s,o=i,u<<=1}return s}},{key:"romberg",value:function(t,n){if(isNaN(t)||isNaN(n))throw new Error("Polynomial.romberg: parameters must be numbers");var i=new Array(21),r=new Array(21),s={y:0,dy:0};r[0]=1;for(var a=1;a<=20&&(i[a-1]=this.trapezoid(t,n,a),!(a>=3&&(s=e.interpolate(r,i,3,a-3,0),Math.abs(s.dy)<=1e-6*s.y)));a++)i[a]=i[a-1],r[a]=.25*r[a-1];return s.y}},{key:"getDegree",value:function(){return this.coefs.length-1}},{key:"getDerivative",value:function(){for(var t=new e,n=1;n<this.coefs.length;n++)t.coefs.push(n*this.coefs[n]);return t}},{key:"getRoots",value:function(){var t;switch(this.simplify(),this.getDegree()){case 0:t=[];break;case 1:t=this.getLinearRoot();break;case 2:t=this.getQuadraticRoots();break;case 3:t=this.getCubicRoots();break;case 4:t=this.getQuarticRoots();break;default:t=[]}return t}},{key:"getRootsInInterval",value:function(t,e){var n=[];function i(t){"number"==typeof t&&n.push(t)}if(0===this.getDegree())throw new Error("Polynomial.getRootsInInterval: Unexpected empty polynomial");if(1===this.getDegree())i(this.bisection(t,e));else{var r=this.getDerivative().getRootsInInterval(t,e);if(r.length>0){i(this.bisection(t,r[0]));for(var s=0;s<=r.length-2;s++)i(this.bisection(r[s],r[s+1]));i(this.bisection(r[r.length-1],e))}else i(this.bisection(t,e))}return n}},{key:"getLinearRoot",value:function(){var t=[],e=this.coefs[1];return 0!==e&&t.push(-this.coefs[0]/e),t}},{key:"getQuadraticRoots",value:function(){var t=[];if(2===this.getDegree()){var e=this.coefs[2],n=this.coefs[1]/e,i=n*n-4*(this.coefs[0]/e);if(i>0){var r=Math.sqrt(i);t.push(.5*(-n+r)),t.push(.5*(-n-r))}else 0===i&&t.push(.5*-n)}return t}},{key:"getCubicRoots",value:function(){var t=[];if(3===this.getDegree()){var e=this.coefs[3],n=this.coefs[2]/e,i=this.coefs[1]/e,r=(3*i-n*n)/3,s=(2*n*n*n-9*i*n+27*(this.coefs[0]/e))/27,a=n/3,o=s*s/4+r*r*r/27,u=s/2,y=this.zeroErrorEstimate();if(Math.abs(o)<=y&&(o=0),o>0){var l,c=Math.sqrt(o),h=-u+c;l=h>=0?Math.pow(h,1/3):-Math.pow(-h,1/3),(h=-u-c)>=0?l+=Math.pow(h,1/3):l-=Math.pow(-h,1/3),t.push(l-a)}else if(o<0){var x=Math.sqrt(-r/3),f=Math.atan2(Math.sqrt(-o),-u)/3,v=Math.cos(f),p=Math.sin(f),d=Math.sqrt(3);t.push(2*x*v-a),t.push(-x*(v+d*p)-a),t.push(-x*(v-d*p)-a)}else{var w;w=u>=0?-Math.pow(u,1/3):Math.pow(-u,1/3),t.push(2*w-a),t.push(-w-a)}}return t}},{key:"getQuarticRoots",value:function(){var t=[],n=this.getDegree();if(4===n){var i=new e;i.coefs=this.coefs.slice(),i.divide_scalar(i.coefs[n]);Math.abs(i.coefs[0])<10*1e-15*Math.abs(i.coefs[3])&&(i.coefs[0]=0);for(var r=i.getDerivative(),s=r.getRoots().sort(function(t,e){return t-e}),a=[],u=s.length-1,y=this.bounds(),l=Math.max(Math.abs(y.minX),Math.abs(y.maxX)),c=this.zeroErrorEstimate(l),h=0;h<=u;h++)a.push(i.eval(s[h]));for(var x=0;x<=u;x++)Math.abs(a[x])<c&&(a[x]=0);var f=0,v=Math.max(.1*(y.maxX-y.minX)/n,1e-15),p=[],d=[];if(u>-1){for(0!==a[0]?o(a[0])!==o(i.eval(s[0]-v)-a[0])&&(p.push(s[0]-v),d.push([y.minX,s[0]])):(t.push(s[0],s[0]),f++);f<u;f++)0===a[f+1]?(t.push(s[f+1],s[f+1]),f++):o(a[f])!==o(a[f+1])&&(p.push((s[f]+s[f+1])/2),d.push([s[f],s[f+1]]));0!==a[u]&&o(a[u])!==o(i.eval(s[u]+v)-a[u])&&(p.push(s[u]+v),d.push([s[u],y.maxX]))}var w=function(t){return i.eval(t)},m=function(t){return r.eval(t)};if(p.length>0)for(f=0;f<p.length;f++)p[f]=e.newton_secant_bisection(p[f],w,m,32,d[f][0],d[f][1]);t=t.concat(p)}return t}},{key:"zeroErrorEstimate",value:function(t){if(void 0===t){var e=this.bounds();t=Math.max(Math.abs(e.minX),Math.abs(e.maxX))}if(t<.001)return 2*Math.abs(this.eval(1e-15));var n=this.coefs.length-1,i=this.coefs[n];return 10*1e-15*this.coefs.reduce(function(e,n,r){var s=n/i*Math.pow(t,r);return s>e?s:e},0)}},{key:"bounds_UpperReal_Fujiwara",value:function(){var t=this.coefs,e=t.length-1,n=t[e];1!==n&&(t=this.coefs.map(function(t){return t/n}));var i,r=t.map(function(t,n){return n<e?Math.pow(Math.abs(0===n?t/2:t),1/(e-n)):t}),s=function(t,e,n){return i(n)&&(t.max<e?(t.nearmax=t.max,t.max=e):t.nearmax<e&&(t.nearmax=e)),t};i=function(n){return n<e&&t[n]<0};var a=r.reduce(s,{max:0,nearmax:0});return i=function(n){return n<e&&(e%2==n%2?t[n]<0:t[n]>0)},{negX:-2*r.reduce(s,{max:0,nearmax:0}).max,posX:2*a.max}}},{key:"bounds_LowerReal_Fujiwara",value:function(){var t=new e;t.coefs=this.coefs.slice().reverse();var n=t.bounds_UpperReal_Fujiwara();return n.negX=1/n.negX,n.posX=1/n.posX,n}},{key:"bounds",value:function(){var t=this.bounds_UpperReal_Fujiwara(),e={minX:t.negX,maxX:t.posX};return 0===t.negX&&0===t.posX?e:(0===t.negX?e.minX=this.bounds_LowerReal_Fujiwara().posX:0===t.posX&&(e.maxX=this.bounds_LowerReal_Fujiwara().negX),e.minX>e.maxX&&(e.minX=e.maxX=0),e)}},{key:"modify_zeroSmallCoefs",value:function(){for(var t=this.coefs,e=10*1e-15*Math.abs(t.reduce(function(t,e){return Math.abs(e)>Math.abs(t)?e:t})),n=0;n<t.length-1;n++)Math.abs(t[n])<e&&(t[n]=0);return this}},{key:"modify_toMonic",value:function(){var t=this.coefs;return 1!==t[t.length-1]&&this.divide_scalar(t[t.length-1]),this}},{key:"bound_UpperAbs_Rouche",value:function(){var t=this.coefs,e=t.length-1;return 1+t.reduce(function(t,n,i){return i!==e&&t<(n=Math.abs(n))?n:t},0)/Math.abs(t[e])}},{key:"bound_LowerAbs_Rouche",value:function(){var t=this.coefs,e=t.reduce(function(t,e,n){return 0!==n&&t<(e=Math.abs(e))?e:t},0);return Math.abs(t[0])/(Math.abs(t[0])+e)}},{key:"bounds_Real_Laguerre",value:function(){var t=this.coefs,e=t.length-1,n=-t[e-1]/(e*t[e]),i=t[e-1]*t[e-1]-2*e/(e-1)*t[e]*t[e-2],r=(e-1)/(e*t[e])*Math.sqrt(i);return r<0&&(r=-r),{minX:n-r,maxX:n+r}}},{key:"countRoots_Descartes",value:function(){var t=this.coefs,e=t.length-1,n=t.reduce(function(t,e,n){return 0!==t.prev_a&&0!==e&&(t.prev_a<0==e>0&&t.pos++,n%2==0!=t.prev_a<0==(n%2==1!=e>0)&&t.neg++),t.prev_a=e,t},{pos:0,neg:0,prev_a:0});return{maxRealPos:n.pos,maxRealNeg:n.neg,minComplex:e-(n.pos+n.neg)}}}],[{key:"interpolate",value:function(t,e,n,i,r){if(t.constructor!==Array||e.constructor!==Array)throw new Error("Polynomial.interpolate: xs and ys must be arrays");if(isNaN(n)||isNaN(i)||isNaN(r))throw new Error("Polynomial.interpolate: n, offset, and x must be numbers");var s,a=0,o=0,u=new Array(n),y=new Array(n),l=0,c=Math.abs(r-t[i]);for(s=0;s<n;s++){var h=Math.abs(r-t[i+s]);h<c&&(l=s,c=h),u[s]=y[s]=e[i+s]}a=e[i+l],l--;for(var x=1;x<n;x++){for(s=0;s<n-x;s++){var f=t[i+s]-r,v=t[i+s+x]-r,p=u[s+1]-y[s],d=f-v;if(0===d)throw new Error("Unable to interpolate polynomial. Two numbers in n were identical (to within roundoff)");d=p/d,y[s]=v*d,u[s]=f*d}a+=o=2*(l+1)<n-x?u[l+1]:y[l--]}return{y:a,dy:o}}},{key:"newton_secant_bisection",value:function(t,e,n,i,r,s){var a,u,y,l,c,h,x,f=0,v=0;a=t;var p=Math.pow(10,-14),d="number"==typeof r&&"number"==typeof s;if(d){if(r>s)throw new Error("newton root finding: min must be greater than max");if(h=e(r),x=e(s),o(h)===o(x))throw new Error("newton root finding: y values of bounds must be of opposite sign")}for(var w=function(){return Math.abs(y)<=p*Math.abs(a)||v===a-y-a},m=0;m<i;m++){if(0===(u=n(a))){if(0===f)throw new Error("newton root finding: df(x) is zero");u=f}if(f=u,c=e(a),l=a-(y=c/u),w())break;if(d){if(o(c)===o(x))s=a,x=c;else{if(o(c)!==o(h)){a=l;break}r=a,h=c}if(l<r||l>s){if(o(h)===o(x))break;var g=x-h,b=s-r;if(y=0===g?a-(r+.5*b):Math.abs(g/Math.min(h,x))>50?a-(r+b*(.5+(Math.abs(h)<Math.abs(x)?-.25:.25))):a-(r-h/g*b),l=a-y,w())break}}v=a-l,a=l}return a}}]),e}();u.TOLERANCE=1e-6,u.ACCURACY=15;var y=function(){function e(n,i){t(this,e),this.init(n,i)}return n(e,[{key:"init",value:function(t,e){this.name=t,this.args=e}}]),e}(),l=2*Math.PI,c=new s(1,0);function h(t){return null==t}function x(t){var e=t%l;return e<0?e+l:e}function f(t,e,n,i,r,a){if(0===t.points.length)return t;var o=new p("No Intersection"),u=x(r),y=x(a),l=!0,h=!1,f=void 0;try{for(var v,d=t.points[Symbol.iterator]();!(l=(v=d.next()).done);l=!0){var w=v.value,m=x(c.angleBetween(s.fromPoints(e,w)));u<=m&&m<=y&&o.appendPoint(w)}}catch(t){h=!0,f=t}finally{try{l||null==d.return||d.return()}finally{if(h)throw f}}return o.points.length>0&&(o.status="Intersection"),o}function v(t){var e=t.slice();return e.push(t[0]),e}var p=function(){function e(n){t(this,e),this.init(n)}return n(e,[{key:"init",value:function(t){this.status=t,this.points=[]}},{key:"appendPoint",value:function(t){this.points.push(t)}},{key:"appendPoints",value:function(t){this.points=this.points.concat(t)}}],[{key:"intersect",value:function(t,n){var i;if(h(t)||h(n))i=new e("No Intersection");else if("Path"===t.name)i=e.intersectPathShape(t,n);else if("Path"===n.name)i=e.intersectPathShape(n,t);else if("Arc"===t.name)i=e.intersectArcShape(t,n);else if("Arc"===n.name)i=e.intersectArcShape(n,t);else{var r,s;if(t.name<n.name?(r="intersect"+t.name+n.name,s=t.args.concat(n.args)):(r="intersect"+n.name+t.name,s=n.args.concat(t.args)),!(r in e))throw new Error("Intersection not available: "+r);i=e[r].apply(null,s)}return i}},{key:"intersectPathShape",value:function(t,n){var i=new e("No Intersection"),r=!0,s=!1,a=void 0;try{for(var o,u=t.args[Symbol.iterator]();!(r=(o=u.next()).done);r=!0){var y=o.value,l=e.intersect(y,n);i.appendPoints(l.points)}}catch(t){s=!0,a=t}finally{try{r||null==u.return||u.return()}finally{if(s)throw a}}return i.points.length>0&&(i.status="Intersection"),i}},{key:"intersectArcShape",value:function(t,n){var r=i(t.args,5),s=r[0],a=r[1],o=r[2],u=r[3],l=r[4],c=new y("Ellipse",[s,a,o]);return f(e.intersect(c,n),s,0,0,u,l)}},{key:"intersectBezier2Bezier2",value:function(t,n,i,s,a,o){var y,l,c=new e("No Intersection");y=n.multiply(-2);var h=t.add(y.add(i));y=t.multiply(-2),l=n.multiply(2);var x=y.add(l),f=new r(t.x,t.y);y=a.multiply(-2);var v=s.add(y.add(o));y=s.multiply(-2),l=a.multiply(2);var p=y.add(l),d=new r(s.x,s.y);y=h.x*x.y-x.x*h.y,l=v.x*x.y-x.x*v.y;var w=p.x*x.y-x.x*p.y,m=x.x*(f.y-d.y)+x.y*(-f.x+d.x),g=v.x*h.y-h.x*v.y,b=p.x*h.y-h.x*p.y,k=h.x*(f.y-d.y)+h.y*(-f.x+d.x),M=new u(-g*g,-2*g*b,y*l-b*b-2*g*k,y*w-2*b*k,y*m-k*k).getRoots(),P=!0,I=!1,N=void 0;try{for(var R,L=M[Symbol.iterator]();!(P=(R=L.next()).done);P=!0){var E=R.value;if(0<=E&&E<=1){var z=new u(h.x,x.x,f.x-d.x-E*p.x-E*E*v.x);z.simplify();var _=z.getRoots(),B=new u(h.y,x.y,f.y-d.y-E*p.y-E*E*v.y);B.simplify();var C=B.getRoots();if(_.length>0&&C.length>0){var X=!0,A=!1,S=void 0;try{t:for(var q,D=_[Symbol.iterator]();!(X=(q=D.next()).done);X=!0){var U=q.value;if(0<=U&&U<=1)for(var F=0;F<C.length;F++)if(Math.abs(U-C[F])<1e-4){c.points.push(v.multiply(E*E).add(p.multiply(E).add(d)));break t}}}catch(t){A=!0,S=t}finally{try{X||null==D.return||D.return()}finally{if(A)throw S}}}}}}catch(t){I=!0,N=t}finally{try{P||null==L.return||L.return()}finally{if(I)throw N}}return c.points.length>0&&(c.status="Intersection"),c}},{key:"intersectBezier2Bezier3",value:function(t,n,i,a,o,y,l){var c,h,x,f,v=new e("No Intersection");c=n.multiply(-2);var p=t.add(c.add(i));c=t.multiply(-2),h=n.multiply(2);var d=c.add(h),w=new r(t.x,t.y);c=a.multiply(-1),h=o.multiply(3),x=y.multiply(-3),f=c.add(h.add(x.add(l)));var m=new s(f.x,f.y);c=a.multiply(3),h=o.multiply(-6),x=y.multiply(3),f=c.add(h.add(x));var g=new s(f.x,f.y);c=a.multiply(-3),h=o.multiply(3),x=c.add(h);var b=new s(x.x,x.y),k=new s(a.x,a.y),M=w.x*w.x,P=w.y*w.y,I=d.x*d.x,N=d.y*d.y,R=p.x*p.x,L=p.y*p.y,E=k.x*k.x,z=k.y*k.y,_=b.x*b.x,B=b.y*b.y,C=g.x*g.x,X=g.y*g.y,A=m.x*m.x,S=m.y*m.y,q=new u(-2*p.x*p.y*m.x*m.y+R*S+L*A,-2*p.x*p.y*g.x*m.y-2*p.x*p.y*g.y*m.x+2*L*g.x*m.x+2*R*g.y*m.y,-2*p.x*b.x*p.y*m.y-2*p.x*p.y*b.y*m.x-2*p.x*p.y*g.x*g.y+2*b.x*L*m.x+L*C+R*(2*b.y*m.y+X),2*w.x*p.x*p.y*m.y+2*w.y*p.x*p.y*m.x+d.x*d.y*p.x*m.y+d.x*d.y*p.y*m.x-2*k.x*p.x*p.y*m.y-2*p.x*k.y*p.y*m.x-2*p.x*b.x*p.y*g.y-2*p.x*p.y*b.y*g.x-2*w.x*L*m.x-2*w.y*R*m.y+2*k.x*L*m.x+2*b.x*L*g.x-N*p.x*m.x-I*p.y*m.y+R*(2*k.y*m.y+2*b.y*g.y),2*w.x*p.x*p.y*g.y+2*w.y*p.x*p.y*g.x+d.x*d.y*p.x*g.y+d.x*d.y*p.y*g.x-2*k.x*p.x*p.y*g.y-2*p.x*k.y*p.y*g.x-2*p.x*b.x*p.y*b.y-2*w.x*L*g.x-2*w.y*R*g.y+2*k.x*L*g.x-N*p.x*g.x-I*p.y*g.y+_*L+R*(2*k.y*g.y+B),2*w.x*p.x*p.y*b.y+2*w.y*p.x*b.x*p.y+d.x*d.y*p.x*b.y+d.x*d.y*b.x*p.y-2*k.x*p.x*p.y*b.y-2*p.x*k.y*b.x*p.y-2*w.x*b.x*L-2*w.y*R*b.y+2*k.x*b.x*L-N*p.x*b.x-I*p.y*b.y+2*R*k.y*b.y,-2*w.x*w.y*p.x*p.y-w.x*d.x*d.y*p.y-w.y*d.x*d.y*p.x+2*w.x*p.x*k.y*p.y+2*w.y*k.x*p.x*p.y+d.x*k.x*d.y*p.y+d.x*d.y*p.x*k.y-2*k.x*p.x*k.y*p.y-2*w.x*k.x*L+w.x*N*p.x+w.y*I*p.y-2*w.y*R*k.y-k.x*N*p.x-I*k.y*p.y+M*L+P*R+E*L+R*z).getRootsInInterval(0,1),D=!0,U=!1,F=void 0;try{for(var T,O=q[Symbol.iterator]();!(D=(T=O.next()).done);D=!0){var j=T.value,Y=new u(p.x,d.x,w.x-k.x-j*b.x-j*j*g.x-j*j*j*m.x).getRoots(),Q=new u(p.y,d.y,w.y-k.y-j*b.y-j*j*g.y-j*j*j*m.y).getRoots();if(Y.length>0&&Q.length>0){var V=!0,G=!1,H=void 0;try{t:for(var J,K=Y[Symbol.iterator]();!(V=(J=K.next()).done);V=!0){var W=J.value;if(0<=W&&W<=1)for(var Z=0;Z<Q.length;Z++)if(Math.abs(W-Q[Z])<1e-4){v.points.push(m.multiply(j*j*j).add(g.multiply(j*j).add(b.multiply(j).add(k))));break t}}}catch(t){G=!0,H=t}finally{try{V||null==K.return||K.return()}finally{if(G)throw H}}}}}catch(t){U=!0,F=t}finally{try{D||null==O.return||O.return()}finally{if(U)throw F}}return v.points.length>0&&(v.status="Intersection"),v}},{key:"intersectBezier2Circle",value:function(t,n,i,r,s){return e.intersectBezier2Ellipse(t,n,i,r,s,s)}},{key:"intersectBezier2Ellipse",value:function(t,n,i,s,a,o){var y,l=new e("No Intersection");y=n.multiply(-2);var c=t.add(y.add(i));y=t.multiply(-2);var h=n.multiply(2),x=y.add(h),f=new r(t.x,t.y),v=a*a,p=o*o,d=new u(p*c.x*c.x+v*c.y*c.y,2*(p*c.x*x.x+v*c.y*x.y),p*(2*c.x*f.x+x.x*x.x)+v*(2*c.y*f.y+x.y*x.y)-2*(p*s.x*c.x+v*s.y*c.y),2*(p*x.x*(f.x-s.x)+v*x.y*(f.y-s.y)),p*(f.x*f.x+s.x*s.x)+v*(f.y*f.y+s.y*s.y)-2*(p*s.x*f.x+v*s.y*f.y)-v*p).getRoots(),w=!0,m=!1,g=void 0;try{for(var b,k=d[Symbol.iterator]();!(w=(b=k.next()).done);w=!0){var M=b.value;0<=M&&M<=1&&l.points.push(c.multiply(M*M).add(x.multiply(M).add(f)))}}catch(t){m=!0,g=t}finally{try{w||null==k.return||k.return()}finally{if(m)throw g}}return l.points.length>0&&(l.status="Intersection"),l}},{key:"intersectBezier2Line",value:function(t,n,i,a,o){var y,l=a.min(o),c=a.max(o),h=new e("No Intersection");y=n.multiply(-2);var x=t.add(y.add(i));y=t.multiply(-2);var f=n.multiply(2),v=y.add(f),p=new r(t.x,t.y),d=new s(a.y-o.y,o.x-a.x),w=a.x*o.y-o.x*a.y,m=new u(d.dot(x),d.dot(v),d.dot(p)+w).getRoots(),g=!0,b=!1,k=void 0;try{for(var M,P=m[Symbol.iterator]();!(g=(M=P.next()).done);g=!0){var I=M.value;if(0<=I&&I<=1){var N=t.lerp(n,I),R=n.lerp(i,I),L=N.lerp(R,I);a.x===o.x?l.y<=L.y&&L.y<=c.y&&(h.status="Intersection",h.appendPoint(L)):a.y===o.y?l.x<=L.x&&L.x<=c.x&&(h.status="Intersection",h.appendPoint(L)):l.x<=L.x&&L.x<=c.x&&l.y<=L.y&&L.y<=c.y&&(h.status="Intersection",h.appendPoint(L))}}}catch(t){b=!0,k=t}finally{try{g||null==P.return||P.return()}finally{if(b)throw k}}return h}},{key:"intersectBezier2Polygon",value:function(t,n,i,r){return e.intersectBezier2Polyline(t,n,i,v(r))}},{key:"intersectBezier2Polyline",value:function(t,n,i,r){for(var s=new e("No Intersection"),a=r.length,o=0;o<a-1;o++){var u=r[o],y=r[o+1],l=e.intersectBezier2Line(t,n,i,u,y);s.appendPoints(l.points)}return s.points.length>0&&(s.status="Intersection"),s}},{key:"intersectBezier2Rectangle",value:function(t,n,i,s,a){var o=s.min(a),u=s.max(a),y=new r(u.x,o.y),l=new r(o.x,u.y),c=e.intersectBezier2Line(t,n,i,o,y),h=e.intersectBezier2Line(t,n,i,y,u),x=e.intersectBezier2Line(t,n,i,u,l),f=e.intersectBezier2Line(t,n,i,l,o),v=new e("No Intersection");return v.appendPoints(c.points),v.appendPoints(h.points),v.appendPoints(x.points),v.appendPoints(f.points),v.points.length>0&&(v.status="Intersection"),v}},{key:"intersectBezier3Bezier3",value:function(t,n,i,r,a,o,y,l){var c,h,x,f,v=new e("No Intersection");c=t.multiply(-1),h=n.multiply(3),x=i.multiply(-3),f=c.add(h.add(x.add(r)));var p=new s(f.x,f.y);c=t.multiply(3),h=n.multiply(-6),x=i.multiply(3),f=c.add(h.add(x));var d=new s(f.x,f.y);c=t.multiply(-3),h=n.multiply(3),x=c.add(h);var w=new s(x.x,x.y),m=new s(t.x,t.y);c=a.multiply(-1),h=o.multiply(3),x=y.multiply(-3),f=c.add(h.add(x.add(l)));var g=new s(f.x,f.y);c=a.multiply(3),h=o.multiply(-6),x=y.multiply(3),f=c.add(h.add(x));var b=new s(f.x,f.y);c=a.multiply(-3),h=o.multiply(3),x=c.add(h);var k=new s(x.x,x.y),M=new s(a.x,a.y);c=p.x*d.y-d.x*p.y,h=p.x*w.y-w.x*p.y;var P=p.x*m.y-m.x*p.y+M.x*p.y-p.x*M.y,I=k.x*p.y-p.x*k.y,N=b.x*p.y-p.x*b.y,R=g.x*p.y-p.x*g.y;f=p.x*w.y-w.x*p.y;var L=p.x*m.y+d.x*w.y-w.x*d.y-m.x*p.y+M.x*p.y-p.x*M.y,E=k.x*p.y-p.x*k.y,z=b.x*p.y-p.x*b.y,_=g.x*p.y-p.x*g.y,B=d.x*m.y-m.x*d.y+M.x*d.y-d.x*M.y,C=k.x*d.y-d.x*k.y,X=b.x*d.y-d.x*b.y,A=g.x*d.y-d.x*g.y,S=p.x*m.y-m.x*p.y+M.x*p.y-p.x*M.y,q=k.x*p.y-p.x*k.y,D=b.x*p.y-p.x*b.y,U=g.x*p.y-p.x*g.y,F=d.x*m.y-m.x*d.y+M.x*d.y-d.x*M.y,T=k.x*d.y-d.x*k.y,O=b.x*d.y-d.x*b.y,j=g.x*d.y-d.x*g.y,Y=w.x*m.y-m.x*w.y+M.x*w.y-w.x*M.y,Q=k.x*w.y-w.x*k.y,V=b.x*w.y-w.x*b.y,G=g.x*w.y-w.x*g.y,H=new u(-R*_*U,-R*_*D-R*z*U-N*_*U,-R*_*q-R*z*D-N*_*D-R*E*U-N*z*U-I*_*U,-R*_*S-R*z*q-N*_*q-R*E*D-N*z*D-I*_*D-R*L*U-N*E*U-I*z*U-P*_*U+h*A*U+R*f*j-c*A*j+c*_*G,-R*z*S-N*_*S-R*E*q-N*z*q-I*_*q-R*L*D-N*E*D-I*z*D-P*_*D+h*A*D-N*L*U-I*E*U-P*z*U+h*X*U+R*f*O-c*A*O+N*f*j-c*X*j+c*_*V+c*z*G,-R*E*S-N*z*S-I*_*S-R*L*q-N*E*q-I*z*q-P*_*q+h*A*q-N*L*D-I*E*D-P*z*D+h*X*D-I*L*U-P*E*U+h*C*U+R*f*T-c*A*T+N*f*O-c*X*O+I*f*j-c*C*j+c*_*Q+c*z*V+c*E*G,-R*L*S-N*E*S-I*z*S-P*_*S+h*A*S-N*L*q-I*E*q-P*z*q+h*X*q-I*L*D-P*E*D+h*C*D-P*L*U+h*B*U+R*f*F-c*A*F+N*f*T-c*X*T+I*f*O-c*C*O+P*f*j-c*B*j+c*_*Y+c*z*Q+c*E*V-h*f*G+c*L*G,-N*L*S-I*E*S-P*z*S+h*X*S-I*L*q-P*E*q+h*C*q-P*L*D+h*B*D+N*f*F-c*X*F+I*f*T-c*C*T+P*f*O-c*B*O+c*z*Y+c*E*Q-h*f*V+c*L*V,-I*L*S-P*E*S+h*C*S-P*L*q+h*B*q+I*f*F-c*C*F+P*f*T-c*B*T+c*E*Y-h*f*Q+c*L*Q,-P*L*S+h*B*S+P*f*F-c*B*F-h*f*Y+c*L*Y);H.simplify();var J=H.getRootsInInterval(0,1),K=!0,W=!1,Z=void 0;try{for(var $,tt=J[Symbol.iterator]();!(K=($=tt.next()).done);K=!0){var et=$.value,nt=new u(p.x,d.x,w.x,m.x-M.x-et*k.x-et*et*b.x-et*et*et*g.x);nt.simplify();var it=nt.getRoots(),rt=new u(p.y,d.y,w.y,m.y-M.y-et*k.y-et*et*b.y-et*et*et*g.y);rt.simplify();var st=rt.getRoots();if(it.length>0&&st.length>0){var at=!0,ot=!1,ut=void 0;try{t:for(var yt,lt=it[Symbol.iterator]();!(at=(yt=lt.next()).done);at=!0){var ct=yt.value;if(0<=ct&&ct<=1)for(var ht=0;ht<st.length;ht++)if(Math.abs(ct-st[ht])<1e-4){v.points.push(g.multiply(et*et*et).add(b.multiply(et*et).add(k.multiply(et).add(M))));break t}}}catch(t){ot=!0,ut=t}finally{try{at||null==lt.return||lt.return()}finally{if(ot)throw ut}}}}}catch(t){W=!0,Z=t}finally{try{K||null==tt.return||tt.return()}finally{if(W)throw Z}}return v.points.length>0&&(v.status="Intersection"),v}},{key:"intersectBezier3Circle",value:function(t,n,i,r,s,a){return e.intersectBezier3Ellipse(t,n,i,r,s,a,a)}},{key:"intersectBezier3Ellipse",value:function(t,n,i,r,a,o,y){var l,c,h,x,f=new e("No Intersection");l=t.multiply(-1),c=n.multiply(3),h=i.multiply(-3),x=l.add(c.add(h.add(r)));var v=new s(x.x,x.y);l=t.multiply(3),c=n.multiply(-6),h=i.multiply(3),x=l.add(c.add(h));var p=new s(x.x,x.y);l=t.multiply(-3),c=n.multiply(3),h=l.add(c);var d=new s(h.x,h.y),w=new s(t.x,t.y),m=o*o,g=y*y,b=new u(v.x*v.x*g+v.y*v.y*m,2*(v.x*p.x*g+v.y*p.y*m),2*(v.x*d.x*g+v.y*d.y*m)+p.x*p.x*g+p.y*p.y*m,2*v.x*g*(w.x-a.x)+2*v.y*m*(w.y-a.y)+2*(p.x*d.x*g+p.y*d.y*m),2*p.x*g*(w.x-a.x)+2*p.y*m*(w.y-a.y)+d.x*d.x*g+d.y*d.y*m,2*d.x*g*(w.x-a.x)+2*d.y*m*(w.y-a.y),w.x*w.x*g-2*w.y*a.y*m-2*w.x*a.x*g+w.y*w.y*m+a.x*a.x*g+a.y*a.y*m-m*g).getRootsInInterval(0,1),k=!0,M=!1,P=void 0;try{for(var I,N=b[Symbol.iterator]();!(k=(I=N.next()).done);k=!0){var R=I.value;f.points.push(v.multiply(R*R*R).add(p.multiply(R*R).add(d.multiply(R).add(w))))}}catch(t){M=!0,P=t}finally{try{k||null==N.return||N.return()}finally{if(M)throw P}}return f.points.length>0&&(f.status="Intersection"),f}},{key:"intersectBezier3Line",value:function(t,n,i,r,a,o){var y,l,c,h,x=a.min(o),f=a.max(o),v=new e("No Intersection");y=t.multiply(-1),l=n.multiply(3),c=i.multiply(-3),h=y.add(l.add(c.add(r)));var p=new s(h.x,h.y);y=t.multiply(3),l=n.multiply(-6),c=i.multiply(3),h=y.add(l.add(c));var d=new s(h.x,h.y);y=t.multiply(-3),l=n.multiply(3),c=y.add(l);var w=new s(c.x,c.y),m=new s(t.x,t.y),g=new s(a.y-o.y,o.x-a.x),b=a.x*o.y-o.x*a.y,k=new u(g.dot(p),g.dot(d),g.dot(w),g.dot(m)+b).getRoots(),M=!0,P=!1,I=void 0;try{for(var N,R=k[Symbol.iterator]();!(M=(N=R.next()).done);M=!0){var L=N.value;if(0<=L&&L<=1){var E=t.lerp(n,L),z=n.lerp(i,L),_=i.lerp(r,L),B=E.lerp(z,L),C=z.lerp(_,L),X=B.lerp(C,L);a.x===o.x?x.y<=X.y&&X.y<=f.y&&(v.status="Intersection",v.appendPoint(X)):a.y===o.y?x.x<=X.x&&X.x<=f.x&&(v.status="Intersection",v.appendPoint(X)):x.x<=X.x&&X.x<=f.x&&x.y<=X.y&&X.y<=f.y&&(v.status="Intersection",v.appendPoint(X))}}}catch(t){P=!0,I=t}finally{try{M||null==R.return||R.return()}finally{if(P)throw I}}return v}},{key:"intersectBezier3Polygon",value:function(t,n,i,r,s){return e.intersectBezier3Polyline(t,n,i,r,v(s))}},{key:"intersectBezier3Polyline",value:function(t,n,i,r,s){for(var a=new e("No Intersection"),o=s.length,u=0;u<o-1;u++){var y=s[u],l=s[u+1],c=e.intersectBezier3Line(t,n,i,r,y,l);a.appendPoints(c.points)}return a.points.length>0&&(a.status="Intersection"),a}},{key:"intersectBezier3Rectangle",value:function(t,n,i,s,a,o){var u=a.min(o),y=a.max(o),l=new r(y.x,u.y),c=new r(u.x,y.y),h=e.intersectBezier3Line(t,n,i,s,u,l),x=e.intersectBezier3Line(t,n,i,s,l,y),f=e.intersectBezier3Line(t,n,i,s,y,c),v=e.intersectBezier3Line(t,n,i,s,c,u),p=new e("No Intersection");return p.appendPoints(h.points),p.appendPoints(x.points),p.appendPoints(f.points),p.appendPoints(v.points),p.points.length>0&&(p.status="Intersection"),p}},{key:"intersectCircleCircle",value:function(t,n,i,s){var a,o=n+s,u=Math.abs(n-s),y=t.distanceFrom(i);if(y>o)a=new e("Outside");else if(y<u)a=new e("Inside");else{a=new e("Intersection");var l=(n*n-s*s+y*y)/(2*y),c=Math.sqrt(n*n-l*l),h=t.lerp(i,l/y),x=c/y;a.points.push(new r(h.x-x*(i.y-t.y),h.y+x*(i.x-t.x))),a.points.push(new r(h.x+x*(i.y-t.y),h.y-x*(i.x-t.x)))}return a}},{key:"intersectCircleEllipse",value:function(t,n,i,r,s){return e.intersectEllipseEllipse(t,n,n,i,r,s)}},{key:"intersectCircleLine",value:function(t,n,i,r){var s,a=(r.x-i.x)*(r.x-i.x)+(r.y-i.y)*(r.y-i.y),o=2*((r.x-i.x)*(i.x-t.x)+(r.y-i.y)*(i.y-t.y)),u=o*o-4*a*(t.x*t.x+t.y*t.y+i.x*i.x+i.y*i.y-2*(t.x*i.x+t.y*i.y)-n*n);if(u<0)s=new e("Outside");else if(0===u)s=new e("Tangent");else{var y=Math.sqrt(u),l=(-o+y)/(2*a),c=(-o-y)/(2*a);(l<0||l>1)&&(c<0||c>1)?s=new e(l<0&&c<0||l>1&&c>1?"Outside":"Inside"):(s=new e("Intersection"),0<=l&&l<=1&&s.points.push(i.lerp(r,l)),0<=c&&c<=1&&s.points.push(i.lerp(r,c)))}return s}},{key:"intersectCirclePolygon",value:function(t,n,i){return e.intersectCirclePolyline(t,n,v(i))}},{key:"intersectCirclePolyline",value:function(t,n,i){for(var r,s=new e("No Intersection"),a=i.length,o=0;o<a-1;o++){var u=i[o],y=i[o+1];r=e.intersectCircleLine(t,n,u,y),s.appendPoints(r.points)}return s.points.length>0?s.status="Intersection":s.status=r.status,s}},{key:"intersectCircleRectangle",value:function(t,n,i,s){var a=i.min(s),o=i.max(s),u=new r(o.x,a.y),y=new r(a.x,o.y),l=e.intersectCircleLine(t,n,a,u),c=e.intersectCircleLine(t,n,u,o),h=e.intersectCircleLine(t,n,o,y),x=e.intersectCircleLine(t,n,y,a),f=new e("No Intersection");return f.appendPoints(l.points),f.appendPoints(c.points),f.appendPoints(h.points),f.appendPoints(x.points),f.points.length>0?f.status="Intersection":f.status=l.status,f}},{key:"intersectEllipseEllipse",value:function(t,n,i,s,a,o){for(var y,l,c,h,x,f,v,p,d,w,m,g,b,k,M,P=[i*i,0,n*n,-2*i*i*t.x,-2*n*n*t.y,i*i*t.x*t.x+n*n*t.y*t.y-n*n*i*i],I=[o*o,0,a*a,-2*o*o*s.x,-2*a*a*s.y,o*o*s.x*s.x+a*a*s.y*s.y-a*a*o*o],N=(l=I,c=(y=P)[0]*l[1]-l[0]*y[1],h=y[0]*l[2]-l[0]*y[2],x=y[0]*l[3]-l[0]*y[3],f=y[0]*l[4]-l[0]*y[4],v=y[0]*l[5]-l[0]*y[5],p=y[1]*l[2]-l[1]*y[2],d=y[1]*l[4]-l[1]*y[4],w=y[1]*l[5]-l[1]*y[5],m=y[2]*l[3]-l[2]*y[3],g=y[3]*l[4]-l[3]*y[4],b=y[3]*l[5]-l[3]*y[5],new u(c*p-h*h,c*(M=d-m)+x*p-2*h*f,c*(k=w+g)+x*M-f*f-2*h*v,c*b+x*k-2*f*v,x*b-v*v)).getRoots(),R=.001*(P[0]*P[0]+2*P[1]*P[1]+P[2]*P[2]),L=.001*(I[0]*I[0]+2*I[1]*I[1]+I[2]*I[2]),E=new e("No Intersection"),z=0;z<N.length;z++)for(var _=new u(P[0],P[3]+N[z]*P[1],P[5]+N[z]*(P[4]+N[z]*P[2])).getRoots(),B=0;B<_.length;B++){var C=(P[0]*_[B]+P[1]*N[z]+P[3])*_[B]+(P[2]*N[z]+P[4])*N[z]+P[5];Math.abs(C)<R&&(C=(I[0]*_[B]+I[1]*N[z]+I[3])*_[B]+(I[2]*N[z]+I[4])*N[z]+I[5],Math.abs(C)<L&&E.appendPoint(new r(_[B],N[z])))}return E.points.length>0&&(E.status="Intersection"),E}},{key:"intersectEllipseLine",value:function(t,n,i,r,a){var o,u=new s(r.x,r.y),y=s.fromPoints(r,a),l=new s(t.x,t.y),c=u.subtract(l),h=new s(y.x/(n*n),y.y/(i*i)),x=new s(c.x/(n*n),c.y/(i*i)),f=y.dot(h),v=y.dot(x),p=v*v-f*(t=c.dot(x)-1);if(p<0)o=new e("Outside");else if(p>0){var d=Math.sqrt(p),w=(-v-d)/f,m=(-v+d)/f;(w<0||1<w)&&(m<0||1<m)?o=new e(w<0&&m<0||w>1&&m>1?"Outside":"Inside"):(o=new e("Intersection"),0<=w&&w<=1&&o.appendPoint(r.lerp(a,w)),0<=m&&m<=1&&o.appendPoint(r.lerp(a,m)))}else{var g=-v/f;0<=g&&g<=1?(o=new e("Intersection")).appendPoint(r.lerp(a,g)):o=new e("Outside")}return o}},{key:"intersectEllipsePolygon",value:function(t,n,i,r){return e.intersectEllipsePolyline(t,n,i,v(r))}},{key:"intersectEllipsePolyline",value:function(t,n,i,r){for(var s=new e("No Intersection"),a=r.length,o=0;o<a-1;o++){var u=r[o],y=r[o+1],l=e.intersectEllipseLine(t,n,i,u,y);s.appendPoints(l.points)}return s.points.length>0&&(s.status="Intersection"),s}},{key:"intersectEllipseRectangle",value:function(t,n,i,s,a){var o=s.min(a),u=s.max(a),y=new r(u.x,o.y),l=new r(o.x,u.y),c=e.intersectEllipseLine(t,n,i,o,y),h=e.intersectEllipseLine(t,n,i,y,u),x=e.intersectEllipseLine(t,n,i,u,l),f=e.intersectEllipseLine(t,n,i,l,o),v=new e("No Intersection");return v.appendPoints(c.points),v.appendPoints(h.points),v.appendPoints(x.points),v.appendPoints(f.points),v.points.length>0&&(v.status="Intersection"),v}},{key:"intersectLineLine",value:function(t,n,i,s){var a,o=(s.x-i.x)*(t.y-i.y)-(s.y-i.y)*(t.x-i.x),u=(n.x-t.x)*(t.y-i.y)-(n.y-t.y)*(t.x-i.x),y=(s.y-i.y)*(n.x-t.x)-(s.x-i.x)*(n.y-t.y);if(0!==y){var l=o/y,c=u/y;0<=l&&l<=1&&0<=c&&c<=1?(a=new e("Intersection")).points.push(new r(t.x+l*(n.x-t.x),t.y+l*(n.y-t.y))):a=new e("No Intersection")}else a=new e(0===o||0===u?"Coincident":"Parallel");return a}},{key:"intersectLinePolygon",value:function(t,n,i){return e.intersectLinePolyline(t,n,v(i))}},{key:"intersectLinePolyline",value:function(t,n,i){for(var r=new e("No Intersection"),s=i.length,a=0;a<s-1;a++){var o=i[a],u=i[a+1],y=e.intersectLineLine(t,n,o,u);r.appendPoints(y.points)}return r.points.length>0&&(r.status="Intersection"),r}},{key:"intersectLineRectangle",value:function(t,n,i,s){var a=i.min(s),o=i.max(s),u=new r(o.x,a.y),y=new r(a.x,o.y),l=e.intersectLineLine(a,u,t,n),c=e.intersectLineLine(u,o,t,n),h=e.intersectLineLine(o,y,t,n),x=e.intersectLineLine(y,a,t,n),f=new e("No Intersection");return f.appendPoints(l.points),f.appendPoints(c.points),f.appendPoints(h.points),f.appendPoints(x.points),f.points.length>0&&(f.status="Intersection"),f}},{key:"intersectPolygonPolygon",value:function(t,n){return e.intersectPolylinePolyline(v(t),v(n))}},{key:"intersectPolygonPolyline",value:function(t,n){return e.intersectPolylinePolyline(v(t),n)}},{key:"intersectPolygonRectangle",value:function(t,n,i){return e.intersectPolylineRectangle(v(t),n,i)}},{key:"intersectPolylinePolyline",value:function(t,n){for(var i=new e("No Intersection"),r=t.length,s=0;s<r-1;s++){var a=t[s],o=t[s+1],u=e.intersectLinePolyline(a,o,n);i.appendPoints(u.points)}return i.points.length>0&&(i.status="Intersection"),i}},{key:"intersectPolylineRectangle",value:function(t,n,i){var s=n.min(i),a=n.max(i),o=new r(a.x,s.y),u=new r(s.x,a.y),y=e.intersectLinePolyline(s,o,t),l=e.intersectLinePolyline(o,a,t),c=e.intersectLinePolyline(a,u,t),h=e.intersectLinePolyline(u,s,t),x=new e("No Intersection");return x.appendPoints(y.points),x.appendPoints(l.points),x.appendPoints(c.points),x.appendPoints(h.points),x.points.length>0&&(x.status="Intersection"),x}},{key:"intersectRectangleRectangle",value:function(t,n,i,s){var a=t.min(n),o=t.max(n),u=new r(o.x,a.y),y=new r(a.x,o.y),l=e.intersectLineRectangle(a,u,i,s),c=e.intersectLineRectangle(u,o,i,s),h=e.intersectLineRectangle(o,y,i,s),x=e.intersectLineRectangle(y,a,i,s),f=new e("No Intersection");return f.appendPoints(l.points),f.appendPoints(c.points),f.appendPoints(h.points),f.appendPoints(x.points),f.points.length>0&&(f.status="Intersection"),f}},{key:"intersectRayRay",value:function(t,n,i,s){var a,o=(s.x-i.x)*(t.y-i.y)-(s.y-i.y)*(t.x-i.x),u=(n.x-t.x)*(t.y-i.y)-(n.y-t.y)*(t.x-i.x),y=(s.y-i.y)*(n.x-t.x)-(s.x-i.x)*(n.y-t.y);if(0!==y){var l=o/y;(a=new e("Intersection")).points.push(new r(t.x+l*(n.x-t.x),t.y+l*(n.y-t.y)))}else a=new e(0===o||0===u?"Coincident":"Parallel");return a}}]),e}(),d={quadraticBezier:function(t,e,n,i,s,a){return new y("Bezier2",[new r(t,e),new r(n,i),new r(s,a)])},cubicBezier:function(t,e,n,i,s,a,o,u){return new y("Bezier3",[new r(t,e),new r(n,i),new r(s,a),new r(o,u)])},circle:function(t,e,n){return new y("Circle",[new r(t,e),n])},ellipse:function(t,e,n,i){return new y("Ellipse",[new r(t,e),n,i])},arc:function(t,e,n,i,s,a){return new y("Arc",[new r(t,e),n,i,s,a])},line:function(t,e,n,i){return new y("Line",[new r(t,e),new r(n,i)])},path:function(t){return new y("Path",t)},polygon:function(t){for(var e=[],n=0;n<t.length;n+=2)e.push(new r(t[n],t[n+1]));return new y("Polygon",[e])},polyline:function(t){for(var e=[],n=0;n<t.length;n+=2)e.push(new r(t[n],t[n+1]));return new y("Polyline",[e])},rectangle:function(t,e,n,i){return new y("Rectangle",[new r(t,e),new r(t+n,e+i)])}},w={quadraticBezier:function(t,e,n){return new y("Bezier2",[t,e,n])},cubicBezier:function(t,e,n,i){return new y("Bezier3",[t,e,n,i])},circle:function(t,e){return new y("Circle",[t,e])},ellipse:function(t,e,n){return new y("Ellipse",[t,e,n])},arc:function(t,e,n,i,r){return new y("Arc",[t,e,n,i,r])},line:function(t,e){return new y("Line",[t,e])},path:function(t){return new y("Path",[t])},polygon:function(t){return new y("Polygon",[t])},polyline:function(t){return new y("Polyline",[t])},rectangle:function(t,e){return new y("Rectangle",[t,t.add(e)])}},m={pointInCircle:function(t,e,n){return s.fromPoints(e,t).length()<=n},pointInEllipse:function(t,e,n,i){var r=t.subtract(e);return r.x*r.x/(n*n)+r.y*r.y/(i*i)<=1},pointInPolyline:function(t,e){for(var n,i=e.length,r=0,s=e[0],a=1;a<=i;a++){var o=e[a%i],u=Math.min(s.y,o.y),y=Math.max(s.y,o.y),l=Math.max(s.x,o.x);s.y!==o.y&&u<t.y&&t.y<=y&&t.x<=l&&(n=(t.y-s.y)*(o.x-s.x)/(o.y-s.y)+s.x,(s.x===o.x||t.x<=n)&&r++),s=o}return r%2==1}};m.pointInPolygon=m.pointInPolyline,m.pointInRectangle=function(t,e,n){return e.x<=t.x&&t.x<n.x&&e.y<=t.y&&t.y<n.y};export{w as AffineShapes,p as Intersection,y as IntersectionArgs,m as IntersectionQuery,a as Matrix2D,r as Point2D,d as Shapes,s as Vector2D};
//# sourceMappingURL=index-esm.min.js.map
