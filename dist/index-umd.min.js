!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).KldIntersections={})}(this,function(t){"use strict";function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function r(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}function i(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],r=!0,i=!1,a=void 0;try{for(var s,o=t[Symbol.iterator]();!(r=(s=o.next()).done)&&(n.push(s.value),!e||n.length!==e);r=!0);}catch(t){i=!0,a=t}finally{try{r||null==o.return||o.return()}finally{if(i)throw a}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function a(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var s=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e(this,t),this.x=n,this.y=r}return r(t,[{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"add",value:function(t){return new this.constructor(this.x+t.x,this.y+t.y)}},{key:"subtract",value:function(t){return new this.constructor(this.x-t.x,this.y-t.y)}},{key:"multiply",value:function(t){return new this.constructor(this.x*t,this.y*t)}},{key:"divide",value:function(t){return new this.constructor(this.x/t,this.y/t)}},{key:"equals",value:function(t){return this.x===t.x&&this.y===t.y}},{key:"precisionEquals",value:function(t,e){return Math.abs(this.x-t.x)<e&&Math.abs(this.y-t.y)<e}},{key:"lerp",value:function(t,e){var n=1-e;return new this.constructor(this.x*n+t.x*e,this.y*n+t.y*e)}},{key:"distanceFrom",value:function(t){var e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)}},{key:"min",value:function(t){return new this.constructor(Math.min(this.x,t.x),Math.min(this.y,t.y))}},{key:"max",value:function(t){return new this.constructor(Math.max(this.x,t.x),Math.max(this.y,t.y))}},{key:"transform",value:function(t){return new this.constructor(t.a*this.x+t.c*this.y+t.e,t.b*this.x+t.d*this.y+t.f)}},{key:"toString",value:function(){return"point(".concat(this.x,",").concat(this.y,")")}}]),t}(),o=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e(this,t),this.x=n,this.y=r}return r(t,[{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"magnitude",value:function(){return this.x*this.x+this.y*this.y}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"cross",value:function(t){return this.x*t.y-this.y*t.x}},{key:"determinant",value:function(t){return this.x*t.y-this.y*t.x}},{key:"unit",value:function(){return this.divide(this.length())}},{key:"add",value:function(t){return new this.constructor(this.x+t.x,this.y+t.y)}},{key:"subtract",value:function(t){return new this.constructor(this.x-t.x,this.y-t.y)}},{key:"multiply",value:function(t){return new this.constructor(this.x*t,this.y*t)}},{key:"divide",value:function(t){return new this.constructor(this.x/t,this.y/t)}},{key:"angleBetween",value:function(t){var e=this.dot(t)/(this.length()*t.length());e=Math.max(-1,Math.min(e,1));var n=Math.acos(e);return this.cross(t)<0?-n:n}},{key:"perp",value:function(){return new this.constructor(-this.y,this.x)}},{key:"perpendicular",value:function(t){return this.subtract(this.project(t))}},{key:"project",value:function(t){var e=this.dot(t)/t.dot(t);return t.multiply(e)}},{key:"transform",value:function(t){return new this.constructor(t.a*this.x+t.c*this.y,t.b*this.x+t.d*this.y)}},{key:"equals",value:function(t){return this.x===t.x&&this.y===t.y}},{key:"precisionEquals",value:function(t,e){return Math.abs(this.x-t.x)<e&&Math.abs(this.y-t.y)<e}},{key:"toString",value:function(){return"vector(".concat(this.x,",").concat(this.y,")")}}],[{key:"fromPoints",value:function(e,n){return new t(n.x-e.x,n.y-e.y)}}]),t}(),u=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;e(this,t),this.a=n,this.b=r,this.c=i,this.d=a,this.e=s,this.f=o}return r(t,[{key:"multiply",value:function(t){return this.isIdentity()?t:t.isIdentity()?this:new this.constructor(this.a*t.a+this.c*t.b,this.b*t.a+this.d*t.b,this.a*t.c+this.c*t.d,this.b*t.c+this.d*t.d,this.a*t.e+this.c*t.f+this.e,this.b*t.e+this.d*t.f+this.f)}},{key:"inverse",value:function(){if(this.isIdentity())return this;var t=this.a*this.d-this.b*this.c;if(0===t)throw new Error("Matrix is not invertible");var e=1/t,n=this.f*this.c-this.e*this.d,r=this.e*this.b-this.f*this.a;return new this.constructor(this.d*e,-this.b*e,-this.c*e,this.a*e,n*e,r*e)}},{key:"translate",value:function(t,e){return new this.constructor(this.a,this.b,this.c,this.d,this.a*t+this.c*e+this.e,this.b*t+this.d*e+this.f)}},{key:"scale",value:function(t){return new this.constructor(this.a*t,this.b*t,this.c*t,this.d*t,this.e,this.f)}},{key:"scaleAt",value:function(t,e){var n=e.x-t*e.x,r=e.y-t*e.y;return new this.constructor(this.a*t,this.b*t,this.c*t,this.d*t,this.a*n+this.c*r+this.e,this.b*n+this.d*r+this.f)}},{key:"scaleNonUniform",value:function(t,e){return new this.constructor(this.a*t,this.b*t,this.c*e,this.d*e,this.e,this.f)}},{key:"scaleNonUniformAt",value:function(t,e,n){var r=n.x-t*n.x,i=n.y-e*n.y;return new this.constructor(this.a*t,this.b*t,this.c*e,this.d*e,this.a*r+this.c*i+this.e,this.b*r+this.d*i+this.f)}},{key:"rotate",value:function(t){var e=Math.cos(t),n=Math.sin(t);return new this.constructor(this.a*e+this.c*n,this.b*e+this.d*n,this.a*-n+this.c*e,this.b*-n+this.d*e,this.e,this.f)}},{key:"rotateAt",value:function(t,e){var n=Math.cos(t),r=Math.sin(t),i=e.x,a=e.y,s=this.a*n+this.c*r,o=this.b*n+this.d*r,u=this.c*n-this.a*r,l=this.d*n-this.b*r;return new this.constructor(s,o,u,l,(this.a-s)*i+(this.c-u)*a+this.e,(this.b-o)*i+(this.d-l)*a+this.f)}},{key:"rotateFromVector",value:function(t){var e=t.unit(),n=e.x,r=e.y;return new this.constructor(this.a*n+this.c*r,this.b*n+this.d*r,this.a*-r+this.c*n,this.b*-r+this.d*n,this.e,this.f)}},{key:"flipX",value:function(){return new this.constructor(-this.a,-this.b,this.c,this.d,this.e,this.f)}},{key:"flipY",value:function(){return new this.constructor(this.a,this.b,-this.c,-this.d,this.e,this.f)}},{key:"skewX",value:function(t){var e=Math.tan(t);return new this.constructor(this.a,this.b,this.c+this.a*e,this.d+this.b*e,this.e,this.f)}},{key:"skewY",value:function(t){var e=Math.tan(t);return new this.constructor(this.a+this.c*e,this.b+this.d*e,this.c,this.d,this.e,this.f)}},{key:"isIdentity",value:function(){return 1===this.a&&0===this.b&&0===this.c&&1===this.d&&0===this.e&&0===this.f}},{key:"isInvertible",value:function(){return this.a*this.d-this.b*this.c!=0}},{key:"getScale",value:function(){return{scaleX:Math.sqrt(this.a*this.a+this.c*this.c),scaleY:Math.sqrt(this.b*this.b+this.d*this.d)}}},{key:"getDecomposition",value:function(){var t=.5*(this.a+this.d),e=.5*(this.a-this.d),n=.5*(this.b+this.c),r=.5*(this.b-this.c),i=Math.sqrt(t*t+r*r),a=Math.sqrt(e*e+n*n),s=i+a,o=i-a,u=Math.atan2(n,e),l=Math.atan2(r,t),c=.5*(l-u),h=.5*(l+u);return{translation:this.constructor.translation(this.e,this.f),rotation:this.constructor.rotation(h),scale:this.constructor.nonUniformScaling(s,o),rotation0:this.constructor.rotation(c)}}},{key:"equals",value:function(t){return this.a===t.a&&this.b===t.b&&this.c===t.c&&this.d===t.d&&this.e===t.e&&this.f===t.f}},{key:"precisionEquals",value:function(t,e){return Math.abs(this.a-t.a)<e&&Math.abs(this.b-t.b)<e&&Math.abs(this.c-t.c)<e&&Math.abs(this.d-t.d)<e&&Math.abs(this.e-t.e)<e&&Math.abs(this.f-t.f)<e}},{key:"toString",value:function(){return"matrix(".concat(this.a,",").concat(this.b,",").concat(this.c,",").concat(this.d,",").concat(this.e,",").concat(this.f,")")}}],[{key:"translation",value:function(e,n){return new t(1,0,0,1,e,n)}},{key:"scaling",value:function(e){return new t(e,0,0,e,0,0)}},{key:"scalingAt",value:function(e,n){return new t(e,0,0,e,n.x-n.x*e,n.y-n.y*e)}},{key:"nonUniformScaling",value:function(e,n){return new t(e,0,0,n,0,0)}},{key:"nonUniformScalingAt",value:function(e,n,r){return new t(e,0,0,n,r.x-r.x*e,r.y-r.y*n)}},{key:"rotation",value:function(e){var n=Math.cos(e),r=Math.sin(e);return new t(n,r,-r,n,0,0)}},{key:"rotationAt",value:function(e,n){var r=Math.cos(e),i=Math.sin(e);return new t(r,i,-i,r,n.x-n.x*r+n.y*i,n.y-n.y*r-n.x*i)}},{key:"rotationFromVector",value:function(e){var n=e.unit(),r=n.x,i=n.y;return new t(r,i,-i,r,0,0)}},{key:"xFlip",value:function(){return new t(-1,0,0,1,0,0)}},{key:"yFlip",value:function(){return new t(1,0,0,-1,0,0)}},{key:"xSkew",value:function(e){return new t(1,0,Math.tan(e),1,0,0)}},{key:"ySkew",value:function(e){return new t(1,Math.tan(e),0,1,0,0)}}]),t}();function l(t){return"number"==typeof t?t?t<0?-1:1:t==t?t:NaN:NaN}u.IDENTITY=new u,u.IDENTITY.isIdentity=function(){return!0};var c=function(){function t(){e(this,t),this.coefs=[];for(var n=arguments.length-1;n>=0;n--)this.coefs.push(n<0||arguments.length<=n?void 0:arguments[n]);this._variable="t",this._s=0}return r(t,[{key:"clone",value:function(){var e=new t;return e.coefs=this.coefs.slice(),e}},{key:"eval",value:function(t){if(isNaN(t))throw new TypeError("Parameter must be a number. Found '".concat(t,"'"));for(var e=0,n=this.coefs.length-1;n>=0;n--)e=e*t+this.coefs[n];return e}},{key:"add",value:function(e){for(var n=new t,r=this.getDegree(),i=e.getDegree(),a=Math.max(r,i),s=0;s<=a;s++){var o=s<=r?this.coefs[s]:0,u=s<=i?e.coefs[s]:0;n.coefs[s]=o+u}return n}},{key:"multiply",value:function(e){for(var n=new t,r=0;r<=this.getDegree()+e.getDegree();r++)n.coefs.push(0);for(var i=0;i<=this.getDegree();i++)for(var a=0;a<=e.getDegree();a++)n.coefs[i+a]+=this.coefs[i]*e.coefs[a];return n}},{key:"divideEqualsScalar",value:function(t){for(var e=0;e<this.coefs.length;e++)this.coefs[e]/=t}},{key:"simplifyEquals",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e-12,e=this.getDegree();e>=0&&Math.abs(this.coefs[e])<=t;e--)this.coefs.pop()}},{key:"removeZerosEquals",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e-15,e=this.coefs,n=10*t*Math.abs(e.reduce(function(t,e){return Math.abs(e)>Math.abs(t)?e:t})),r=0;r<e.length-1;r++)Math.abs(e[r])<n&&(e[r]=0);return this}},{key:"monicEquals",value:function(){var t=this.coefs;return 1!==t[t.length-1]&&this.divideEqualsScalar(t[t.length-1]),this}},{key:"toString",value:function(){for(var t=[],e=[],n=this.coefs.length-1;n>=0;n--){var r=Math.round(1e3*this.coefs[n])/1e3;if(0!==r){var i=r<0?" - ":" + ";r=Math.abs(r),n>0&&(1===r?r=this._variable:r+=this._variable),n>1&&(r+="^"+n),e.push(i),t.push(r)}}e[0]=" + "===e[0]?"":"-";for(var a="",s=0;s<t.length;s++)a+=e[s]+t[s];return a}},{key:"bisection",value:function(t,e){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-6,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:15,a=this.eval(t),s=this.eval(e);if(Math.abs(a)<=r)n=t;else if(Math.abs(s)<=r)n=e;else if(a*s<=0)for(var o=Math.log(e-t),u=Math.LN10*i,l=Math.ceil((o+u)/Math.LN2),c=0;c<l;c++){n=.5*(t+e);var h=this.eval(n);if(Math.abs(h)<=r)break;h*a<0?(e=n,s=h):(t=n,a=h)}return n}},{key:"trapezoid",value:function(t,e,n){if(isNaN(t)||isNaN(e)||isNaN(n))throw new TypeError("Parameters must be numbers");var r=e-t;if(1===n){var i=this.eval(t),a=this.eval(e);this._s=.5*r*(i+a)}else{for(var s=1<<n-2,o=r/s,u=t+.5*o,l=0,c=0;c<s;c++)l+=this.eval(u),u+=o;this._s=.5*(this._s+r*l/s)}if(isNaN(this._s))throw new TypeError("this._s is NaN");return this._s}},{key:"simpson",value:function(t,e){if(isNaN(t)||isNaN(e))throw new TypeError("Parameters must be numbers");for(var n=e-t,r=.5*n*(this.eval(t)+this.eval(e)),i=r,a=4*r/3,s=a,o=r,u=1,l=2;l<=20;l++){for(var c=n/u,h=t+.5*c,y=0,p=1;p<=u;p++)y+=this.eval(h),h+=c;if(a=(4*(r=i=.5*(i+n*y/u))-o)/3,Math.abs(a-s)<1e-7*Math.abs(s))break;s=a,o=r,u<<=1}return a}},{key:"romberg",value:function(e,n){if(isNaN(e)||isNaN(n))throw new TypeError("Parameters must be numbers");var r=new Array(21),i=new Array(21),a={y:0,dy:0};i[0]=1;for(var s=1;s<=20&&(r[s-1]=this.trapezoid(e,n,s),!(s>=3&&(a=t.interpolate(i,r,3,s-3,0),Math.abs(a.dy)<=1e-6*a.y)));s++)r[s]=r[s-1],i[s]=.25*i[s-1];return a.y}},{key:"zeroErrorEstimate",value:function(t){if(void 0===t){var e=this.bounds();t=Math.max(Math.abs(e.minX),Math.abs(e.maxX))}if(t<.001)return 2*Math.abs(this.eval(1e-15));var n=this.coefs.length-1,r=this.coefs[n];return 10*1e-15*this.coefs.reduce(function(e,n,i){var a=n/r*Math.pow(t,i);return a>e?a:e},0)}},{key:"boundsUpperRealFujiwara",value:function(){var t=this.coefs,e=t.length-1,n=t[e];1!==n&&(t=this.coefs.map(function(t){return t/n}));var r,i=t.map(function(t,n){return n<e?Math.pow(Math.abs(0===n?t/2:t),1/(e-n)):t}),a=function(t,e,n){return r(n)&&(t.max<e?(t.nearmax=t.max,t.max=e):t.nearmax<e&&(t.nearmax=e)),t};r=function(n){return n<e&&t[n]<0};var s=i.reduce(a,{max:0,nearmax:0});return r=function(n){return n<e&&(e%2==n%2?t[n]<0:t[n]>0)},{negX:-2*i.reduce(a,{max:0,nearmax:0}).max,posX:2*s.max}}},{key:"boundsLowerRealFujiwara",value:function(){var e=new t;e.coefs=this.coefs.slice().reverse();var n=e.boundsUpperRealFujiwara();return n.negX=1/n.negX,n.posX=1/n.posX,n}},{key:"bounds",value:function(){var t=this.boundsUpperRealFujiwara(),e={minX:t.negX,maxX:t.posX};return 0===t.negX&&0===t.posX?e:(0===t.negX?e.minX=this.boundsLowerRealFujiwara().posX:0===t.posX&&(e.maxX=this.boundsLowerRealFujiwara().negX),e.minX>e.maxX&&(e.minX=e.maxX=0),e)}},{key:"boundUpperAbsRouche",value:function(){var t=this.coefs,e=t.length-1;return 1+t.reduce(function(t,n,r){return r!==e&&t<(n=Math.abs(n))?n:t},0)/Math.abs(t[e])}},{key:"boundLowerAbsRouche",value:function(){var t=this.coefs,e=t.reduce(function(t,e,n){return 0!==n&&t<(e=Math.abs(e))?e:t},0);return Math.abs(t[0])/(Math.abs(t[0])+e)}},{key:"boundsRealLaguerre",value:function(){var t=this.coefs,e=t.length-1,n=-t[e-1]/(e*t[e]),r=t[e-1]*t[e-1]-2*e/(e-1)*t[e]*t[e-2],i=(e-1)/(e*t[e])*Math.sqrt(r);return i<0&&(i=-i),{minX:n-i,maxX:n+i}}},{key:"countRootsDescartes",value:function(){var t=this.coefs,e=t.length-1,n=t.reduce(function(t,e,n){return 0!==t.prev_a&&0!==e&&(t.prev_a<0==e>0&&t.pos++,n%2==0!=t.prev_a<0==(n%2==1!=e>0)&&t.neg++),t.prev_a=e,t},{pos:0,neg:0,prev_a:0});return{maxRealPos:n.pos,maxRealNeg:n.neg,minComplex:e-(n.pos+n.neg)}}},{key:"getDegree",value:function(){return this.coefs.length-1}},{key:"getDerivative",value:function(){for(var e=new t,n=1;n<this.coefs.length;n++)e.coefs.push(n*this.coefs[n]);return e}},{key:"getRoots",value:function(){var t;switch(this.simplifyEquals(),this.getDegree()){case 0:t=[];break;case 1:t=this.getLinearRoot();break;case 2:t=this.getQuadraticRoots();break;case 3:t=this.getCubicRoots();break;case 4:t=this.getQuarticRoots();break;default:t=[]}return t}},{key:"getRootsInInterval",value:function(t,e){var n=[];function r(t){"number"==typeof t&&n.push(t)}if(0===this.getDegree())throw new RangeError("Unexpected empty polynomial");if(1===this.getDegree())r(this.bisection(t,e));else{var i=this.getDerivative().getRootsInInterval(t,e);if(i.length>0){r(this.bisection(t,i[0]));for(var a=0;a<=i.length-2;a++)r(this.bisection(i[a],i[a+1]));r(this.bisection(i[i.length-1],e))}else r(this.bisection(t,e))}return n}},{key:"getLinearRoot",value:function(){var t=[],e=this.coefs[1];return 0!==e&&t.push(-this.coefs[0]/e),t}},{key:"getQuadraticRoots",value:function(){var t=[];if(2===this.getDegree()){var e=this.coefs[2],n=this.coefs[1]/e,r=n*n-4*(this.coefs[0]/e);if(r>0){var i=Math.sqrt(r);t.push(.5*(-n+i)),t.push(.5*(-n-i))}else 0===r&&t.push(.5*-n)}return t}},{key:"getCubicRoots",value:function(){var t=[];if(3===this.getDegree()){var e=this.coefs[3],n=this.coefs[2]/e,r=this.coefs[1]/e,i=(3*r-n*n)/3,a=(2*n*n*n-9*r*n+27*(this.coefs[0]/e))/27,s=n/3,o=a*a/4+i*i*i/27,u=a/2,l=this.zeroErrorEstimate();if(Math.abs(o)<=l&&(o=0),o>0){var c,h=Math.sqrt(o),y=-u+h;c=y>=0?Math.pow(y,1/3):-Math.pow(-y,1/3),(y=-u-h)>=0?c+=Math.pow(y,1/3):c-=Math.pow(-y,1/3),t.push(c-s)}else if(o<0){var p=Math.sqrt(-i/3),f=Math.atan2(Math.sqrt(-o),-u)/3,x=Math.cos(f),d=Math.sin(f),v=Math.sqrt(3);t.push(2*p*x-s),t.push(-p*(x+v*d)-s),t.push(-p*(x-v*d)-s)}else{var m;m=u>=0?-Math.pow(u,1/3):Math.pow(-u,1/3),t.push(2*m-s),t.push(-m-s)}}return t}},{key:"getQuarticRoots",value:function(){var e=[],n=this.getDegree();if(4===n){var r=new t;r.coefs=this.coefs.slice(),r.divideEqualsScalar(r.coefs[n]);Math.abs(r.coefs[0])<10*1e-15*Math.abs(r.coefs[3])&&(r.coefs[0]=0);for(var i=r.getDerivative(),a=i.getRoots().sort(function(t,e){return t-e}),s=[],o=a.length-1,u=this.bounds(),c=Math.max(Math.abs(u.minX),Math.abs(u.maxX)),h=this.zeroErrorEstimate(c),y=0;y<=o;y++)s.push(r.eval(a[y]));for(var p=0;p<=o;p++)Math.abs(s[p])<h&&(s[p]=0);var f=0,x=Math.max(.1*(u.maxX-u.minX)/n,1e-15),d=[],v=[];if(o>-1){for(0!==s[0]?l(s[0])!==l(r.eval(a[0]-x)-s[0])&&(d.push(a[0]-x),v.push([u.minX,a[0]])):(e.push(a[0],a[0]),f++);f<o;f++)0===s[f+1]?(e.push(a[f+1],a[f+1]),f++):l(s[f])!==l(s[f+1])&&(d.push((a[f]+a[f+1])/2),v.push([a[f],a[f+1]]));0!==s[o]&&l(s[o])!==l(r.eval(a[o]+x)-s[o])&&(d.push(a[o]+x),v.push([a[o],u.maxX]))}var m=function(t){return r.eval(t)},b=function(t){return i.eval(t)};if(d.length>0)for(f=0;f<d.length;f++)d[f]=t.newtonSecantBisection(d[f],m,b,32,v[f][0],v[f][1]);e=e.concat(d)}return e}}],[{key:"interpolate",value:function(t,e,n,r,i){if(t.constructor!==Array||e.constructor!==Array)throw new TypeError("xs and ys must be arrays");if(isNaN(n)||isNaN(r)||isNaN(i))throw new TypeError("n, offset, and x must be numbers");var a,s,o=0,u=new Array(n),l=new Array(n),c=0,h=Math.abs(i-t[r]);for(a=0;a<n;a++){var y=Math.abs(i-t[r+a]);y<h&&(c=a,h=y),u[a]=l[a]=e[r+a]}s=e[r+c],c--;for(var p=1;p<n;p++){for(a=0;a<n-p;a++){var f=t[r+a]-i,x=t[r+a+p]-i,d=u[a+1]-l[a],v=f-x;if(0===v)throw new RangeError("Unable to interpolate polynomial. Two numbers in n were identical (to within roundoff)");v=d/v,l[a]=x*v,u[a]=f*v}s+=o=2*(c+1)<n-p?u[c+1]:l[c--]}return{y:s,dy:o}}},{key:"newtonSecantBisection",value:function(t,e,n,r,i,a){var s,o,u,c,h,y,p,f=0,x=0;s=t;var d=Math.pow(10,-14),v="number"==typeof i&&"number"==typeof a;if(v){if(i>a)throw new RangeError("Min must be greater than max");if(y=e(i),p=e(a),l(y)===l(p))throw new RangeError("Y values of bounds must be of opposite sign")}for(var m=function(){return Math.abs(u)<=d*Math.abs(s)||x===s-u-s},b=0;b<r;b++){if(0===(o=n(s))){if(0===f)throw new RangeError("df(x) is zero");o=f}if(f=o,h=e(s),c=s-(u=h/o),m())break;if(v){if(l(h)===l(p))a=s,p=h;else{if(l(h)!==l(y)){s=c;break}i=s,y=h}if(c<i||c>a){if(l(y)===l(p))break;var w=p-y,g=a-i;if(u=0===w?s-(i+.5*g):Math.abs(w/Math.min(y,p))>50?s-(i+g*(.5+(Math.abs(y)<Math.abs(p)?-.25:.25))):s-(i-y/w*g),c=s-u,m())break}}x=s-c,s=c}return s}}]),t}(),h=function(){function t(n,r){if(e(this,t),n in f==!1)throw new TypeError("Unrecognized shape type: '".concat(n,"'"));if(-1!==p[n]&&p[n]!==r.length)throw new RangeError("expected ".concat(p[n]," arguments, found ").concat(r.length));this.name=n,this.args=r}return r(t,null,[{key:"fromObject",value:function(e){if("type"in e==!1)throw new TypeError("Missing required 'type' property in object");if("string"!=typeof e.type)throw new TypeError("Expected string value for 'type' property");var n=e.type.length>0?e.type[0].toUpperCase()+e.type.slice(1).toLowerCase():null;if(null===n||n in f==!1)throw new TypeError("Unrecognized shape type: '".concat(e.type,"'"));var r=f[n],i=y[r].properties,a=i.filter(function(t){return t.name in e==!1});if(a.length>0){var o=a.map(function(t){return t.name}).join(", ");throw new TypeError("Missing required properties for ".concat(n,": ").concat(o))}var u=i.filter(function(n){var r=n.name,i=n.type,a=e[r];switch(i){case"Array":if(!1===Array.isArray(a))return!0;var o=!0,u=!1,l=void 0;try{for(var c,h=a[Symbol.iterator]();!(o=(c=h.next()).done);o=!0){var y=c.value;switch(n.elementType){case"Point2D":if(y instanceof s==!1)return!0;break;case"ShapeInfo":if(y instanceof t==!1)return!0;break;default:return!0}}}catch(t){u=!0,l=t}finally{try{o||null==h.return||h.return()}finally{if(u)throw l}}return!1;case"Number":return"number"!=typeof a;case"Point2D":return a instanceof s==!1;case null:default:return!1}});if(u.length>0){var l=u.map(function(t){var e="Array"===t.type?"Array<".concat(t.elementType,">"):t.type;return"  '".concat(t.name,"' should be ").concat(e)}).join("\n");throw 1===u.length?new TypeError("The following property has an invalid type:\n".concat(l)):new TypeError("The following properties have invalid types:\n".concat(l))}return new t(n,i.map(function(t){return e[t.name]}))}}]),t}(),y={ARC:{name:"Arc",properties:[{name:"center",type:"Point2D"},{name:"radiusX",type:"Number"},{name:"radiusY",type:"Number"},{name:"startRadians",type:"Number"},{name:"endRadians",type:"Number"}],argCount:5},QUADRATIC_BEZIER:{name:"Bezier2",properties:[{name:"p1",type:"Point2D"},{name:"p2",type:"Point2D"},{name:"p3",type:"Point2D"}],argCount:3},CUBIC_BEZIER:{name:"Bezier3",properties:[{name:"p1",type:"Point2D"},{name:"p2",type:"Point2D"},{name:"p3",type:"Point2D"},{name:"p4",type:"Point2D"}],argCount:4},CIRCLE:{name:"Circle",properties:[{name:"center",type:"Point2D"},{name:"radius",type:"Number"}],argCount:2},ELLIPSE:{name:"Ellipse",properties:[{name:"center",type:"Point2D"},{name:"radiusX",type:"Number"},{name:"radiusY",type:"Number"}],argCount:3},LINE:{name:"Line",properties:[{name:"p1",type:"Point2D"},{name:"p2",type:"Point2D"}],argCount:2},PATH:{name:"Path",properties:[{name:"segments",type:"Array",elementType:"ShapeInfo"}],argCount:-1},POLYGON:{name:"Polygon",properties:[{name:"points",type:"Array",elementType:"Point2D"}],argCount:-1},POLYLINE:{name:"Polyline",properties:[{name:"points",type:"Array",elementType:"Point2D"}],argCount:-1},RECTANGLE:{name:"Rectangle",properties:[{name:"topLeft",type:"Point2D"},{name:"bottomRight",type:"Point2D"}],argCount:2}},p={},f={};for(var x in y){var d=y[x],v=d.name,m=d.argCount;h[x]=v,p[v]=m,f[v]=x}var b=2*Math.PI,w=new o(1,0);function g(t){return null==t}function E(t){var e=t%b;return e<0?e+b:e}function k(t,e,n,r,i,a){if(0===t.points.length)return t;var s=new P("No Intersection"),u=E(i),l=E(a);l<u&&(l+=b),console.log("[startRadians = ".concat(i," endRadians = ").concat(a,"]")),console.log("[startNormal = ".concat(u," endRadians = ").concat(l,"]"));var c=!0,h=!1,y=void 0;try{for(var p,f=t.points[Symbol.iterator]();!(c=(p=f.next()).done);c=!0){var x=p.value,d=E(w.angleBetween(o.fromPoints(e,x)));u<=d&&d<=l&&s.appendPoint(x)}}catch(t){h=!0,y=t}finally{try{c||null==f.return||f.return()}finally{if(h)throw y}}return s.points.length>0&&(s.status="Intersection"),s}function N(t){var e=t.slice();return e.push(t[0]),e}var P=function(){function t(n){e(this,t),this.init(n)}return r(t,[{key:"init",value:function(t){this.status=t,this.points=[]}},{key:"appendPoint",value:function(t){this.points.push(t)}},{key:"appendPoints",value:function(t){this.points=this.points.concat(t)}}],[{key:"intersect",value:function(e,n){var r;if(g(e)||g(n))r=new t("No Intersection");else if("Path"===e.name)r=t.intersectPathShape(e,n);else if("Path"===n.name)r=t.intersectPathShape(n,e);else if("Arc"===e.name)r=t.intersectArcShape(e,n);else if("Arc"===n.name)r=t.intersectArcShape(n,e);else{var i,a;if(e.name<n.name?(i="intersect"+e.name+n.name,a=e.args.concat(n.args)):(i="intersect"+n.name+e.name,a=n.args.concat(e.args)),!(i in t))throw new Error("Intersection not available: "+i);r=t[i].apply(null,a)}return r}},{key:"intersectPathShape",value:function(e,n){var r=new t("No Intersection"),i=!0,a=!1,s=void 0;try{for(var o,u=e.args[Symbol.iterator]();!(i=(o=u.next()).done);i=!0){var l=o.value,c=t.intersect(l,n);r.appendPoints(c.points)}}catch(t){a=!0,s=t}finally{try{i||null==u.return||u.return()}finally{if(a)throw s}}return r.points.length>0&&(r.status="Intersection"),r}},{key:"intersectArcShape",value:function(e,n){var r=i(e.args,5),a=r[0],s=r[1],o=r[2],u=r[3],l=r[4],c=new h(h.ELLIPSE,[a,s,o]);return k(t.intersect(c,n),a,0,0,u,l)}},{key:"intersectBezier2Bezier2",value:function(e,n,r,i,a,o){var u,l,h=new t("No Intersection");u=n.multiply(-2);var y=e.add(u.add(r));u=e.multiply(-2),l=n.multiply(2);var p=u.add(l),f=new s(e.x,e.y);u=a.multiply(-2);var x=i.add(u.add(o));u=i.multiply(-2),l=a.multiply(2);var d=u.add(l),v=new s(i.x,i.y);u=y.x*p.y-p.x*y.y,l=x.x*p.y-p.x*x.y;var m=d.x*p.y-p.x*d.y,b=p.x*(f.y-v.y)+p.y*(-f.x+v.x),w=x.x*y.y-y.x*x.y,g=d.x*y.y-y.x*d.y,E=y.x*(f.y-v.y)+y.y*(-f.x+v.x),k=new c(-w*w,-2*w*g,u*l-g*g-2*w*E,u*m-2*g*E,u*b-E*E).getRoots(),N=!0,P=!1,M=void 0;try{for(var I,T=k[Symbol.iterator]();!(N=(I=T.next()).done);N=!0){var R=I.value;if(0<=R&&R<=1){var X=new c(y.x,p.x,f.x-v.x-R*d.x-R*R*x.x);X.simplifyEquals();var C=X.getRoots(),S=new c(y.y,p.y,f.y-v.y-R*d.y-R*R*x.y);S.simplifyEquals();var L=S.getRoots();if(C.length>0&&L.length>0){var A=!0,Y=!1,D=void 0;try{t:for(var B,z=C[Symbol.iterator]();!(A=(B=z.next()).done);A=!0){var q=B.value;if(0<=q&&q<=1)for(var V=0;V<L.length;V++)if(Math.abs(q-L[V])<1e-4){h.points.push(x.multiply(R*R).add(d.multiply(R).add(v)));break t}}}catch(t){Y=!0,D=t}finally{try{A||null==z.return||z.return()}finally{if(Y)throw D}}}}}}catch(t){P=!0,M=t}finally{try{N||null==T.return||T.return()}finally{if(P)throw M}}return h.points.length>0&&(h.status="Intersection"),h}},{key:"intersectBezier2Bezier3",value:function(e,n,r,i,a,o,u){var l,h,y,p,f=new t("No Intersection");l=n.multiply(-2);var x=e.add(l.add(r));l=e.multiply(-2),h=n.multiply(2);var d=l.add(h),v=new s(e.x,e.y);l=i.multiply(-1),h=a.multiply(3),y=o.multiply(-3),p=l.add(h.add(y.add(u)));var m=new s(p.x,p.y);l=i.multiply(3),h=a.multiply(-6),y=o.multiply(3),p=l.add(h.add(y));var b=new s(p.x,p.y);l=i.multiply(-3),h=a.multiply(3),y=l.add(h);var w=new s(y.x,y.y),g=new s(i.x,i.y),E=v.x*v.x,k=v.y*v.y,N=d.x*d.x,P=d.y*d.y,M=x.x*x.x,I=x.y*x.y,T=g.x*g.x,R=g.y*g.y,X=w.x*w.x,C=w.y*w.y,S=b.x*b.x,L=b.y*b.y,A=m.x*m.x,Y=m.y*m.y,D=new c(-2*x.x*x.y*m.x*m.y+M*Y+I*A,-2*x.x*x.y*b.x*m.y-2*x.x*x.y*b.y*m.x+2*I*b.x*m.x+2*M*b.y*m.y,-2*x.x*w.x*x.y*m.y-2*x.x*x.y*w.y*m.x-2*x.x*x.y*b.x*b.y+2*w.x*I*m.x+I*S+M*(2*w.y*m.y+L),2*v.x*x.x*x.y*m.y+2*v.y*x.x*x.y*m.x+d.x*d.y*x.x*m.y+d.x*d.y*x.y*m.x-2*g.x*x.x*x.y*m.y-2*x.x*g.y*x.y*m.x-2*x.x*w.x*x.y*b.y-2*x.x*x.y*w.y*b.x-2*v.x*I*m.x-2*v.y*M*m.y+2*g.x*I*m.x+2*w.x*I*b.x-P*x.x*m.x-N*x.y*m.y+M*(2*g.y*m.y+2*w.y*b.y),2*v.x*x.x*x.y*b.y+2*v.y*x.x*x.y*b.x+d.x*d.y*x.x*b.y+d.x*d.y*x.y*b.x-2*g.x*x.x*x.y*b.y-2*x.x*g.y*x.y*b.x-2*x.x*w.x*x.y*w.y-2*v.x*I*b.x-2*v.y*M*b.y+2*g.x*I*b.x-P*x.x*b.x-N*x.y*b.y+X*I+M*(2*g.y*b.y+C),2*v.x*x.x*x.y*w.y+2*v.y*x.x*w.x*x.y+d.x*d.y*x.x*w.y+d.x*d.y*w.x*x.y-2*g.x*x.x*x.y*w.y-2*x.x*g.y*w.x*x.y-2*v.x*w.x*I-2*v.y*M*w.y+2*g.x*w.x*I-P*x.x*w.x-N*x.y*w.y+2*M*g.y*w.y,-2*v.x*v.y*x.x*x.y-v.x*d.x*d.y*x.y-v.y*d.x*d.y*x.x+2*v.x*x.x*g.y*x.y+2*v.y*g.x*x.x*x.y+d.x*g.x*d.y*x.y+d.x*d.y*x.x*g.y-2*g.x*x.x*g.y*x.y-2*v.x*g.x*I+v.x*P*x.x+v.y*N*x.y-2*v.y*M*g.y-g.x*P*x.x-N*g.y*x.y+E*I+k*M+T*I+M*R).getRootsInInterval(0,1),B=!0,z=!1,q=void 0;try{for(var V,O=D[Symbol.iterator]();!(B=(V=O.next()).done);B=!0){var _=V.value,U=new c(x.x,d.x,v.x-g.x-_*w.x-_*_*b.x-_*_*_*m.x).getRoots(),G=new c(x.y,d.y,v.y-g.y-_*w.y-_*_*b.y-_*_*_*m.y).getRoots();if(U.length>0&&G.length>0){var Q=!0,F=!1,j=void 0;try{t:for(var H,Z=U[Symbol.iterator]();!(Q=(H=Z.next()).done);Q=!0){var $=H.value;if(0<=$&&$<=1)for(var K=0;K<G.length;K++)if(Math.abs($-G[K])<1e-4){f.points.push(m.multiply(_*_*_).add(b.multiply(_*_).add(w.multiply(_).add(g))));break t}}}catch(t){F=!0,j=t}finally{try{Q||null==Z.return||Z.return()}finally{if(F)throw j}}}}}catch(t){z=!0,q=t}finally{try{B||null==O.return||O.return()}finally{if(z)throw q}}return f.points.length>0&&(f.status="Intersection"),f}},{key:"intersectBezier2Circle",value:function(e,n,r,i,a){return t.intersectBezier2Ellipse(e,n,r,i,a,a)}},{key:"intersectBezier2Ellipse",value:function(e,n,r,i,a,o){var u,l=new t("No Intersection");u=n.multiply(-2);var h=e.add(u.add(r));u=e.multiply(-2);var y=n.multiply(2),p=u.add(y),f=new s(e.x,e.y),x=a*a,d=o*o,v=new c(d*h.x*h.x+x*h.y*h.y,2*(d*h.x*p.x+x*h.y*p.y),d*(2*h.x*f.x+p.x*p.x)+x*(2*h.y*f.y+p.y*p.y)-2*(d*i.x*h.x+x*i.y*h.y),2*(d*p.x*(f.x-i.x)+x*p.y*(f.y-i.y)),d*(f.x*f.x+i.x*i.x)+x*(f.y*f.y+i.y*i.y)-2*(d*i.x*f.x+x*i.y*f.y)-x*d).getRoots(),m=!0,b=!1,w=void 0;try{for(var g,E=v[Symbol.iterator]();!(m=(g=E.next()).done);m=!0){var k=g.value;0<=k&&k<=1&&l.points.push(h.multiply(k*k).add(p.multiply(k).add(f)))}}catch(t){b=!0,w=t}finally{try{m||null==E.return||E.return()}finally{if(b)throw w}}return l.points.length>0&&(l.status="Intersection"),l}},{key:"intersectBezier2Line",value:function(e,n,r,i,a){var u,l=i.min(a),h=i.max(a),y=new t("No Intersection");u=n.multiply(-2);var p=e.add(u.add(r));u=e.multiply(-2);var f=n.multiply(2),x=u.add(f),d=new s(e.x,e.y),v=new o(i.y-a.y,a.x-i.x),m=i.x*a.y-a.x*i.y,b=new c(v.dot(p),v.dot(x),v.dot(d)+m).getRoots(),w=!0,g=!1,E=void 0;try{for(var k,N=b[Symbol.iterator]();!(w=(k=N.next()).done);w=!0){var P=k.value;if(0<=P&&P<=1){var M=e.lerp(n,P),I=n.lerp(r,P),T=M.lerp(I,P);i.x===a.x?l.y<=T.y&&T.y<=h.y&&(y.status="Intersection",y.appendPoint(T)):i.y===a.y?l.x<=T.x&&T.x<=h.x&&(y.status="Intersection",y.appendPoint(T)):l.x<=T.x&&T.x<=h.x&&l.y<=T.y&&T.y<=h.y&&(y.status="Intersection",y.appendPoint(T))}}}catch(t){g=!0,E=t}finally{try{w||null==N.return||N.return()}finally{if(g)throw E}}return y}},{key:"intersectBezier2Polygon",value:function(e,n,r,i){return t.intersectBezier2Polyline(e,n,r,N(i))}},{key:"intersectBezier2Polyline",value:function(e,n,r,i){for(var a=new t("No Intersection"),s=i.length,o=0;o<s-1;o++){var u=i[o],l=i[o+1],c=t.intersectBezier2Line(e,n,r,u,l);a.appendPoints(c.points)}return a.points.length>0&&(a.status="Intersection"),a}},{key:"intersectBezier2Rectangle",value:function(e,n,r,i,a){var o=i.min(a),u=i.max(a),l=new s(u.x,o.y),c=new s(o.x,u.y),h=t.intersectBezier2Line(e,n,r,o,l),y=t.intersectBezier2Line(e,n,r,l,u),p=t.intersectBezier2Line(e,n,r,u,c),f=t.intersectBezier2Line(e,n,r,c,o),x=new t("No Intersection");return x.appendPoints(h.points),x.appendPoints(y.points),x.appendPoints(p.points),x.appendPoints(f.points),x.points.length>0&&(x.status="Intersection"),x}},{key:"intersectBezier3Bezier3",value:function(e,n,r,i,a,o,u,l){var h,y,p,f,x=new t("No Intersection");h=e.multiply(-1),y=n.multiply(3),p=r.multiply(-3),f=h.add(y.add(p.add(i)));var d=new s(f.x,f.y);h=e.multiply(3),y=n.multiply(-6),p=r.multiply(3),f=h.add(y.add(p));var v=new s(f.x,f.y);h=e.multiply(-3),y=n.multiply(3),p=h.add(y);var m=new s(p.x,p.y),b=new s(e.x,e.y);h=a.multiply(-1),y=o.multiply(3),p=u.multiply(-3),f=h.add(y.add(p.add(l)));var w=new s(f.x,f.y);h=a.multiply(3),y=o.multiply(-6),p=u.multiply(3),f=h.add(y.add(p));var g=new s(f.x,f.y);h=a.multiply(-3),y=o.multiply(3),p=h.add(y);var E=new s(p.x,p.y),k=new s(a.x,a.y);h=d.x*v.y-v.x*d.y,y=d.x*m.y-m.x*d.y;var N=d.x*b.y-b.x*d.y+k.x*d.y-d.x*k.y,P=E.x*d.y-d.x*E.y,M=g.x*d.y-d.x*g.y,I=w.x*d.y-d.x*w.y;f=d.x*m.y-m.x*d.y;var T=d.x*b.y+v.x*m.y-m.x*v.y-b.x*d.y+k.x*d.y-d.x*k.y,R=E.x*d.y-d.x*E.y,X=g.x*d.y-d.x*g.y,C=w.x*d.y-d.x*w.y,S=v.x*b.y-b.x*v.y+k.x*v.y-v.x*k.y,L=E.x*v.y-v.x*E.y,A=g.x*v.y-v.x*g.y,Y=w.x*v.y-v.x*w.y,D=d.x*b.y-b.x*d.y+k.x*d.y-d.x*k.y,B=E.x*d.y-d.x*E.y,z=g.x*d.y-d.x*g.y,q=w.x*d.y-d.x*w.y,V=v.x*b.y-b.x*v.y+k.x*v.y-v.x*k.y,O=E.x*v.y-v.x*E.y,_=g.x*v.y-v.x*g.y,U=w.x*v.y-v.x*w.y,G=m.x*b.y-b.x*m.y+k.x*m.y-m.x*k.y,Q=E.x*m.y-m.x*E.y,F=g.x*m.y-m.x*g.y,j=w.x*m.y-m.x*w.y,H=new c(-I*C*q,-I*C*z-I*X*q-M*C*q,-I*C*B-I*X*z-M*C*z-I*R*q-M*X*q-P*C*q,-I*C*D-I*X*B-M*C*B-I*R*z-M*X*z-P*C*z-I*T*q-M*R*q-P*X*q-N*C*q+y*Y*q+I*f*U-h*Y*U+h*C*j,-I*X*D-M*C*D-I*R*B-M*X*B-P*C*B-I*T*z-M*R*z-P*X*z-N*C*z+y*Y*z-M*T*q-P*R*q-N*X*q+y*A*q+I*f*_-h*Y*_+M*f*U-h*A*U+h*C*F+h*X*j,-I*R*D-M*X*D-P*C*D-I*T*B-M*R*B-P*X*B-N*C*B+y*Y*B-M*T*z-P*R*z-N*X*z+y*A*z-P*T*q-N*R*q+y*L*q+I*f*O-h*Y*O+M*f*_-h*A*_+P*f*U-h*L*U+h*C*Q+h*X*F+h*R*j,-I*T*D-M*R*D-P*X*D-N*C*D+y*Y*D-M*T*B-P*R*B-N*X*B+y*A*B-P*T*z-N*R*z+y*L*z-N*T*q+y*S*q+I*f*V-h*Y*V+M*f*O-h*A*O+P*f*_-h*L*_+N*f*U-h*S*U+h*C*G+h*X*Q+h*R*F-y*f*j+h*T*j,-M*T*D-P*R*D-N*X*D+y*A*D-P*T*B-N*R*B+y*L*B-N*T*z+y*S*z+M*f*V-h*A*V+P*f*O-h*L*O+N*f*_-h*S*_+h*X*G+h*R*Q-y*f*F+h*T*F,-P*T*D-N*R*D+y*L*D-N*T*B+y*S*B+P*f*V-h*L*V+N*f*O-h*S*O+h*R*G-y*f*Q+h*T*Q,-N*T*D+y*S*D+N*f*V-h*S*V-y*f*G+h*T*G);H.simplifyEquals();var Z=H.getRootsInInterval(0,1),$=!0,K=!1,J=void 0;try{for(var W,tt=Z[Symbol.iterator]();!($=(W=tt.next()).done);$=!0){var et=W.value,nt=new c(d.x,v.x,m.x,b.x-k.x-et*E.x-et*et*g.x-et*et*et*w.x);nt.simplifyEquals();var rt=nt.getRoots(),it=new c(d.y,v.y,m.y,b.y-k.y-et*E.y-et*et*g.y-et*et*et*w.y);it.simplifyEquals();var at=it.getRoots();if(rt.length>0&&at.length>0){var st=!0,ot=!1,ut=void 0;try{t:for(var lt,ct=rt[Symbol.iterator]();!(st=(lt=ct.next()).done);st=!0){var ht=lt.value;if(0<=ht&&ht<=1)for(var yt=0;yt<at.length;yt++)if(Math.abs(ht-at[yt])<1e-4){x.points.push(w.multiply(et*et*et).add(g.multiply(et*et).add(E.multiply(et).add(k))));break t}}}catch(t){ot=!0,ut=t}finally{try{st||null==ct.return||ct.return()}finally{if(ot)throw ut}}}}}catch(t){K=!0,J=t}finally{try{$||null==tt.return||tt.return()}finally{if(K)throw J}}return x.points.length>0&&(x.status="Intersection"),x}},{key:"intersectBezier3Circle",value:function(e,n,r,i,a,s){return t.intersectBezier3Ellipse(e,n,r,i,a,s,s)}},{key:"intersectBezier3Ellipse",value:function(e,n,r,i,a,o,u){var l,h,y,p,f=new t("No Intersection");l=e.multiply(-1),h=n.multiply(3),y=r.multiply(-3),p=l.add(h.add(y.add(i)));var x=new s(p.x,p.y);l=e.multiply(3),h=n.multiply(-6),y=r.multiply(3),p=l.add(h.add(y));var d=new s(p.x,p.y);l=e.multiply(-3),h=n.multiply(3),y=l.add(h);var v=new s(y.x,y.y),m=new s(e.x,e.y),b=o*o,w=u*u,g=new c(x.x*x.x*w+x.y*x.y*b,2*(x.x*d.x*w+x.y*d.y*b),2*(x.x*v.x*w+x.y*v.y*b)+d.x*d.x*w+d.y*d.y*b,2*x.x*w*(m.x-a.x)+2*x.y*b*(m.y-a.y)+2*(d.x*v.x*w+d.y*v.y*b),2*d.x*w*(m.x-a.x)+2*d.y*b*(m.y-a.y)+v.x*v.x*w+v.y*v.y*b,2*v.x*w*(m.x-a.x)+2*v.y*b*(m.y-a.y),m.x*m.x*w-2*m.y*a.y*b-2*m.x*a.x*w+m.y*m.y*b+a.x*a.x*w+a.y*a.y*b-b*w).getRootsInInterval(0,1),E=!0,k=!1,N=void 0;try{for(var P,M=g[Symbol.iterator]();!(E=(P=M.next()).done);E=!0){var I=P.value;f.points.push(x.multiply(I*I*I).add(d.multiply(I*I).add(v.multiply(I).add(m))))}}catch(t){k=!0,N=t}finally{try{E||null==M.return||M.return()}finally{if(k)throw N}}return f.points.length>0&&(f.status="Intersection"),f}},{key:"intersectBezier3Line",value:function(e,n,r,i,a,s){var u,l,h,y,p=a.min(s),f=a.max(s),x=new t("No Intersection");u=e.multiply(-1),l=n.multiply(3),h=r.multiply(-3),y=u.add(l.add(h.add(i)));var d=new o(y.x,y.y);u=e.multiply(3),l=n.multiply(-6),h=r.multiply(3),y=u.add(l.add(h));var v=new o(y.x,y.y);u=e.multiply(-3),l=n.multiply(3),h=u.add(l);var m=new o(h.x,h.y),b=new o(e.x,e.y),w=new o(a.y-s.y,s.x-a.x),g=a.x*s.y-s.x*a.y,E=new c(w.dot(d),w.dot(v),w.dot(m),w.dot(b)+g).getRoots(),k=!0,N=!1,P=void 0;try{for(var M,I=E[Symbol.iterator]();!(k=(M=I.next()).done);k=!0){var T=M.value;if(0<=T&&T<=1){var R=e.lerp(n,T),X=n.lerp(r,T),C=r.lerp(i,T),S=R.lerp(X,T),L=X.lerp(C,T),A=S.lerp(L,T);a.x===s.x?p.y<=A.y&&A.y<=f.y&&(x.status="Intersection",x.appendPoint(A)):a.y===s.y?p.x<=A.x&&A.x<=f.x&&(x.status="Intersection",x.appendPoint(A)):p.x<=A.x&&A.x<=f.x&&p.y<=A.y&&A.y<=f.y&&(x.status="Intersection",x.appendPoint(A))}}}catch(t){N=!0,P=t}finally{try{k||null==I.return||I.return()}finally{if(N)throw P}}return x}},{key:"intersectBezier3Polygon",value:function(e,n,r,i,a){return t.intersectBezier3Polyline(e,n,r,i,N(a))}},{key:"intersectBezier3Polyline",value:function(e,n,r,i,a){for(var s=new t("No Intersection"),o=a.length,u=0;u<o-1;u++){var l=a[u],c=a[u+1],h=t.intersectBezier3Line(e,n,r,i,l,c);s.appendPoints(h.points)}return s.points.length>0&&(s.status="Intersection"),s}},{key:"intersectBezier3Rectangle",value:function(e,n,r,i,a,o){var u=a.min(o),l=a.max(o),c=new s(l.x,u.y),h=new s(u.x,l.y),y=t.intersectBezier3Line(e,n,r,i,u,c),p=t.intersectBezier3Line(e,n,r,i,c,l),f=t.intersectBezier3Line(e,n,r,i,l,h),x=t.intersectBezier3Line(e,n,r,i,h,u),d=new t("No Intersection");return d.appendPoints(y.points),d.appendPoints(p.points),d.appendPoints(f.points),d.appendPoints(x.points),d.points.length>0&&(d.status="Intersection"),d}},{key:"intersectCircleCircle",value:function(e,n,r,i){var a,o=n+i,u=Math.abs(n-i),l=e.distanceFrom(r);if(l>o)a=new t("Outside");else if(l<u)a=new t("Inside");else{a=new t("Intersection");var c=(n*n-i*i+l*l)/(2*l),h=Math.sqrt(n*n-c*c),y=e.lerp(r,c/l),p=h/l;a.points.push(new s(y.x-p*(r.y-e.y),y.y+p*(r.x-e.x))),a.points.push(new s(y.x+p*(r.y-e.y),y.y-p*(r.x-e.x)))}return a}},{key:"intersectCircleEllipse",value:function(e,n,r,i,a){return t.intersectEllipseEllipse(e,n,n,r,i,a)}},{key:"intersectCircleLine",value:function(e,n,r,i){var a,s=(i.x-r.x)*(i.x-r.x)+(i.y-r.y)*(i.y-r.y),o=2*((i.x-r.x)*(r.x-e.x)+(i.y-r.y)*(r.y-e.y)),u=o*o-4*s*(e.x*e.x+e.y*e.y+r.x*r.x+r.y*r.y-2*(e.x*r.x+e.y*r.y)-n*n);if(u<0)a=new t("Outside");else if(0===u)a=new t("Tangent");else{var l=Math.sqrt(u),c=(-o+l)/(2*s),h=(-o-l)/(2*s);(c<0||c>1)&&(h<0||h>1)?a=new t(c<0&&h<0||c>1&&h>1?"Outside":"Inside"):(a=new t("Intersection"),0<=c&&c<=1&&a.points.push(r.lerp(i,c)),0<=h&&h<=1&&a.points.push(r.lerp(i,h)))}return a}},{key:"intersectCirclePolygon",value:function(e,n,r){return t.intersectCirclePolyline(e,n,N(r))}},{key:"intersectCirclePolyline",value:function(e,n,r){for(var i,a=new t("No Intersection"),s=r.length,o=0;o<s-1;o++){var u=r[o],l=r[o+1];i=t.intersectCircleLine(e,n,u,l),a.appendPoints(i.points)}return a.points.length>0?a.status="Intersection":a.status=i.status,a}},{key:"intersectCircleRectangle",value:function(e,n,r,i){var a=r.min(i),o=r.max(i),u=new s(o.x,a.y),l=new s(a.x,o.y),c=t.intersectCircleLine(e,n,a,u),h=t.intersectCircleLine(e,n,u,o),y=t.intersectCircleLine(e,n,o,l),p=t.intersectCircleLine(e,n,l,a),f=new t("No Intersection");return f.appendPoints(c.points),f.appendPoints(h.points),f.appendPoints(y.points),f.appendPoints(p.points),f.points.length>0?f.status="Intersection":f.status=c.status,f}},{key:"intersectEllipseEllipse",value:function(e,n,r,i,a,o){for(var u,l,h,y,p,f,x,d,v,m,b,w,g,E,k,N=[r*r,0,n*n,-2*r*r*e.x,-2*n*n*e.y,r*r*e.x*e.x+n*n*e.y*e.y-n*n*r*r],P=[o*o,0,a*a,-2*o*o*i.x,-2*a*a*i.y,o*o*i.x*i.x+a*a*i.y*i.y-a*a*o*o],M=(l=P,h=(u=N)[0]*l[1]-l[0]*u[1],y=u[0]*l[2]-l[0]*u[2],p=u[0]*l[3]-l[0]*u[3],f=u[0]*l[4]-l[0]*u[4],x=u[0]*l[5]-l[0]*u[5],d=u[1]*l[2]-l[1]*u[2],v=u[1]*l[4]-l[1]*u[4],m=u[1]*l[5]-l[1]*u[5],b=u[2]*l[3]-l[2]*u[3],w=u[3]*l[4]-l[3]*u[4],g=u[3]*l[5]-l[3]*u[5],new c(h*d-y*y,h*(k=v-b)+p*d-2*y*f,h*(E=m+w)+p*k-f*f-2*y*x,h*g+p*E-2*f*x,p*g-x*x)).getRoots(),I=.001*(N[0]*N[0]+2*N[1]*N[1]+N[2]*N[2]),T=.001*(P[0]*P[0]+2*P[1]*P[1]+P[2]*P[2]),R=new t("No Intersection"),X=0;X<M.length;X++)for(var C=new c(N[0],N[3]+M[X]*N[1],N[5]+M[X]*(N[4]+M[X]*N[2])).getRoots(),S=0;S<C.length;S++){var L=(N[0]*C[S]+N[1]*M[X]+N[3])*C[S]+(N[2]*M[X]+N[4])*M[X]+N[5];Math.abs(L)<I&&(L=(P[0]*C[S]+P[1]*M[X]+P[3])*C[S]+(P[2]*M[X]+P[4])*M[X]+P[5],Math.abs(L)<T&&R.appendPoint(new s(C[S],M[X])))}return R.points.length>0&&(R.status="Intersection"),R}},{key:"intersectEllipseLine",value:function(e,n,r,i,a){var s,u=new o(i.x,i.y),l=o.fromPoints(i,a),c=new o(e.x,e.y),h=u.subtract(c),y=new o(l.x/(n*n),l.y/(r*r)),p=new o(h.x/(n*n),h.y/(r*r)),f=l.dot(y),x=l.dot(p),d=x*x-f*(e=h.dot(p)-1);if(d<0)s=new t("Outside");else if(d>0){var v=Math.sqrt(d),m=(-x-v)/f,b=(-x+v)/f;(m<0||1<m)&&(b<0||1<b)?s=new t(m<0&&b<0||m>1&&b>1?"Outside":"Inside"):(s=new t("Intersection"),0<=m&&m<=1&&s.appendPoint(i.lerp(a,m)),0<=b&&b<=1&&s.appendPoint(i.lerp(a,b)))}else{var w=-x/f;0<=w&&w<=1?(s=new t("Intersection")).appendPoint(i.lerp(a,w)):s=new t("Outside")}return s}},{key:"intersectEllipsePolygon",value:function(e,n,r,i){return t.intersectEllipsePolyline(e,n,r,N(i))}},{key:"intersectEllipsePolyline",value:function(e,n,r,i){for(var a=new t("No Intersection"),s=i.length,o=0;o<s-1;o++){var u=i[o],l=i[o+1],c=t.intersectEllipseLine(e,n,r,u,l);a.appendPoints(c.points)}return a.points.length>0&&(a.status="Intersection"),a}},{key:"intersectEllipseRectangle",value:function(e,n,r,i,a){var o=i.min(a),u=i.max(a),l=new s(u.x,o.y),c=new s(o.x,u.y),h=t.intersectEllipseLine(e,n,r,o,l),y=t.intersectEllipseLine(e,n,r,l,u),p=t.intersectEllipseLine(e,n,r,u,c),f=t.intersectEllipseLine(e,n,r,c,o),x=new t("No Intersection");return x.appendPoints(h.points),x.appendPoints(y.points),x.appendPoints(p.points),x.appendPoints(f.points),x.points.length>0&&(x.status="Intersection"),x}},{key:"intersectLineLine",value:function(e,n,r,i){var a,o=(i.x-r.x)*(e.y-r.y)-(i.y-r.y)*(e.x-r.x),u=(n.x-e.x)*(e.y-r.y)-(n.y-e.y)*(e.x-r.x),l=(i.y-r.y)*(n.x-e.x)-(i.x-r.x)*(n.y-e.y);if(0!==l){var c=o/l,h=u/l;0<=c&&c<=1&&0<=h&&h<=1?(a=new t("Intersection")).points.push(new s(e.x+c*(n.x-e.x),e.y+c*(n.y-e.y))):a=new t("No Intersection")}else a=new t(0===o||0===u?"Coincident":"Parallel");return a}},{key:"intersectLinePolygon",value:function(e,n,r){return t.intersectLinePolyline(e,n,N(r))}},{key:"intersectLinePolyline",value:function(e,n,r){for(var i=new t("No Intersection"),a=r.length,s=0;s<a-1;s++){var o=r[s],u=r[s+1],l=t.intersectLineLine(e,n,o,u);i.appendPoints(l.points)}return i.points.length>0&&(i.status="Intersection"),i}},{key:"intersectLineRectangle",value:function(e,n,r,i){var a=r.min(i),o=r.max(i),u=new s(o.x,a.y),l=new s(a.x,o.y),c=t.intersectLineLine(a,u,e,n),h=t.intersectLineLine(u,o,e,n),y=t.intersectLineLine(o,l,e,n),p=t.intersectLineLine(l,a,e,n),f=new t("No Intersection");return f.appendPoints(c.points),f.appendPoints(h.points),f.appendPoints(y.points),f.appendPoints(p.points),f.points.length>0&&(f.status="Intersection"),f}},{key:"intersectPolygonPolygon",value:function(e,n){return t.intersectPolylinePolyline(N(e),N(n))}},{key:"intersectPolygonPolyline",value:function(e,n){return t.intersectPolylinePolyline(N(e),n)}},{key:"intersectPolygonRectangle",value:function(e,n,r){return t.intersectPolylineRectangle(N(e),n,r)}},{key:"intersectPolylinePolyline",value:function(e,n){for(var r=new t("No Intersection"),i=e.length,a=0;a<i-1;a++){var s=e[a],o=e[a+1],u=t.intersectLinePolyline(s,o,n);r.appendPoints(u.points)}return r.points.length>0&&(r.status="Intersection"),r}},{key:"intersectPolylineRectangle",value:function(e,n,r){var i=n.min(r),a=n.max(r),o=new s(a.x,i.y),u=new s(i.x,a.y),l=t.intersectLinePolyline(i,o,e),c=t.intersectLinePolyline(o,a,e),h=t.intersectLinePolyline(a,u,e),y=t.intersectLinePolyline(u,i,e),p=new t("No Intersection");return p.appendPoints(l.points),p.appendPoints(c.points),p.appendPoints(h.points),p.appendPoints(y.points),p.points.length>0&&(p.status="Intersection"),p}},{key:"intersectRectangleRectangle",value:function(e,n,r,i){var a=e.min(n),o=e.max(n),u=new s(o.x,a.y),l=new s(a.x,o.y),c=t.intersectLineRectangle(a,u,r,i),h=t.intersectLineRectangle(u,o,r,i),y=t.intersectLineRectangle(o,l,r,i),p=t.intersectLineRectangle(l,a,r,i),f=new t("No Intersection");return f.appendPoints(c.points),f.appendPoints(h.points),f.appendPoints(y.points),f.appendPoints(p.points),f.points.length>0&&(f.status="Intersection"),f}},{key:"intersectRayRay",value:function(e,n,r,i){var a,o=(i.x-r.x)*(e.y-r.y)-(i.y-r.y)*(e.x-r.x),u=(n.x-e.x)*(e.y-r.y)-(n.y-e.y)*(e.x-r.x),l=(i.y-r.y)*(n.x-e.x)-(i.x-r.x)*(n.y-e.y);if(0!==l){var c=o/l;(a=new t("Intersection")).points.push(new s(e.x+c*(n.x-e.x),e.y+c*(n.y-e.y)))}else a=new t(0===o||0===u?"Coincident":"Parallel");return a}}]),t}(),M=function(){function t(n,r){e(this,t),this.type=n,this.text=r}return r(t,[{key:"typeis",value:function(t){return this.type===t}}]),t}();M.UNDEFINED=0,M.COMMAND=1,M.NUMBER=2,M.EOD=3;var I=function(){function t(n){e(this,t),null==n&&(n=""),this.setPathData(n)}return r(t,[{key:"setPathData",value:function(t){if("string"!=typeof t)throw new TypeError("The first parameter must be a string");this._pathData=t}},{key:"getNextToken",value:function(){for(var t=null,e=this._pathData;null===t;)if(null===e||""===e)t=new M(M.EOD,"");else if(e.match(/^([ \t\r\n,]+)/))e=e.substr(RegExp.$1.length);else if(e.match(/^([AaCcHhLlMmQqSsTtVvZz])/))t=new M(M.COMMAND,RegExp.$1),e=e.substr(RegExp.$1.length);else{if(!e.match(/^(([-+]?\d+(\.\d*)?|[-+]?\.\d+)([eE][-+]?\d+)?)/))throw new SyntaxError("Unrecognized path data: ".concat(e));t=new M(M.NUMBER,RegExp.$1),e=e.substr(RegExp.$1.length)}return this._pathData=e,t}}]),t}(),T=function(){function t(){e(this,t),this._lexer=new I,this._handler=null}return r(t,[{key:"parseData",value:function(e){if("string"!=typeof e)throw new TypeError("The first parameter must be a string: ".concat(e));null!==this._handler&&"function"==typeof this._handler.beginParse&&this._handler.beginParse();var n=this._lexer;n.setPathData(e);for(var r="BOP",i=null,a=n.getNextToken();!1===a.typeis(M.EOD);){var s=void 0,o=[];switch(a.type){case M.COMMAND:if("BOP"===r&&"M"!==a.text&&"m"!==a.text)throw new SyntaxError("New paths must begin with a moveto command. Found '".concat(a.text,"'"));r=a.text,s=t.PARAMCOUNT[a.text.toUpperCase()],a=n.getNextToken();break;case M.NUMBER:if("BOP"===r)throw new SyntaxError("New paths must begin with a moveto command. Found '".concat(a.text,"'"));s=t.PARAMCOUNT[r.toUpperCase()];break;default:throw new SyntaxError("Unrecognized command type: ".concat(a.type))}for(var u=0;u<s;u++){switch(a.type){case M.COMMAND:throw new SyntaxError("Parameter must be a number. Found '".concat(a.text,"'"));case M.NUMBER:o[u]=parseFloat(a.text);break;case M.EOD:throw new SyntaxError("Unexpected end of string");default:throw new SyntaxError("Unrecognized parameter type. Found type '".concat(a.type,"'"))}a=n.getNextToken()}if(null!==this._handler){var l=this._handler,c=t.METHODNAME[r];"a"!==r&&"A"!==r||(o[3]=0!==o[3],o[4]=0!==o[4]),null!==l&&"function"==typeof l[c]&&l[c].apply(l,o)}switch(r){case"M":r="L";break;case"m":r="l";break;case"Z":case"z":r="BOP"}if(a===i)throw new SyntaxError("Parser stalled on '".concat(a.text,"'"));i=a}null!==this._handler&&"function"==typeof this._handler.endParse&&this._handler.endParse()}},{key:"setHandler",value:function(t){this._handler=t}}]),t}();T.PARAMCOUNT={A:7,C:6,H:1,L:2,M:2,Q:4,S:4,T:2,V:1,Z:0},T.METHODNAME={A:"arcAbs",a:"arcRel",C:"curvetoCubicAbs",c:"curvetoCubicRel",H:"linetoHorizontalAbs",h:"linetoHorizontalRel",L:"linetoAbs",l:"linetoRel",M:"movetoAbs",m:"movetoRel",Q:"curvetoQuadraticAbs",q:"curvetoQuadraticRel",S:"curvetoCubicSmoothAbs",s:"curvetoCubicSmoothRel",T:"curvetoQuadraticSmoothAbs",t:"curvetoQuadraticSmoothRel",V:"linetoVerticalAbs",v:"linetoVerticalRel",Z:"closePath",z:"closePath"};var R=2*Math.PI;function X(t,e,n,r,i,a,s){i=i*Math.PI/180;var u=Math.cos(i),l=Math.sin(i),c=t.subtract(e).multiply(.5),h=c.x*u+c.y*l,y=c.x*-l+c.y*u,p=h*h,f=y*y,x=p/((n=Math.abs(n))*n)+f/((r=Math.abs(r))*r);if(x>1){var d=Math.sqrt(x);n*=d,r*=d}var v=n*n,m=r*r,b=v*f,w=m*p,g=(v*m-b-w)/(b+w);Math.abs(g)<1e-6&&(g=0);var E=Math.sqrt(g);a===s&&(E=-E);var k,N,P=t.add(e).multiply(.5),M=E*n*y/r,I=E*-r*h/n,T=(h-M)/n,X=(h+M)/n,C=(y-I)/r,S=(y+I)/r,L=new o(1,0).angleBetween(new o(T,C)),A=(k=new o(T,C).angleBetween(new o(-X,-S)),(N=k%R)<0?N+R:N);return!1===s&&(A-=R),[M*u-I*l+P.x,M*l+I*u+P.y,n,r,L,L+A]}var C=function(){function t(){e(this,t),this.shapes=[],this.firstX=null,this.firstY=null,this.lastX=null,this.lastY=null,this.lastCommand=null}return r(t,[{key:"beginParse",value:function(){this.shapes=[],this.firstX=null,this.firstY=null,this.lastX=null,this.lastY=null,this.lastCommand=null}},{key:"addShape",value:function(t){this.shapes.push(t)}},{key:"arcAbs",value:function(t,e,n,r,i,o,u){if(0===t||0===e)this.addShape(A.line(this.lastX,this.lastY,o,u));else{var l=X(new s(this.lastX,this.lastY),new s(o,u),t,e,n,r,i);this.addShape(A.arc.apply(A,a(l)))}this.lastCommand="A",this.lastX=o,this.lastY=u}},{key:"arcRel",value:function(t,e,n,r,i,o,u){if(0===t||0===e)this.addShape(A.line(this.lastX,this.lastY,this.lastX+o,this.lastY+u));else{var l=X(new s(this.lastX,this.lastY),new s(this.lastX+o,this.lastY+u),t,e,n,r,i);this.addShape(A.arc.apply(A,a(l)))}this.lastCommand="a",this.lastX+=o,this.lastY+=u}},{key:"curvetoCubicAbs",value:function(t,e,n,r,i,a){this.addShape(A.cubicBezier(this.lastX,this.lastY,t,e,n,r,i,a)),this.lastX=i,this.lastY=a,this.lastCommand="C"}},{key:"curvetoCubicRel",value:function(t,e,n,r,i,a){this.addShape(A.cubicBezier(this.lastX,this.lastY,this.lastX+t,this.lastY+e,this.lastX+n,this.lastY+r,this.lastX+i,this.lastY+a)),this.lastX+=i,this.lastY+=a,this.lastCommand="c"}},{key:"linetoHorizontalAbs",value:function(t){this.addShape(A.line(this.lastX,this.lastY,t,this.lastY)),this.lastX=t,this.lastCommand="H"}},{key:"linetoHorizontalRel",value:function(t){this.addShape(A.line(this.lastX,this.lastY,this.lastX+t,this.lastY)),this.lastX+=t,this.lastCommand="h"}},{key:"linetoAbs",value:function(t,e){this.addShape(A.line(this.lastX,this.lastY,t,e)),this.lastX=t,this.lastY=e,this.lastCommand="L"}},{key:"linetoRel",value:function(t,e){this.addShape(A.line(this.lastX,this.lastY,this.lastX+t,this.lastY+e)),this.lastX+=t,this.lastY+=e,this.lastCommand="l"}},{key:"movetoAbs",value:function(t,e){this.firstX=t,this.firstY=e,this.lastX=t,this.lastY=e,this.lastCommand="M"}},{key:"movetoRel",value:function(t,e){this.firstX+=t,this.firstY+=e,this.lastX+=t,this.lastY+=e,this.lastCommand="m"}},{key:"curvetoQuadraticAbs",value:function(t,e,n,r){this.addShape(A.quadraticBezier(this.lastX,this.lastY,t,e,n,r)),this.lastX=n,this.lastY=r,this.lastCommand="Q"}},{key:"curvetoQuadraticRel",value:function(t,e,n,r){this.addShape(A.quadraticBezier(this.lastX,this.lastY,this.lastX+t,this.lastY+e,this.lastX+n,this.lastY+r)),this.lastX+=n,this.lastY+=r,this.lastCommand="q"}},{key:"curvetoCubicSmoothAbs",value:function(t,e,n,r){var i,a;if(this.lastCommand.match(/^[SsCc]$/)){var s=this.shapes[this.shapes.length-1].args[2];i=2*this.lastX-s.x,a=2*this.lastY-s.y}else i=this.lastX,a=this.lastY;this.addShape(A.cubicBezier(this.lastX,this.lastY,i,a,t,e,n,r)),this.lastX=n,this.lastY=r,this.lastCommand="S"}},{key:"curvetoCubicSmoothRel",value:function(t,e,n,r){var i,a;if(this.lastCommand.match(/^[SsCc]$/)){var s=this.shapes[this.shapes.length-1].args[2];i=2*this.lastX-s.x,a=2*this.lastY-s.y}else i=this.lastX,a=this.lastY;this.addShape(A.cubicBezier(this.lastX,this.lastY,i,a,this.lastX+t,this.lastY+e,this.lastX+n,this.lastY+r)),this.lastX+=n,this.lastY+=r,this.lastCommand="s"}},{key:"curvetoQuadraticSmoothAbs",value:function(t,e){var n,r;if(this.lastCommand.match(/^[QqTt]$/)){var i=this.shapes[this.shapes.length-1].args[1];n=2*this.lastX-i.x,r=2*this.lastY-i.y}else n=this.lastX,r=this.lastY;this.addShape(A.quadraticBezier(this.lastX,this.lastY,n,r,t,e)),this.lastX=t,this.lastY=e,this.lastCommand="T"}},{key:"curvetoQuadraticSmoothRel",value:function(t,e){var n,r;if(this.lastCommand.match(/^[QqTt]$/)){var i=this.shapes[this.shapes.length-1].args[1];n=2*this.lastX-i.x,r=2*this.lastY-i.y}else n=this.lastX,r=this.lastY;this.addShape(A.quadraticBezier(this.lastX,this.lastY,n,r,this.lastX+t,this.lastY+e)),this.lastX+=t,this.lastY+=e,this.lastCommand="t"}},{key:"linetoVerticalAbs",value:function(t){this.addShape(A.line(this.lastX,this.lastY,this.lastX,t)),this.lastY=t,this.lastCommand="V"}},{key:"linetoVerticalRel",value:function(t){this.addShape(A.line(this.lastX,this.lastY,this.lastX,this.lastY+t)),this.lastY+=t,this.lastCommand="v"}},{key:"closePath",value:function(){this.addShape(A.line(this.lastX,this.lastY,this.firstX,this.firstY)),this.lastX=this.firstX,this.lastY=this.firstY,this.lastCommand="z"}}]),t}(),S=new T,L=new C;S.setHandler(L);var A=function(){function t(){e(this,t)}return r(t,null,[{key:"arc",value:function(t,e,n,r,i,a){if(isNaN(t))throw TypeError("Expected centerX to be a number, but found ".concat(t));if(isNaN(e))throw TypeError("Expected centerY to be a number, but found ".concat(e));if(isNaN(n))throw TypeError("Expected radiusX to be a number, but found ".concat(n));if(isNaN(r))throw TypeError("Expected radiusY to be a number, but found ".concat(r));if(isNaN(i))throw TypeError("Expected startRadians to be a number, but found ".concat(i));if(isNaN(a))throw TypeError("Expected endRadians to be a number, but found ".concat(a));return new h(h.ARC,[new s(t,e),n,r,i,a])}},{key:"quadraticBezier",value:function(t,e,n,r,i,a){if(isNaN(t))throw TypeError("Expected p1x to be a number, but found ".concat(t));if(isNaN(e))throw TypeError("Expected p1y to be a number, but found ".concat(e));if(isNaN(n))throw TypeError("Expected p2x to be a number, but found ".concat(n));if(isNaN(r))throw TypeError("Expected p2y to be a number, but found ".concat(r));if(isNaN(i))throw TypeError("Expected p3x to be a number, but found ".concat(i));if(isNaN(a))throw TypeError("Expected p3y to be a number, but found ".concat(a));return new h(h.QUADRATIC_BEZIER,[new s(t,e),new s(n,r),new s(i,a)])}},{key:"cubicBezier",value:function(t,e,n,r,i,a,o,u){if(isNaN(t))throw TypeError("Expected p1x to be a number, but found ".concat(t));if(isNaN(e))throw TypeError("Expected p1y to be a number, but found ".concat(e));if(isNaN(n))throw TypeError("Expected p2x to be a number, but found ".concat(n));if(isNaN(r))throw TypeError("Expected p2y to be a number, but found ".concat(r));if(isNaN(i))throw TypeError("Expected p3x to be a number, but found ".concat(i));if(isNaN(a))throw TypeError("Expected p3y to be a number, but found ".concat(a));if(isNaN(o))throw TypeError("Expected p4x to be a number, but found ".concat(o));if(isNaN(u))throw TypeError("Expected p4y to be a number, but found ".concat(u));return new h(h.CUBIC_BEZIER,[new s(t,e),new s(n,r),new s(i,a),new s(o,u)])}},{key:"circle",value:function(t,e,n){if(isNaN(t))throw TypeError("Expected centerX to be a number, but found ".concat(t));if(isNaN(e))throw TypeError("Expected centerY to be a number, but found ".concat(e));if(isNaN(n))throw TypeError("Expected radius to be a number, but found ".concat(n));return new h(h.CIRCLE,[new s(t,e),n])}},{key:"ellipse",value:function(t,e,n,r){if(isNaN(t))throw TypeError("Expected centerX to be a number, but found ".concat(t));if(isNaN(e))throw TypeError("Expected centerY to be a number, but found ".concat(e));if(isNaN(n))throw TypeError("Expected radiusX to be a number, but found ".concat(n));if(isNaN(r))throw TypeError("Expected radiusY to be a number, but found ".concat(r));return new h(h.ELLIPSE,[new s(t,e),n,r])}},{key:"line",value:function(t,e,n,r){if(isNaN(t))throw TypeError("Expected p1x to be a number, but found ".concat(t));if(isNaN(e))throw TypeError("Expected p1y to be a number, but found ".concat(e));if(isNaN(n))throw TypeError("Expected p2x to be a number, but found ".concat(n));if(isNaN(r))throw TypeError("Expected p2y to be a number, but found ".concat(r));return new h(h.LINE,[new s(t,e),new s(n,r)])}},{key:"path",value:function(t){if("string"!=typeof t)throw TypeError("Expected pathData to be a string, but found ".concat(t));return S.parseData(t),new h(h.PATH,L.shapes)}},{key:"polygon",value:function(t){if(!1===Array.isArray(t))throw TypeError("Expected points to be an Array, but found ".concat(t));if(t.some(function(t){return isNaN(t)}))throw TypeError("Expected all members of coords to be numbers");for(var e=[],n=0;n<t.length;n+=2)e.push(new s(t[n],t[n+1]));return new h(h.POLYGON,[e])}},{key:"polyline",value:function(t){if(!1===Array.isArray(t))throw TypeError("Expected points to be an Array, but found ".concat(t));if(t.some(function(t){return isNaN(t)}))throw TypeError("Expected all members of coords to be numbers");for(var e=[],n=0;n<t.length;n+=2)e.push(new s(t[n],t[n+1]));return new h(h.POLYLINE,[e])}},{key:"rectangle",value:function(e,n,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(isNaN(e))throw TypeError("Expected x to be a number, but found ".concat(e));if(isNaN(n))throw TypeError("Expected y to be a number, but found ".concat(n));if(isNaN(r))throw TypeError("Expected width to be a number, but found ".concat(r));if(isNaN(i))throw TypeError("Expected height to be a number, but found ".concat(i));if(isNaN(a))throw TypeError("Expected rx to be a number, but found ".concat(a));if(isNaN(o))throw TypeError("Expected ry to be a number, but found ".concat(o));if(0===a&&0===o)return new h(h.RECTANGLE,[new s(e,n),new s(e+r,n+i)]);0===a&&(a=o),0===o&&(o=a),a>.5*r&&(a=.5*r),o>.5*i&&(o=.5*i);var u=e,l=n,c=e+a,y=n+o,p=e+r-a,f=n+i-o,x=e+r,d=n+i,v=.5*Math.PI,m=[];return m.push(t.arc(c,y,a,o,2*v,3*v)),m.push(t.line(c,l,p,l)),m.push(t.arc(p,y,a,o,3*v,4*v)),m.push(t.line(x,y,x,f)),m.push(t.arc(p,f,a,o,0,v)),m.push(t.line(p,d,c,d)),m.push(t.arc(c,f,a,o,v,2*v)),m.push(t.line(u,f,u,y)),h(h.PATH,m)}}]),t}(),Y=function(){function t(){e(this,t)}return r(t,null,[{key:"arc",value:function(t,e,n,r,i){if(t instanceof s==!1)throw TypeError("Expected center to be a Point2D, but found ".concat(t));if(isNaN(e))throw TypeError("Expected radiusX to be a number, but found ".concat(e));if(isNaN(n))throw TypeError("Expected radiusY to be a number, but found ".concat(n));if(isNaN(r))throw TypeError("Expected startRadians to be a number, but found ".concat(r));if(isNaN(i))throw TypeError("Expected endRadians to be a number, but found ".concat(i));return new h(h.ARC,[t,e,n,r,i])}},{key:"quadraticBezier",value:function(t,e,n){if(t instanceof s==!1)throw TypeError("Expected p1 to be a Point2D, but found ".concat(t));if(e instanceof s==!1)throw TypeError("Expected p2 to be a Point2D, but found ".concat(e));if(n instanceof s==!1)throw TypeError("Expected p3 to be a Point2D, but found ".concat(n));return new h(h.QUADRATIC_BEZIER,[t,e,n])}},{key:"cubicBezier",value:function(t,e,n,r){if(t instanceof s==!1)throw TypeError("Expected p1 to be a Point2D, but found ".concat(t));if(e instanceof s==!1)throw TypeError("Expected p2 to be a Point2D, but found ".concat(e));if(n instanceof s==!1)throw TypeError("Expected p3 to be a Point2D, but found ".concat(n));if(r instanceof s==!1)throw TypeError("Expected p4 to be a Point2D, but found ".concat(r));return new h(h.CUBIC_BEZIER,[t,e,n,r])}},{key:"circle",value:function(t,e){if(t instanceof s==!1)throw TypeError("Expected center to be a Point2D, but found ".concat(t));if(isNaN(e))throw TypeError("Expected radius to be a number, but found ".concat(e));return new h(h.CIRCLE,[t,e])}},{key:"ellipse",value:function(t,e,n){if(t instanceof s==!1)throw TypeError("Expected center to be a Point2D, but found ".concat(t));if(isNaN(e))throw TypeError("Expected radiusX to be a number, but found ".concat(e));if(isNaN(n))throw TypeError("Expected radiusY to be a number, but found ".concat(n));return new h(h.ELLIPSE,[t,e,n])}},{key:"line",value:function(t,e){if(t instanceof s==!1)throw TypeError("Expected p1 to be a Point2D, but found ".concat(t));if(e instanceof s==!1)throw TypeError("Expected p2 to be a Point2D, but found ".concat(e));return new h(h.LINE,[t,e])}},{key:"path",value:function(t){return A.path(t)}},{key:"polygon",value:function(t){if(!1===Array.isArray(t))throw TypeError("Expected points to be an Array, but found ".concat(t));if(t.some(function(t){return t instanceof s==!1}))throw TypeError("Expected all members of points to be Point2Ds");return new h(h.POLYGON,[t])}},{key:"polyline",value:function(t){if(t.some(function(t){return t instanceof s==!1}))throw TypeError("Expected all members of points to be Point2Ds");return new h(h.POLYLINE,[t])}},{key:"rectangle",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(t instanceof s==!1)throw TypeError("Expected topLeft to be a Point2D, but found ".concat(t));if(e instanceof o==!1)throw TypeError("Expected size to be a Vector2D, but found ".concat(e));if(isNaN(n))throw TypeError("Expected rx to be a number, but found ".concat(n));if(isNaN(r))throw TypeError("Expected ry to be a number, but found ".concat(r));return A.rectangle(t.x,t.y,e.x,e.y,n,r)}}]),t}(),D=function(){function t(){e(this,t)}return r(t,null,[{key:"circle",value:function(t){if(t instanceof SVGCircleElement==!1)throw new TypeError("Expected SVGCircleElement, but found ".concat(t));var e=new s(t.cx.baseVal.value,t.cy.baseVal.value),n=t.r.baseVal.value;return new h(h.CIRCLE,[e,n])}},{key:"ellipse",value:function(t){if(t instanceof SVGEllipseElement==!1)throw new TypeError("Expected SVGEllipseElement, but found ".concat(t));var e=new s(t.cx.baseVal.value,t.cy.baseVal.value),n=t.rx.baseVal.value,r=t.ry.baseVal.value;return new h(h.ELLIPSE,[e,n,r])}},{key:"line",value:function(t){if(t instanceof SVGLineElement==!1)throw new TypeError("Expected SVGLineElement, but found ".concat(t));var e=new s(t.x1.baseVal.value,t.y1.baseVal.value),n=new s(t.x2.baseVal.value,t.y2.baseVal.value);return new h(h.LINE,[e,n])}},{key:"path",value:function(t){if(t instanceof SVGPathElement==!1)throw new TypeError("Expected SVGPathElement, but found ".concat(t));var e=t.getAttributeNS(null,"d");return A.path(e)}},{key:"polygon",value:function(t){if(t instanceof SVGPolygonElement==!1)throw new TypeError("Expected SVGPolygonElement, but found ".concat(t));for(var e=[],n=0;n<t.points.numberOfItems;n++){var r=t.points.getItem(n);e.push(new s(r.x,r.y))}return new h(h.POLYGON,[e])}},{key:"polyline",value:function(t){if(t instanceof SVGPolylineElement==!1)throw new TypeError("Expected SVGPolylineElement, but found ".concat(t));for(var e=[],n=0;n<t.points.numberOfItems;n++){var r=t.points.getItem(n);e.push(new s(r.x,r.y))}return new h(h.POLYLINE,[e])}},{key:"rect",value:function(t){if(t instanceof SVGRectElement==!1)throw new TypeError("Expected SVGRectElement, but found ".concat(t));return A.rectangle(t.x.baseVal.value,t.y.baseVal.value,t.width.baseVal.value,t.height.baseVal.value,t.rx.baseVal.value,t.ry.baseVal.value)}},{key:"element",value:function(e){if(e instanceof SVGElement==!1)throw new TypeError("Expected SVGElement, but found ".concat(e));var n=e.tagName;switch(n){case"circle":return t.circle(e);case"ellipse":return t.ellipse(e);case"line":return t.line(e);case"path":return t.path(e);case"polygon":return t.polygon(e);case"polyline":return t.polyline(e);case"rect":return t.rect(e);default:throw new TypeError("Unrecognized element type: '".concat(n,"'"))}}}]),t}(),B={pointInCircle:function(t,e,n){return o.fromPoints(e,t).length()<=n},pointInEllipse:function(t,e,n,r){var i=t.subtract(e);return i.x*i.x/(n*n)+i.y*i.y/(r*r)<=1},pointInPolyline:function(t,e){for(var n,r=e.length,i=0,a=e[0],s=1;s<=r;s++){var o=e[s%r],u=Math.min(a.y,o.y),l=Math.max(a.y,o.y),c=Math.max(a.x,o.x);a.y!==o.y&&u<t.y&&t.y<=l&&t.x<=c&&(n=(t.y-a.y)*(o.x-a.x)/(o.y-a.y)+a.x,(a.x===o.x||t.x<=n)&&i++),a=o}return i%2==1}};B.pointInPolygon=B.pointInPolyline,B.pointInRectangle=function(t,e,n){return e.x<=t.x&&t.x<n.x&&e.y<=t.y&&t.y<n.y},t.AffineShapes=Y,t.Intersection=P,t.IntersectionArgs=h,t.IntersectionQuery=B,t.Matrix2D=u,t.Point2D=s,t.ShapeInfo=h,t.Shapes=A,t.SvgShapes=D,t.Vector2D=o,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=index-umd.min.js.map
