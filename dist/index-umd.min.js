!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).KldIntersections={})}(this,function(e){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,a=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(a)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function s(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var o=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;n(this,e),this.x=t,this.y=r}return a(e,[{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"add",value:function(e){return new this.constructor(this.x+e.x,this.y+e.y)}},{key:"subtract",value:function(e){return new this.constructor(this.x-e.x,this.y-e.y)}},{key:"multiply",value:function(e){return new this.constructor(this.x*e,this.y*e)}},{key:"divide",value:function(e){return new this.constructor(this.x/e,this.y/e)}},{key:"equals",value:function(e){return this.x===e.x&&this.y===e.y}},{key:"precisionEquals",value:function(e,t){return Math.abs(this.x-e.x)<t&&Math.abs(this.y-e.y)<t}},{key:"lerp",value:function(e,t){var n=1-t;return new this.constructor(this.x*n+e.x*t,this.y*n+e.y*t)}},{key:"distanceFrom",value:function(e){var t=this.x-e.x,n=this.y-e.y;return Math.sqrt(t*t+n*n)}},{key:"min",value:function(e){return new this.constructor(Math.min(this.x,e.x),Math.min(this.y,e.y))}},{key:"max",value:function(e){return new this.constructor(Math.max(this.x,e.x),Math.max(this.y,e.y))}},{key:"transform",value:function(e){return new this.constructor(e.a*this.x+e.c*this.y+e.e,e.b*this.x+e.d*this.y+e.f)}},{key:"toString",value:function(){return"point(".concat(this.x,",").concat(this.y,")")}}]),e}(),u=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;n(this,e),this.x=t,this.y=r}return a(e,[{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"magnitude",value:function(){return this.x*this.x+this.y*this.y}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"cross",value:function(e){return this.x*e.y-this.y*e.x}},{key:"determinant",value:function(e){return this.x*e.y-this.y*e.x}},{key:"unit",value:function(){return this.divide(this.length())}},{key:"add",value:function(e){return new this.constructor(this.x+e.x,this.y+e.y)}},{key:"subtract",value:function(e){return new this.constructor(this.x-e.x,this.y-e.y)}},{key:"multiply",value:function(e){return new this.constructor(this.x*e,this.y*e)}},{key:"divide",value:function(e){return new this.constructor(this.x/e,this.y/e)}},{key:"angleBetween",value:function(e){var t=this.dot(e)/(this.length()*e.length());t=Math.max(-1,Math.min(t,1));var n=Math.acos(t);return this.cross(e)<0?-n:n}},{key:"perp",value:function(){return new this.constructor(-this.y,this.x)}},{key:"perpendicular",value:function(e){return this.subtract(this.project(e))}},{key:"project",value:function(e){var t=this.dot(e)/e.dot(e);return e.multiply(t)}},{key:"transform",value:function(e){return new this.constructor(e.a*this.x+e.c*this.y,e.b*this.x+e.d*this.y)}},{key:"equals",value:function(e){return this.x===e.x&&this.y===e.y}},{key:"precisionEquals",value:function(e,t){return Math.abs(this.x-e.x)<t&&Math.abs(this.y-e.y)<t}},{key:"toString",value:function(){return"vector(".concat(this.x,",").concat(this.y,")")}}],[{key:"fromPoints",value:function(t,n){return new e(n.x-t.x,n.y-t.y)}}]),e}(),l=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;n(this,e),this.a=t,this.b=r,this.c=a,this.d=i,this.e=s,this.f=o}return a(e,[{key:"multiply",value:function(e){return this.isIdentity()?e:e.isIdentity()?this:new this.constructor(this.a*e.a+this.c*e.b,this.b*e.a+this.d*e.b,this.a*e.c+this.c*e.d,this.b*e.c+this.d*e.d,this.a*e.e+this.c*e.f+this.e,this.b*e.e+this.d*e.f+this.f)}},{key:"inverse",value:function(){if(this.isIdentity())return this;var e=this.a*this.d-this.b*this.c;if(0===e)throw new Error("Matrix is not invertible");var t=1/e,n=this.f*this.c-this.e*this.d,r=this.e*this.b-this.f*this.a;return new this.constructor(this.d*t,-this.b*t,-this.c*t,this.a*t,n*t,r*t)}},{key:"translate",value:function(e,t){return new this.constructor(this.a,this.b,this.c,this.d,this.a*e+this.c*t+this.e,this.b*e+this.d*t+this.f)}},{key:"scale",value:function(e){return new this.constructor(this.a*e,this.b*e,this.c*e,this.d*e,this.e,this.f)}},{key:"scaleAt",value:function(e,t){var n=t.x-e*t.x,r=t.y-e*t.y;return new this.constructor(this.a*e,this.b*e,this.c*e,this.d*e,this.a*n+this.c*r+this.e,this.b*n+this.d*r+this.f)}},{key:"scaleNonUniform",value:function(e,t){return new this.constructor(this.a*e,this.b*e,this.c*t,this.d*t,this.e,this.f)}},{key:"scaleNonUniformAt",value:function(e,t,n){var r=n.x-e*n.x,a=n.y-t*n.y;return new this.constructor(this.a*e,this.b*e,this.c*t,this.d*t,this.a*r+this.c*a+this.e,this.b*r+this.d*a+this.f)}},{key:"rotate",value:function(e){var t=Math.cos(e),n=Math.sin(e);return new this.constructor(this.a*t+this.c*n,this.b*t+this.d*n,this.a*-n+this.c*t,this.b*-n+this.d*t,this.e,this.f)}},{key:"rotateAt",value:function(e,t){var n=Math.cos(e),r=Math.sin(e),a=t.x,i=t.y,s=this.a*n+this.c*r,o=this.b*n+this.d*r,u=this.c*n-this.a*r,l=this.d*n-this.b*r;return new this.constructor(s,o,u,l,(this.a-s)*a+(this.c-u)*i+this.e,(this.b-o)*a+(this.d-l)*i+this.f)}},{key:"rotateFromVector",value:function(e){var t=e.unit(),n=t.x,r=t.y;return new this.constructor(this.a*n+this.c*r,this.b*n+this.d*r,this.a*-r+this.c*n,this.b*-r+this.d*n,this.e,this.f)}},{key:"flipX",value:function(){return new this.constructor(-this.a,-this.b,this.c,this.d,this.e,this.f)}},{key:"flipY",value:function(){return new this.constructor(this.a,this.b,-this.c,-this.d,this.e,this.f)}},{key:"skewX",value:function(e){var t=Math.tan(e);return new this.constructor(this.a,this.b,this.c+this.a*t,this.d+this.b*t,this.e,this.f)}},{key:"skewY",value:function(e){var t=Math.tan(e);return new this.constructor(this.a+this.c*t,this.b+this.d*t,this.c,this.d,this.e,this.f)}},{key:"isIdentity",value:function(){return 1===this.a&&0===this.b&&0===this.c&&1===this.d&&0===this.e&&0===this.f}},{key:"isInvertible",value:function(){return this.a*this.d-this.b*this.c!=0}},{key:"getScale",value:function(){return{scaleX:Math.sqrt(this.a*this.a+this.c*this.c),scaleY:Math.sqrt(this.b*this.b+this.d*this.d)}}},{key:"getDecomposition",value:function(){var e=.5*(this.a+this.d),t=.5*(this.a-this.d),n=.5*(this.b+this.c),r=.5*(this.b-this.c),a=Math.sqrt(e*e+r*r),i=Math.sqrt(t*t+n*n),s=a+i,o=a-i,u=Math.atan2(n,t),l=Math.atan2(r,e),c=.5*(l-u),y=.5*(l+u);return{translation:this.constructor.translation(this.e,this.f),rotation:this.constructor.rotation(y),scale:this.constructor.nonUniformScaling(s,o),rotation0:this.constructor.rotation(c)}}},{key:"equals",value:function(e){return this.a===e.a&&this.b===e.b&&this.c===e.c&&this.d===e.d&&this.e===e.e&&this.f===e.f}},{key:"precisionEquals",value:function(e,t){return Math.abs(this.a-e.a)<t&&Math.abs(this.b-e.b)<t&&Math.abs(this.c-e.c)<t&&Math.abs(this.d-e.d)<t&&Math.abs(this.e-e.e)<t&&Math.abs(this.f-e.f)<t}},{key:"toString",value:function(){return"matrix(".concat(this.a,",").concat(this.b,",").concat(this.c,",").concat(this.d,",").concat(this.e,",").concat(this.f,")")}}],[{key:"translation",value:function(t,n){return new e(1,0,0,1,t,n)}},{key:"scaling",value:function(t){return new e(t,0,0,t,0,0)}},{key:"scalingAt",value:function(t,n){return new e(t,0,0,t,n.x-n.x*t,n.y-n.y*t)}},{key:"nonUniformScaling",value:function(t,n){return new e(t,0,0,n,0,0)}},{key:"nonUniformScalingAt",value:function(t,n,r){return new e(t,0,0,n,r.x-r.x*t,r.y-r.y*n)}},{key:"rotation",value:function(t){var n=Math.cos(t),r=Math.sin(t);return new e(n,r,-r,n,0,0)}},{key:"rotationAt",value:function(t,n){var r=Math.cos(t),a=Math.sin(t);return new e(r,a,-a,r,n.x-n.x*r+n.y*a,n.y-n.y*r-n.x*a)}},{key:"rotationFromVector",value:function(t){var n=t.unit(),r=n.x,a=n.y;return new e(r,a,-a,r,0,0)}},{key:"xFlip",value:function(){return new e(-1,0,0,1,0,0)}},{key:"yFlip",value:function(){return new e(1,0,0,-1,0,0)}},{key:"xSkew",value:function(t){return new e(1,0,Math.tan(t),1,0,0)}},{key:"ySkew",value:function(t){return new e(1,Math.tan(t),0,1,0,0)}}]),e}();function c(e){return"number"==typeof e?e?e<0?-1:1:e==e?e:NaN:NaN}l.IDENTITY=new l,l.IDENTITY.isIdentity=function(){return!0};var y=function(){function e(){n(this,e),this.coefs=[];for(var t=arguments.length-1;t>=0;t--)this.coefs.push(t<0||arguments.length<=t?void 0:arguments[t]);this._variable="t",this._s=0}return a(e,[{key:"clone",value:function(){var t=new e;return t.coefs=this.coefs.slice(),t}},{key:"eval",value:function(e){if(isNaN(e))throw new TypeError("Parameter must be a number. Found '".concat(e,"'"));for(var t=0,n=this.coefs.length-1;n>=0;n--)t=t*e+this.coefs[n];return t}},{key:"add",value:function(t){for(var n=new e,r=this.getDegree(),a=t.getDegree(),i=Math.max(r,a),s=0;s<=i;s++){var o=s<=r?this.coefs[s]:0,u=s<=a?t.coefs[s]:0;n.coefs[s]=o+u}return n}},{key:"multiply",value:function(t){for(var n=new e,r=0;r<=this.getDegree()+t.getDegree();r++)n.coefs.push(0);for(var a=0;a<=this.getDegree();a++)for(var i=0;i<=t.getDegree();i++)n.coefs[a+i]+=this.coefs[a]*t.coefs[i];return n}},{key:"divideEqualsScalar",value:function(e){for(var t=0;t<this.coefs.length;t++)this.coefs[t]/=e}},{key:"simplifyEquals",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e-12,t=this.getDegree();t>=0&&Math.abs(this.coefs[t])<=e;t--)this.coefs.pop()}},{key:"removeZerosEquals",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e-15,t=this.coefs,n=10*e*Math.abs(t.reduce(function(e,t){return Math.abs(t)>Math.abs(e)?t:e})),r=0;r<t.length-1;r++)Math.abs(t[r])<n&&(t[r]=0);return this}},{key:"monicEquals",value:function(){var e=this.coefs;return 1!==e[e.length-1]&&this.divideEqualsScalar(e[e.length-1]),this}},{key:"toString",value:function(){for(var e=[],t=[],n=this.coefs.length-1;n>=0;n--){var r=Math.round(1e3*this.coefs[n])/1e3;if(0!==r){var a=r<0?" - ":" + ";r=Math.abs(r),n>0&&(1===r?r=this._variable:r+=this._variable),n>1&&(r+="^"+n),t.push(a),e.push(r)}}t[0]=" + "===t[0]?"":"-";for(var i="",s=0;s<e.length;s++)i+=t[s]+e[s];return i}},{key:"bisection",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-6,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:15,i=this.eval(e),s=this.eval(t);if(Math.abs(i)<=r)n=e;else if(Math.abs(s)<=r)n=t;else if(i*s<=0)for(var o=Math.log(t-e),u=Math.LN10*a,l=Math.ceil((o+u)/Math.LN2),c=0;c<l;c++){n=.5*(e+t);var y=this.eval(n);if(Math.abs(y)<=r)break;y*i<0?(t=n,s=y):(e=n,i=y)}return n}},{key:"trapezoid",value:function(e,t,n){if(isNaN(e)||isNaN(t)||isNaN(n))throw new TypeError("Parameters must be numbers");var r=t-e;if(1===n){var a=this.eval(e),i=this.eval(t);this._s=.5*r*(a+i)}else{for(var s=1<<n-2,o=r/s,u=e+.5*o,l=0,c=0;c<s;c++)l+=this.eval(u),u+=o;this._s=.5*(this._s+r*l/s)}if(isNaN(this._s))throw new TypeError("this._s is NaN");return this._s}},{key:"simpson",value:function(e,t){if(isNaN(e)||isNaN(t))throw new TypeError("Parameters must be numbers");for(var n=t-e,r=.5*n*(this.eval(e)+this.eval(t)),a=r,i=4*r/3,s=i,o=r,u=1,l=2;l<=20;l++){for(var c=n/u,y=e+.5*c,h=0,p=1;p<=u;p++)h+=this.eval(y),y+=c;if(i=(4*(r=a=.5*(a+n*h/u))-o)/3,Math.abs(i-s)<1e-7*Math.abs(s))break;s=i,o=r,u<<=1}return i}},{key:"romberg",value:function(t,n){if(isNaN(t)||isNaN(n))throw new TypeError("Parameters must be numbers");var r=new Array(21),a=new Array(21),i={y:0,dy:0};a[0]=1;for(var s=1;s<=20&&(r[s-1]=this.trapezoid(t,n,s),!(s>=3&&(i=e.interpolate(a,r,3,s-3,0),Math.abs(i.dy)<=1e-6*i.y)));s++)r[s]=r[s-1],a[s]=.25*a[s-1];return i.y}},{key:"zeroErrorEstimate",value:function(e){if(void 0===e){var t=this.bounds();e=Math.max(Math.abs(t.minX),Math.abs(t.maxX))}if(e<.001)return 2*Math.abs(this.eval(1e-15));var n=this.coefs.length-1,r=this.coefs[n];return 10*1e-15*this.coefs.reduce(function(t,n,a){var i=n/r*Math.pow(e,a);return i>t?i:t},0)}},{key:"boundsUpperRealFujiwara",value:function(){var e=this.coefs,t=e.length-1,n=e[t];1!==n&&(e=this.coefs.map(function(e){return e/n}));var r,a=e.map(function(e,n){return n<t?Math.pow(Math.abs(0===n?e/2:e),1/(t-n)):e}),i=function(e,t,n){return r(n)&&(e.max<t?(e.nearmax=e.max,e.max=t):e.nearmax<t&&(e.nearmax=t)),e};r=function(n){return n<t&&e[n]<0};var s=a.reduce(i,{max:0,nearmax:0});return r=function(n){return n<t&&(t%2==n%2?e[n]<0:e[n]>0)},{negX:-2*a.reduce(i,{max:0,nearmax:0}).max,posX:2*s.max}}},{key:"boundsLowerRealFujiwara",value:function(){var t=new e;t.coefs=this.coefs.slice().reverse();var n=t.boundsUpperRealFujiwara();return n.negX=1/n.negX,n.posX=1/n.posX,n}},{key:"bounds",value:function(){var e=this.boundsUpperRealFujiwara(),t={minX:e.negX,maxX:e.posX};return 0===e.negX&&0===e.posX?t:(0===e.negX?t.minX=this.boundsLowerRealFujiwara().posX:0===e.posX&&(t.maxX=this.boundsLowerRealFujiwara().negX),t.minX>t.maxX&&(t.minX=t.maxX=0),t)}},{key:"boundUpperAbsRouche",value:function(){var e=this.coefs,t=e.length-1;return 1+e.reduce(function(e,n,r){return r!==t&&e<(n=Math.abs(n))?n:e},0)/Math.abs(e[t])}},{key:"boundLowerAbsRouche",value:function(){var e=this.coefs,t=e.reduce(function(e,t,n){return 0!==n&&e<(t=Math.abs(t))?t:e},0);return Math.abs(e[0])/(Math.abs(e[0])+t)}},{key:"boundsRealLaguerre",value:function(){var e=this.coefs,t=e.length-1,n=-e[t-1]/(t*e[t]),r=e[t-1]*e[t-1]-2*t/(t-1)*e[t]*e[t-2],a=(t-1)/(t*e[t])*Math.sqrt(r);return a<0&&(a=-a),{minX:n-a,maxX:n+a}}},{key:"countRootsDescartes",value:function(){var e=this.coefs,t=e.length-1,n=e.reduce(function(e,t,n){return 0!==e.prev_a&&0!==t&&(e.prev_a<0==t>0&&e.pos++,n%2==0!=e.prev_a<0==(n%2==1!=t>0)&&e.neg++),e.prev_a=t,e},{pos:0,neg:0,prev_a:0});return{maxRealPos:n.pos,maxRealNeg:n.neg,minComplex:t-(n.pos+n.neg)}}},{key:"getDegree",value:function(){return this.coefs.length-1}},{key:"getDerivative",value:function(){for(var t=new e,n=1;n<this.coefs.length;n++)t.coefs.push(n*this.coefs[n]);return t}},{key:"getRoots",value:function(){var e;switch(this.simplifyEquals(),this.getDegree()){case 0:e=[];break;case 1:e=this.getLinearRoot();break;case 2:e=this.getQuadraticRoots();break;case 3:e=this.getCubicRoots();break;case 4:e=this.getQuarticRoots();break;default:e=[]}return e}},{key:"getRootsInInterval",value:function(e,t){var n=[];function r(e){"number"==typeof e&&n.push(e)}if(0===this.getDegree())throw new RangeError("Unexpected empty polynomial");if(1===this.getDegree())r(this.bisection(e,t));else{var a=this.getDerivative().getRootsInInterval(e,t);if(a.length>0){r(this.bisection(e,a[0]));for(var i=0;i<=a.length-2;i++)r(this.bisection(a[i],a[i+1]));r(this.bisection(a[a.length-1],t))}else r(this.bisection(e,t))}return n}},{key:"getLinearRoot",value:function(){var e=[],t=this.coefs[1];return 0!==t&&e.push(-this.coefs[0]/t),e}},{key:"getQuadraticRoots",value:function(){var e=[];if(2===this.getDegree()){var t=this.coefs[2],n=this.coefs[1]/t,r=n*n-4*(this.coefs[0]/t);if(r>0){var a=Math.sqrt(r);e.push(.5*(-n+a)),e.push(.5*(-n-a))}else 0===r&&e.push(.5*-n)}return e}},{key:"getCubicRoots",value:function(){var e=[];if(3===this.getDegree()){var t=this.coefs[3],n=this.coefs[2]/t,r=this.coefs[1]/t,a=(3*r-n*n)/3,i=(2*n*n*n-9*r*n+27*(this.coefs[0]/t))/27,s=n/3,o=i*i/4+a*a*a/27,u=i/2,l=this.zeroErrorEstimate();if(Math.abs(o)<=l&&(o=0),o>0){var c,y=Math.sqrt(o),h=-u+y;c=h>=0?Math.pow(h,1/3):-Math.pow(-h,1/3),(h=-u-y)>=0?c+=Math.pow(h,1/3):c-=Math.pow(-h,1/3),e.push(c-s)}else if(o<0){var p=Math.sqrt(-a/3),f=Math.atan2(Math.sqrt(-o),-u)/3,d=Math.cos(f),v=Math.sin(f),x=Math.sqrt(3);e.push(2*p*d-s),e.push(-p*(d+x*v)-s),e.push(-p*(d-x*v)-s)}else{var m;m=u>=0?-Math.pow(u,1/3):Math.pow(-u,1/3),e.push(2*m-s),e.push(-m-s)}}return e}},{key:"getQuarticRoots",value:function(){var t=[],n=this.getDegree();if(4===n){var r=new e;r.coefs=this.coefs.slice(),r.divideEqualsScalar(r.coefs[n]);Math.abs(r.coefs[0])<10*1e-15*Math.abs(r.coefs[3])&&(r.coefs[0]=0);for(var a=r.getDerivative(),i=a.getRoots().sort(function(e,t){return e-t}),s=[],o=i.length-1,u=this.bounds(),l=Math.max(Math.abs(u.minX),Math.abs(u.maxX)),y=this.zeroErrorEstimate(l),h=0;h<=o;h++)s.push(r.eval(i[h]));for(var p=0;p<=o;p++)Math.abs(s[p])<y&&(s[p]=0);var f=0,d=Math.max(.1*(u.maxX-u.minX)/n,1e-15),v=[],x=[];if(o>-1){for(0!==s[0]?c(s[0])!==c(r.eval(i[0]-d)-s[0])&&(v.push(i[0]-d),x.push([u.minX,i[0]])):(t.push(i[0],i[0]),f++);f<o;f++)0===s[f+1]?(t.push(i[f+1],i[f+1]),f++):c(s[f])!==c(s[f+1])&&(v.push((i[f]+i[f+1])/2),x.push([i[f],i[f+1]]));0!==s[o]&&c(s[o])!==c(r.eval(i[o]+d)-s[o])&&(v.push(i[o]+d),x.push([i[o],u.maxX]))}var m=function(e){return r.eval(e)},b=function(e){return a.eval(e)};if(v.length>0)for(f=0;f<v.length;f++)v[f]=e.newtonSecantBisection(v[f],m,b,32,x[f][0],x[f][1]);t=t.concat(v)}return t}}],[{key:"interpolate",value:function(e,t,n,r,a){if(e.constructor!==Array||t.constructor!==Array)throw new TypeError("xs and ys must be arrays");if(isNaN(n)||isNaN(r)||isNaN(a))throw new TypeError("n, offset, and x must be numbers");var i,s,o=0,u=new Array(n),l=new Array(n),c=0,y=Math.abs(a-e[r]);for(i=0;i<n;i++){var h=Math.abs(a-e[r+i]);h<y&&(c=i,y=h),u[i]=l[i]=t[r+i]}s=t[r+c],c--;for(var p=1;p<n;p++){for(i=0;i<n-p;i++){var f=e[r+i]-a,d=e[r+i+p]-a,v=u[i+1]-l[i],x=f-d;if(0===x)throw new RangeError("Unable to interpolate polynomial. Two numbers in n were identical (to within roundoff)");x=v/x,l[i]=d*x,u[i]=f*x}s+=o=2*(c+1)<n-p?u[c+1]:l[c--]}return{y:s,dy:o}}},{key:"newtonSecantBisection",value:function(e,t,n,r,a,i){var s,o,u,l,y,h,p,f=0,d=0;s=e;var v=Math.pow(10,-14),x="number"==typeof a&&"number"==typeof i;if(x){if(a>i)throw new RangeError("Min must be greater than max");if(h=t(a),p=t(i),c(h)===c(p))throw new RangeError("Y values of bounds must be of opposite sign")}for(var m=function(){return Math.abs(u)<=v*Math.abs(s)||d===s-u-s},b=0;b<r;b++){if(0===(o=n(s))){if(0===f)throw new RangeError("df(x) is zero");o=f}if(f=o,y=t(s),l=s-(u=y/o),m())break;if(x){if(c(y)===c(p))i=s,p=y;else{if(c(y)!==c(h)){s=l;break}a=s,h=y}if(l<a||l>i){if(c(h)===c(p))break;var g=p-h,w=i-a;if(u=0===g?s-(a+.5*w):Math.abs(g/Math.min(h,p))>50?s-(a+w*(.5+(Math.abs(h)<Math.abs(p)?-.25:.25))):s-(a-h/g*w),l=s-u,m())break}}d=s-l,s=l}return s}}]),e}(),h=function(){var e=function(e,t,n,r){for(n=n||{},r=e.length;r--;n[e[r]]=t);return n},t=[1,5],n=[1,11],r=[1,6],a=[1,7],i=[1,8],s=[1,10],o=[1,20],u=[1,21],l=[1,24],c=[1,14],y=[1,18],h=[1,19],p=[1,23],f=[1,22],d=[1,7,8,11,13,14,17,23,24,26,29,36,37,78,79],v=[1,7,8,11,13,14,17,23,24,26,28,29,36,37,38,41,42,78,79],x=[1,31],m=[1,32],b=[1,33],g=[1,34],w=[1,7,8,11,13,14,16,17,23,24,26,28,29,36,37,38,41,42,51,57,58,59,60,78,79],E=[2,50],k=[1,36],P=[1,37],N=[1,7,8,11,13,14,16,17,23,24,26,28,29,36,37,38,41,42,49,51,57,58,59,60,65,78,79],T=[1,45],I=[2,13],R=[2,14],A=[2,15],M=[1,70],S=[1,68],_=[1,54],L=[1,55],Y=[1,56],C=[1,57],X=[1,58],$=[1,69],D=[1,72],B=[1,59],O=[1,60],z=[1,62],U=[1,63],V=[1,65],q=[1,71],j=[38,42],G=[28,42],F=[1,90],Q=[1,91],H=[1,92],Z=[1,111],J=[1,7,8,11,13,14,17,23,24,26,28,29,36,37,38,41,42,65,78,79],K=[1,7,8,11,13,14,17,23,24,26,28,29,36,37,38,41,42,49,51,65,78,79],W=[1,120],ee=[1,125],te=[1,7,8,11,13,14,16,17,23,24,26,28,29,36,37,38,41,42,51,57,58,78,79],ne=[42,51],re=[1,149],ae=[38,42,51],ie=[38,42,49,51],se=[28,42,49],oe=[1,160],ue=[1,161],le=[1,163],ce=[1,165],ye=[41,42],he=[1,166],pe=[1,168],fe=[2,42],de=[1,170],ve=[1,175],xe=[1,176],me=[1,189],be=[28,41,42],ge={trace:function(){},yy:{},symbols_:{error:2,program:3,statements:4,statement:5,transform:6,GENERATOR:7,IDENTIFIER:8,"=":9,generator:10,PATTERN:11,namedTypePattern:12,TRANSFORM:13,TYPE:14,typeDefinition:15,"<=":16,_:17,typePatterns:18,ANY_TYPE:19,ARRAY_TYPE:20,arrayTypeDefinition:21,BOOLEAN_TYPE:22,TRUE:23,FALSE:24,ENUMERATION:25,"{":26,identifiers:27,"}":28,NULL_TYPE:29,NUMBER_TYPE:30,float:31,OBJECT_TYPE:32,objectTypeDefinition:33,STRING_TYPE:34,string:35,UNDEFINED_TYPE:36,"[":37,"]":38,transformElements:39,assignments:40,";":41,",":42,transformProperties:43,transformProperty:44,":":45,transforms:46,assignment:47,namedGenerator:48,AS:49,"(":50,")":51,parameterList:52,arrayExpression:53,boolean:54,objectExpression:55,".":56,"+":57,"-":58,"*":59,"/":60,expressionElements:61,expressionElement:62,expressionProperties:63,expressionProperty:64,"|":65,typePattern:66,arrayPattern:67,objectPattern:68,patternElements:69,namedPatternElement:70,patternElement:71,range:72,integer:73,"..":74,patternProperties:75,namedPatternProperty:76,namedProperty:77,STRING:78,NUMBER:79,stringOrIdentifier:80,$accept:0,$end:1},terminals_:{2:"error",7:"GENERATOR",8:"IDENTIFIER",9:"=",11:"PATTERN",13:"TRANSFORM",14:"TYPE",16:"<=",17:"_",19:"ANY_TYPE",20:"ARRAY_TYPE",22:"BOOLEAN_TYPE",23:"TRUE",24:"FALSE",25:"ENUMERATION",26:"{",28:"}",29:"NULL_TYPE",30:"NUMBER_TYPE",32:"OBJECT_TYPE",34:"STRING_TYPE",36:"UNDEFINED_TYPE",37:"[",38:"]",41:";",42:",",45:":",49:"AS",50:"(",51:")",56:".",57:"+",58:"-",59:"*",60:"/",65:"|",74:"..",78:"STRING",79:"NUMBER"},productions_:[0,[3,1],[4,2],[4,1],[5,1],[5,4],[5,4],[5,4],[5,4],[6,1],[6,3],[6,3],[6,3],[6,2],[6,2],[6,2],[15,1],[15,1],[15,1],[15,1],[15,1],[15,1],[15,4],[15,1],[15,1],[15,1],[15,1],[15,1],[15,1],[15,1],[15,1],[21,2],[21,3],[21,5],[39,3],[39,1],[33,2],[33,3],[33,5],[43,3],[43,1],[44,3],[44,1],[40,3],[40,1],[47,3],[46,3],[46,1],[48,1],[48,3],[10,1],[10,3],[10,4],[10,1],[10,1],[10,1],[10,1],[10,1],[10,1],[10,1],[10,3],[10,3],[10,3],[10,3],[10,3],[53,2],[53,3],[61,3],[61,1],[62,1],[55,2],[55,3],[63,3],[63,1],[64,3],[64,1],[52,3],[52,1],[18,3],[18,1],[12,1],[12,3],[66,1],[66,1],[66,1],[66,1],[66,1],[66,1],[66,1],[66,1],[66,1],[66,1],[66,1],[66,1],[66,1],[66,1],[66,2],[66,2],[66,1],[67,2],[67,3],[69,3],[69,1],[70,1],[70,3],[71,1],[71,3],[71,3],[71,5],[72,3],[72,2],[72,2],[72,1],[68,2],[68,3],[75,3],[75,1],[76,1],[76,3],[77,3],[77,1],[54,1],[54,1],[35,1],[73,1],[31,1],[80,1],[80,1],[27,3],[27,1]],performAction:function(e,t,n,r,a,i,s){var o=i.length-1;switch(a){case 1:return i[o];case 2:i[o-1].push(i[o]),this.$=i[o-1];break;case 3:case 35:case 40:case 44:case 47:case 68:case 73:case 77:case 79:case 102:case 116:case 129:this.$=[i[o]];break;case 4:case 18:case 27:case 94:case 95:this.$=i[o];break;case 5:this.$={type:"generator-assignment",name:i[o-2],value:i[o]};break;case 6:this.$={type:"pattern-assignment",name:i[o-2],value:i[o]};break;case 7:this.$={type:"transform-assignment",name:i[o-2],value:i[o]};break;case 8:this.$={type:"type-assignment",name:i[o-2],value:i[o]};break;case 9:this.$={type:"transform",patterns:[{type:"pattern",patternType:"any",value:null}],returnValue:i[o]};break;case 10:this.$={type:"transform",patterns:null,returnValue:i[o-2]};break;case 11:this.$={type:"transform",patterns:i[o],returnValue:i[o-2]};break;case 12:this.$={type:"transform",patterns:i[o],returnValue:null};break;case 13:this.$={type:"generator-reference",name:i[o]};break;case 14:this.$={type:"transform-reference",name:i[o]};break;case 15:this.$={type:"type-reference",name:i[o]};break;case 16:this.$={type:"type-definition",definition:"any",value:null};break;case 17:this.$={type:"type-definition",definition:"array",value:null};break;case 19:this.$={type:"type-definition",definition:"boolean",value:null};break;case 20:this.$={type:"type-definition",definition:"boolean",value:!0};break;case 21:this.$={type:"type-definition",definition:"boolean",value:!1};break;case 22:this.$={type:"type-definition",definition:"enumeration",value:i[o-1]};break;case 23:this.$={type:"type-definition",definition:"null",value:null};break;case 24:this.$={type:"type-definition",definition:"number",value:null};break;case 25:this.$={type:"type-definition",definition:"number",value:i[o]};break;case 26:this.$={type:"type-definition",definition:"object",value:null};break;case 28:this.$={type:"type-definition",definition:"string",value:null};break;case 29:this.$={type:"type-definition",definition:"string",value:i[o]};break;case 30:this.$={type:"type-definition",definition:"undefined",value:null};break;case 31:this.$={type:"type-definition",definition:"array",value:[]};break;case 32:this.$={type:"type-definition",definition:"array",value:i[o-1]};break;case 33:this.$={type:"type-definition",definition:"array",value:i[o-3].concat(i[o-1])};break;case 34:case 39:case 43:case 46:case 67:case 72:case 76:case 78:case 101:case 115:case 128:i[o-2].push(i[o]),this.$=i[o-2];break;case 36:this.$={type:"type-definition",definition:"object",value:[]};break;case 37:this.$={type:"type-definition",definition:"object",value:i[o-1]};break;case 38:this.$={type:"type-definition",definition:"object",value:i[o-3].concat(i[o-1])};break;case 41:this.$={type:"type-property",name:i[o-2],value:i[o]};break;case 42:this.$={type:"type-property",name:i[o],value:null};break;case 45:this.$={type:"assignment",name:i[o-2],value:i[o]};break;case 48:case 80:case 103:i[o].assignTo=null,this.$=i[o];break;case 49:case 81:case 104:case 118:i[o-2].assignTo=i[o],this.$=i[o-2];break;case 50:this.$={type:"generator",expression:{type:"get-value",name:i[o]}};break;case 51:this.$={type:"generator",expression:{type:"invoke",name:i[o-2],args:[]}};break;case 52:this.$={type:"generator",expression:{type:"invoke",name:i[o-3],args:i[o-1]}};break;case 53:case 58:this.$={type:"generator",expression:i[o]};break;case 54:this.$={type:"generator",expression:{type:"boolean",value:i[o]}};break;case 55:this.$={type:"generator",expression:{type:"boolean",value:null}};break;case 56:this.$={type:"generator",expression:{type:"number",value:i[o]}};break;case 57:this.$={type:"generator",expression:{type:"string",value:i[o]}};break;case 59:this.$={type:"generator",expression:{type:"string",value:void 0}};break;case 60:this.$={type:"generator",expression:{type:"get-property",left:{type:"get-value",name:i[o-2]},right:i[o]}};break;case 61:this.$={type:"generator",expression:{type:"add",left:i[o-2],right:i[o]}};break;case 62:this.$={type:"generator",expression:{type:"subtract",left:i[o-2],right:i[o]}};break;case 63:this.$={type:"generator",expression:{type:"multiply",left:i[o-2],right:i[o]}};break;case 64:this.$={type:"generator",expression:{type:"divide",left:i[o-2],right:i[o]}};break;case 65:this.$={type:"array",value:[]};break;case 66:this.$={type:"array",value:i[o-1]};break;case 69:case 117:case 126:this.$=i[o];break;case 70:this.$={type:"object",value:[]};break;case 71:this.$={type:"object",value:i[o-1]};break;case 74:i[o].name=i[o-2],this.$=i[o];break;case 75:this.$={type:"generator",name:i[o],expression:{type:"get-value",name:i[o]}};break;case 82:this.$={type:"pattern",patternType:"any",value:null};break;case 83:this.$={type:"pattern",patternType:"array",value:null};break;case 84:this.$={type:"pattern",patternType:"boolean",value:null};break;case 85:this.$={type:"pattern",patternType:"boolean",value:!0};break;case 86:this.$={type:"pattern",patternType:"boolean",value:!1};break;case 87:this.$={type:"pattern",patternType:"null",value:null};break;case 88:this.$={type:"pattern",patternType:"number",value:null};break;case 89:this.$={type:"pattern",patternType:"number",value:i[o]};break;case 90:this.$={type:"pattern",patternType:"object",value:null};break;case 91:this.$={type:"pattern",patternType:"string",value:null};break;case 92:this.$={type:"pattern",patternType:"string",value:i[o]};break;case 93:this.$={type:"pattern",patternType:"undefined",value:null};break;case 96:this.$={type:"pattern-reference",name:i[o]};break;case 97:this.$={type:"enumeration-reference",name:i[o]};break;case 98:this.$={type:"pattern",patternType:"reference",value:i[o]};break;case 99:this.$={type:"pattern",patternType:"array-pattern",value:[]};break;case 100:this.$={type:"pattern",patternType:"array-pattern",value:i[o-1]};break;case 105:this.$={type:"element",pattern:i[o],range:{type:"range",start:1,stop:1}};break;case 106:this.$={type:"element",pattern:i[o-2],range:i[o]};break;case 107:this.$={type:"element-group",elements:i[o-1],range:{type:"range",start:1,stop:1}};break;case 108:this.$={type:"element-group",elements:i[o-3],range:i[o]};break;case 109:this.$={type:"range",start:i[o-2],stop:i[o]};break;case 110:this.$={type:"range",start:0,stop:i[o]};break;case 111:this.$={type:"range",start:i[o-1],stop:1/0};break;case 112:this.$={type:"range",start:i[o],stop:i[o]};break;case 113:this.$={type:"pattern",patternType:"object",value:null};break;case 114:this.$={type:"pattern",patternType:"object-pattern",value:i[o-1]};break;case 119:this.$={type:"property",name:i[o-2],pattern:i[o]};break;case 120:this.$={type:"property",name:i[o],pattern:{type:"pattern",patternType:"any",value:null}};break;case 121:this.$=!0;break;case 122:this.$=!1;break;case 123:case 127:this.$=i[o].substring(1,i[o].length-1);break;case 124:this.$=parseInt(i[o]);break;case 125:this.$=parseFloat(i[o])}},table:[{3:1,4:2,5:3,6:4,7:t,8:n,10:9,11:r,13:a,14:i,17:s,23:o,24:u,26:l,29:c,31:15,35:16,36:y,37:h,53:12,54:13,55:17,78:p,79:f},{1:[3]},{1:[2,1],5:25,6:4,7:t,8:n,10:9,11:r,13:a,14:i,17:s,23:o,24:u,26:l,29:c,31:15,35:16,36:y,37:h,53:12,54:13,55:17,78:p,79:f},e(d,[2,3]),e(d,[2,4]),{8:[1,26]},{8:[1,27]},{8:[1,28]},{8:[1,29]},e(v,[2,9],{16:[1,30],57:x,58:m,59:b,60:g}),{16:[1,35]},e(w,E,{50:k,56:P}),e(w,[2,53]),e(w,[2,54]),e(w,[2,55]),e(w,[2,56]),e(w,[2,57]),e(w,[2,58]),e(w,[2,59]),{8:n,10:41,23:o,24:u,26:l,29:c,31:15,35:16,36:y,37:h,38:[1,38],53:12,54:13,55:17,61:39,62:40,78:p,79:f},e(w,[2,121]),e(w,[2,122]),e(N,[2,125]),e(N,[2,123]),{8:T,28:[1,42],63:43,64:44},e(d,[2,2]),e(d,I,{9:[1,46]}),{9:[1,47]},e(d,R,{9:[1,48]}),e(d,A,{9:[1,49]}),{8:M,11:S,12:52,17:[1,50],18:51,19:_,20:L,22:Y,23:C,24:X,25:$,26:D,29:B,30:O,31:61,32:z,34:U,35:64,36:V,37:q,66:53,67:66,68:67,78:p,79:f},{8:n,10:73,23:o,24:u,26:l,29:c,31:15,35:16,36:y,37:h,53:12,54:13,55:17,78:p,79:f},{8:n,10:74,23:o,24:u,26:l,29:c,31:15,35:16,36:y,37:h,53:12,54:13,55:17,78:p,79:f},{8:n,10:75,23:o,24:u,26:l,29:c,31:15,35:16,36:y,37:h,53:12,54:13,55:17,78:p,79:f},{8:n,10:76,23:o,24:u,26:l,29:c,31:15,35:16,36:y,37:h,53:12,54:13,55:17,78:p,79:f},{8:M,11:S,12:52,18:77,19:_,20:L,22:Y,23:C,24:X,25:$,26:D,29:B,30:O,31:61,32:z,34:U,35:64,36:V,37:q,66:53,67:66,68:67,78:p,79:f},{8:n,10:80,23:o,24:u,26:l,29:c,31:15,35:16,36:y,37:h,51:[1,78],52:79,53:12,54:13,55:17,78:p,79:f},{8:[1,81]},e(w,[2,65]),{38:[1,82],42:[1,83]},e(j,[2,68]),e(j,[2,69],{57:x,58:m,59:b,60:g}),e(w,[2,70]),{28:[1,84],42:[1,85]},e(G,[2,73]),e(G,[2,75],{45:[1,86]}),{8:n,10:87,23:o,24:u,26:l,29:c,31:15,35:16,36:y,37:h,53:12,54:13,55:17,78:p,79:f},{8:M,11:S,12:88,19:_,20:L,22:Y,23:C,24:X,25:$,26:D,29:B,30:O,31:61,32:z,34:U,35:64,36:V,37:q,66:53,67:66,68:67,78:p,79:f},{6:89,7:F,8:n,10:9,13:Q,14:H,17:s,23:o,24:u,26:l,29:c,31:15,35:16,36:y,37:h,53:12,54:13,55:17,78:p,79:f},{15:93,19:[1,94],20:[1,95],21:96,22:[1,97],23:[1,98],24:[1,99],25:[1,100],26:[1,110],29:[1,101],30:[1,102],31:103,32:[1,104],33:105,34:[1,106],35:107,36:[1,108],37:[1,109],78:p,79:f},e(v,[2,10]),e(v,[2,11],{65:Z}),e(J,[2,79]),e(J,[2,80],{49:[1,112]}),e(K,[2,82]),e(K,[2,83]),e(K,[2,84]),e(K,[2,85]),e(K,[2,86]),e(K,[2,87]),e(K,[2,88]),e(K,[2,89]),e(K,[2,90]),e(K,[2,91]),e(K,[2,92]),e(K,[2,93]),e(K,[2,94]),e(K,[2,95]),{8:[1,113]},{8:[1,114]},e(K,[2,98]),{8:M,11:S,19:_,20:L,22:Y,23:C,24:X,25:$,26:D,29:B,30:O,31:61,32:z,34:U,35:64,36:V,37:q,38:[1,115],50:W,66:119,67:66,68:67,69:116,70:117,71:118,78:p,79:f},{8:ee,28:[1,121],75:122,76:123,77:124},e(te,[2,61],{59:b,60:g}),e(te,[2,62],{59:b,60:g}),e(w,[2,63]),e(w,[2,64]),e(v,[2,12],{65:Z}),e(w,[2,51]),{42:[1,127],51:[1,126]},e(ne,[2,77],{57:x,58:m,59:b,60:g}),e(w,[2,60]),e(w,[2,66]),{8:n,10:41,23:o,24:u,26:l,29:c,31:15,35:16,36:y,37:h,53:12,54:13,55:17,62:128,78:p,79:f},e(w,[2,71]),{8:T,64:129},{8:n,10:130,23:o,24:u,26:l,29:c,31:15,35:16,36:y,37:h,53:12,54:13,55:17,78:p,79:f},e(d,[2,5],{57:x,58:m,59:b,60:g}),e(d,[2,6]),e(d,[2,7]),{8:[1,131]},{8:[1,132]},{8:[1,133]},e(d,[2,8]),e(d,[2,16]),e(d,[2,17]),e(d,[2,18]),e(d,[2,19]),e(d,[2,20]),e(d,[2,21]),{26:[1,134]},e(d,[2,23]),e(d,[2,24]),e(d,[2,25]),e(d,[2,26]),e(d,[2,27]),e(d,[2,28]),e(d,[2,29]),e(d,[2,30]),{6:138,7:F,8:[1,140],10:9,13:Q,14:H,17:s,23:o,24:u,26:l,29:c,31:15,35:16,36:y,37:h,38:[1,135],39:136,40:137,47:139,53:12,54:13,55:17,78:p,79:f},{8:[1,145],28:[1,141],40:143,43:142,44:144,47:139},{8:M,11:S,12:146,19:_,20:L,22:Y,23:C,24:X,25:$,26:D,29:B,30:O,31:61,32:z,34:U,35:64,36:V,37:q,66:53,67:66,68:67,78:p,79:f},{8:[1,147]},e(K,[2,96]),e(K,[2,97]),e(K,[2,99]),{38:[1,148],42:re},e(ae,[2,102]),e(ae,[2,103],{49:[1,150]}),e(ie,[2,105],{41:[1,151]}),{8:M,11:S,19:_,20:L,22:Y,23:C,24:X,25:$,26:D,29:B,30:O,31:61,32:z,34:U,35:64,36:V,37:q,50:W,66:119,67:66,68:67,69:152,70:117,71:118,78:p,79:f},e(K,[2,113]),{28:[1,153],42:[1,154]},e(G,[2,116]),e(G,[2,117],{49:[1,155]}),e(se,[2,120],{45:[1,156]}),e(w,[2,52]),{8:n,10:157,23:o,24:u,26:l,29:c,31:15,35:16,36:y,37:h,53:12,54:13,55:17,78:p,79:f},e(j,[2,67]),e(G,[2,72]),e(G,[2,74],{57:x,58:m,59:b,60:g}),e(v,I),e(v,R),e(v,A),{8:oe,27:158,78:ue,80:159},e(d,[2,31]),{38:[1,162],42:le},{41:[1,164],42:ce},e(j,[2,35]),e(ye,[2,44]),e([16,38,42,57,58,59,60],E,{9:he,50:k,56:P}),e(d,[2,36]),{28:[1,167],42:pe},{41:[1,169],42:ce},e(G,[2,40]),e(G,fe,{9:he,45:de}),e(J,[2,78]),e(J,[2,81]),e(K,[2,100]),{8:M,11:S,19:_,20:L,22:Y,23:C,24:X,25:$,26:D,29:B,30:O,31:61,32:z,34:U,35:64,36:V,37:q,50:W,66:119,67:66,68:67,70:171,71:118,78:p,79:f},{8:[1,172]},{72:173,73:174,74:ve,79:xe},{42:re,51:[1,177]},e(K,[2,114]),{8:ee,76:178,77:124},{8:[1,179]},{8:M,11:S,19:_,20:L,22:Y,23:C,24:X,25:$,26:D,29:B,30:O,31:61,32:z,34:U,35:64,36:V,37:q,66:180,67:66,68:67,78:p,79:f},e(ne,[2,76],{57:x,58:m,59:b,60:g}),{28:[1,181],42:[1,182]},e(G,[2,129]),e(G,[2,126]),e(G,[2,127]),e(d,[2,32]),{6:183,7:F,8:n,10:9,13:Q,14:H,17:s,23:o,24:u,26:l,29:c,31:15,35:16,36:y,37:h,53:12,54:13,55:17,78:p,79:f},{6:138,7:F,8:n,10:9,13:Q,14:H,17:s,23:o,24:u,26:l,29:c,31:15,35:16,36:y,37:h,39:184,53:12,54:13,55:17,78:p,79:f},{8:[1,186],47:185},{6:187,7:F,8:n,10:9,13:Q,14:H,17:s,23:o,24:u,26:l,29:c,31:15,35:16,36:y,37:h,53:12,54:13,55:17,78:p,79:f},e(d,[2,37]),{8:me,44:188},{8:me,43:190,44:144},{6:192,7:F,8:n,10:9,13:Q,14:H,17:s,23:o,24:u,26:l,29:c,31:15,35:16,36:y,37:h,46:191,53:12,54:13,55:17,78:p,79:f},e(ae,[2,101]),e(ae,[2,104]),e(ie,[2,106]),e(ie,[2,112],{74:[1,193]}),{73:194,79:xe},e([38,42,49,51,74],[2,124]),e(ie,[2,107],{41:[1,195]}),e(G,[2,115]),e(G,[2,118]),e(se,[2,119]),e(d,[2,22]),{8:oe,78:ue,80:196},e(j,[2,34]),{38:[1,197],42:le},e(ye,[2,43]),{9:he},e(ye,[2,45]),e(G,[2,39]),e(G,fe,{45:de}),{28:[1,198],42:pe},e(G,[2,41],{41:[1,199]}),e(be,[2,47]),e(ie,[2,111],{73:200,79:xe}),e(ie,[2,110]),{72:201,73:174,74:ve,79:xe},e(G,[2,128]),e(d,[2,33]),e(d,[2,38]),{6:202,7:F,8:n,10:9,13:Q,14:H,17:s,23:o,24:u,26:l,29:c,31:15,35:16,36:y,37:h,53:12,54:13,55:17,78:p,79:f},e(ie,[2,109]),e(ie,[2,108]),e(be,[2,46])],defaultActions:{},parseError:function(e,t){if(!t.recoverable){var n=new Error(e);throw n.hash=t,n}this.trace(e)},parse:function(e){var t=this,n=[0],r=[null],a=[],i=this.table,s="",o=0,u=0,l=a.slice.call(arguments,1),c=Object.create(this.lexer),y={yy:{}};for(var h in this.yy)Object.prototype.hasOwnProperty.call(this.yy,h)&&(y.yy[h]=this.yy[h]);c.setInput(e,y.yy),y.yy.lexer=c,y.yy.parser=this,void 0===c.yylloc&&(c.yylloc={});var p=c.yylloc;a.push(p);var f=c.options&&c.options.ranges;"function"==typeof y.yy.parseError?this.parseError=y.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var d,v,x,m,b,g,w,E,k,P=function(){var e;return"number"!=typeof(e=c.lex()||1)&&(e=t.symbols_[e]||e),e},N={};;){if(x=n[n.length-1],this.defaultActions[x]?m=this.defaultActions[x]:(null==d&&(d=P()),m=i[x]&&i[x][d]),void 0===m||!m.length||!m[0]){var T="";for(g in k=[],i[x])this.terminals_[g]&&g>2&&k.push("'"+this.terminals_[g]+"'");T=c.showPosition?"Parse error on line "+(o+1)+":\n"+c.showPosition()+"\nExpecting "+k.join(", ")+", got '"+(this.terminals_[d]||d)+"'":"Parse error on line "+(o+1)+": Unexpected "+(1==d?"end of input":"'"+(this.terminals_[d]||d)+"'"),this.parseError(T,{text:c.match,token:this.terminals_[d]||d,line:c.yylineno,loc:p,expected:k})}if(m[0]instanceof Array&&m.length>1)throw new Error("Parse Error: multiple actions possible at state: "+x+", token: "+d);switch(m[0]){case 1:n.push(d),r.push(c.yytext),a.push(c.yylloc),n.push(m[1]),d=null,v?(d=v,v=null):(u=c.yyleng,s=c.yytext,o=c.yylineno,p=c.yylloc);break;case 2:if(w=this.productions_[m[1]][1],N.$=r[r.length-w],N._$={first_line:a[a.length-(w||1)].first_line,last_line:a[a.length-1].last_line,first_column:a[a.length-(w||1)].first_column,last_column:a[a.length-1].last_column},f&&(N._$.range=[a[a.length-(w||1)].range[0],a[a.length-1].range[1]]),void 0!==(b=this.performAction.apply(N,[s,u,o,y.yy,m[1],r,a].concat(l))))return b;w&&(n=n.slice(0,-1*w*2),r=r.slice(0,-1*w),a=a.slice(0,-1*w)),n.push(this.productions_[m[1]][0]),r.push(N.$),a.push(N._$),E=i[n[n.length-2]][n[n.length-1]],n.push(E);break;case 3:return!0}}return!0}},we={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(e,t){return this.yy=t||this.yy||{},this._input=e,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];return this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e,e.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,n=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t),this.offset-=t;var r=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1);var a=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===r.length?this.yylloc.first_column:0)+r[r.length-n.length].length-n[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[a[0],a[0]+this.yyleng-t]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},test_match:function(e,t){var n,r,a;if(this.options.backtrack_lexer&&(a={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(a.yylloc.range=this.yylloc.range.slice(0))),(r=e[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=r.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:r?r[r.length-1].length-r[r.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],n=this.performAction.call(this,this.yy,this,t,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),n)return n;if(this._backtrack){for(var i in a)this[i]=a[i];return!1}return!1},next:function(){if(this.done)return this.EOF;var e,t,n,r;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var a=this._currentRules(),i=0;i<a.length;i++)if((n=this._input.match(this.rules[a[i]]))&&(!t||n[0].length>t[0].length)){if(t=n,r=i,this.options.backtrack_lexer){if(!1!==(e=this.test_match(n,a[i])))return e;if(this._backtrack){t=!1;continue}return!1}if(!this.options.flex)break}return t?!1!==(e=this.test_match(t,a[r]))&&e:""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return e||this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.length-1>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(e){return(e=this.conditionStack.length-1-Math.abs(e||0))>=0?this.conditionStack[e]:"INITIAL"},pushState:function(e){this.begin(e)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(e,t,n,r){switch(n){case 0:case 1:break;case 2:return 19;case 3:return 20;case 4:return 49;case 5:return 22;case 6:return 25;case 7:return 24;case 8:return 7;case 9:return 29;case 10:return 30;case 11:return 32;case 12:return 11;case 13:return 34;case 14:return 13;case 15:return 23;case 16:return 14;case 17:return 36;case 18:return 50;case 19:return 51;case 20:return 26;case 21:return 28;case 22:return 37;case 23:return 38;case 24:return 65;case 25:return 42;case 26:return 45;case 27:return 41;case 28:return 9;case 29:return 16;case 30:return 74;case 31:return 56;case 32:return 17;case 33:return 57;case 34:return 58;case 35:return 59;case 36:return 60;case 37:return 8;case 38:return 79;case 39:return 78}},rules:[/^(?:\s+)/,/^(?:\/\/.*)/,/^(?:any)/,/^(?:array)/,/^(?:as)/,/^(?:boolean)/,/^(?:enum)/,/^(?:false)/,/^(?:generator)/,/^(?:null)/,/^(?:number)/,/^(?:object)/,/^(?:pattern)/,/^(?:string)/,/^(?:transform)/,/^(?:true)/,/^(?:type)/,/^(?:undefined)/,/^(?:\()/,/^(?:\))/,/^(?:{)/,/^(?:})/,/^(?:\[)/,/^(?:\])/,/^(?:\|)/,/^(?:,)/,/^(?::)/,/^(?:;)/,/^(?:=)/,/^(?:<=)/,/^(?:\.\.)/,/^(?:\.)/,/^(?:_)/,/^(?:\+)/,/^(?:-)/,/^(?:\*)/,/^(?:\/)/,/^(?:[a-zA-Z_][a-zA-Z0-9_]*)/,/^(?:[-+]?(0|[1-9]\d*)(\.\d+)?)/,/^(?:"[^"\r\n]*")/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39],inclusive:!0}}};function Ee(){this.yy={}}return ge.lexer=we,Ee.prototype=ge,ge.Parser=Ee,new Ee}();function p(e){return null!==e&&"object"===t(e)}var f=function(){function e(){n(this,e),this.types={},this.transforms={},this.patterns={},this.generators={},this.typeCreators={},this.messages=[],this.verbose=!1}return a(e,[{key:"addDefinitionsFromSource",value:function(e){var t=h.parse(e);this.addDefinitionsFromTable(t)}},{key:"addDefinitionsFromTable",value:function(e){var t=this;e.forEach(function(e){switch(e.type){case"type-assignment":t.types[e.name]=e.value;break;case"transform-assignment":t.transforms[e.name]=e.value;break;case"generator-assignment":t.generators[e.name]=e.value;break;case"pattern-assignment":t.patterns[e.name]=e.value}})}},{key:"addInfo",value:function(e){this.verbose&&this.messages.push({type:"message",level:"info",message:e})}},{key:"addWarning",value:function(e){this.messages.push({type:"message",level:"warning",message:e})}},{key:"addError",value:function(e){this.messages.push({type:"message",level:"error",message:e})}},{key:"execute",value:function(e,t){var n,r=h.parse(e),a=!0,i=!1,s=void 0;try{for(var o,u=r[Symbol.iterator]();!(a=(o=u.next()).done);a=!0){var l=o.value;switch(l.type){case"transform":if(void 0===(n=this.executeTransform(l,t)))break;break;case"type-reference":if(l.name in this.types){var c=this.types[l.name],y=this.executeType(c,t);return void 0===y?void this.addError("type ".concat(l.name," was unable to transform successfully")):y}return void this.addError("type is not defined: ".concat(l.name));case"generator-assignment":this.generators[l.name]=l.value;break;case"pattern-assignment":this.patterns[l.name]=l.value;break;case"transform-assignment":this.transforms[l.name]=l.value;break;case"type-assignment":this.types[l.name]=l.value;break;default:return void this.addError("unknown statement type: ".concat(l.type))}}}catch(e){i=!0,s=e}finally{try{a||null==u.return||u.return()}finally{if(i)throw s}}return n}},{key:"executeTransforms",value:function(e,t,n){var r=!0,a=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done);r=!0){var u=s.value,l=this.executeTransform(u,t,n);if(void 0!==l)return l}}catch(e){a=!0,i=e}finally{try{r||null==o.return||o.return()}finally{if(a)throw i}}}},{key:"executeTransform",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=t;if("transform-reference"===e.type){if(!(e.name in this.transforms))return void this.addError("undefined transform reference: '".concat(e.name,"'"));e=this.transforms[e.name]}if(null!==e.patterns){var a=void 0,i=!0,s=!1,o=void 0;try{for(var u,l=e.patterns[Symbol.iterator]();!(i=(u=l.next()).done);i=!0){var c=u.value;if(n=Object.create(n),void 0!==(a=this.executePattern(c,r,n))){r=null!==e.returnValue?this.executeGenerator(e.returnValue.expression,n):n;break}}}catch(e){s=!0,o=e}finally{try{i||null==l.return||l.return()}finally{if(s)throw o}}if(void 0===a)return void this.addError("Unable to match any type patterns")}else{p(r)&&(n=Object.create(Object.assign(n,r)));var y=this.executeGenerator(e.returnValue.expression,n);if(void 0===y)return void this.addError("Unable to apply generator to current object");r=y}return r}},{key:"executeType",value:function(e,t){switch(e.definition){case"any":return t;case"array":return this.executeArrayType(e,t);case"boolean":return"boolean"!=typeof t||null!==e.value&&e.value!==t?void 0:t;case"enumeration":return"string"==typeof t&&e.value.includes(t)?t:void 0;case"null":return null===t?t:void 0;case"number":return"number"!=typeof t||null!==e.value&&e.value!==t?void 0:t;case"object":return this.executeObjectType(e,t);case"string":return"string"!=typeof t||null!==e.value&&e.value!==t?void 0:t;case"undefined":return void 0===t?t:void 0;default:return void this.addError("Unrecognized type definition value: '".concat(e.definition,"'"))}}},{key:"executeArrayType",value:function(e,t){if(null===e.value)return Array.isArray(t)?t:void 0;var n=[],r={},a=!0,i=!1,s=void 0;try{for(var o,u=e.value[Symbol.iterator]();!(a=(o=u.next()).done);a=!0){var l=o.value;switch(l.type){case"transform":var c=this.executeTransform(l,t,r);if(void 0===c)return;n.push(c);break;case"assignment":if(void 0===this.executeAssignment(l,t,r))return;break;default:return void this.addError("Unknown element of array type: '".concat(l.type,"'"))}}}catch(e){i=!0,s=e}finally{try{a||null==u.return||u.return()}finally{if(i)throw s}}return n}},{key:"executeObjectType",value:function(e,t){if(null===e.value)return p(t)?t:void 0;var n={},r={},a=!0,i=!1,s=void 0;try{for(var o,u=e.value[Symbol.iterator]();!(a=(o=u.next()).done);a=!0){var l=o.value;switch(l.type){case"type-property":var c=void 0;if(null===l.value?p(t)&&l.name in t&&(c=t[l.name]):c=this.executeTransforms(l.value,t,r),void 0===c)return;n[l.name]=c;break;case"assignment":if(void 0===this.executeAssignment(l,t,r))return;break;default:return void this.addError("Unknown element of object type: '".concat(l.type,"'"))}}}catch(e){i=!0,s=e}finally{try{a||null==u.return||u.return()}finally{if(i)throw s}}return n}},{key:"executeAssignment",value:function(e,t,n){var r=this.executeTransform(e.value,t,n);if(void 0!==r)return n[e.name]=r,r}},{key:"executePattern",value:function(e,t,n){switch(e.patternType){case"any":return d(n,e.assignTo,t),t;case"array":return Array.isArray(t)?(d(n,e.assignTo,t),t):void 0;case"array-pattern":return this.executeArrayPattern(e,t,n);case"boolean":return"boolean"!=typeof t||null!==e.value&&e.value!==t?void 0:(d(n,e.assignTo,t),t);case"null":return null===t?(d(n,e.assignTo,t),t):void 0;case"number":return"number"!=typeof t||null!==e.value&&e.value!==t?void 0:(d(n,e.assignTo,t),t);case"object":return p(t)?(d(n,e.assignTo,t),t):void 0;case"object-pattern":if(!1===p(t))return;var r={},a=!0,i=!1,s=void 0;try{for(var o,u=e.value[Symbol.iterator]();!(a=(o=u.next()).done);a=!0){var l=o.value,c=l.name,y=l.pattern,h=l.assignTo;if(!(c in t))return;var f=this.executePattern(y,t[c],n);if(void 0===f)return;d(n,l.assignTo,t[c]),r[h]=f}}catch(e){i=!0,s=e}finally{try{a||null==u.return||u.return()}finally{if(i)throw s}}return d(n,e.assignTo,t),r;case"reference":if(e.value in this.patterns){var v=this.patterns[e.value],x=this.executePattern(v,t,n);return void 0!==x&&d(n,e.assignTo,x),x}return;case"string":return"string"!=typeof t||null!==e.value&&e.value!==t?void 0:(d(n,e.assignTo,t),t);case"undefined":return void 0===t?(d(n,e.assignTo,t),t):void 0;default:throw new TypeError("unrecognized pattern type: '".concat(e.type,"'"))}}},{key:"executeArrayPattern",value:function(e,t,n){if(!1!==Array.isArray(t)){var r=[],a=0,i=!0,s=!1,o=void 0;try{for(var u,l=e.value[Symbol.iterator]();!(i=(u=l.next()).done);i=!0){var c=u.value,y=this.executeArrayPatternElement(c,a,t,n);if(void 0===y)return;r=r.concat(y),a+=y.length}}catch(e){s=!0,o=e}finally{try{i||null==l.return||l.return()}finally{if(s)throw o}}return a===t.length?(d(n,e.assignTo,t),r):void 0}}},{key:"executeArrayPatternElement",value:function(e,t,n,r){var a=[];switch(e.type){case"element":var i=this.executeArrayElementPattern(e,t,n,r);if(void 0===i)return;a=a.concat(i),t+=i.length;break;case"element-group":var s=this.executeArrayElementGroupPattern(e,t,n,r);if(void 0===s)return;a=a.concat(s),t+=s.length;break;default:return void this.addError("Unrecognized array pattern element type: '".concat(e.type,"'"))}return a}},{key:"executeArrayElementPattern",value:function(e,t,n,r){for(var a=e.pattern,i=e.range,s=i.start,o=i.stop,u=[],l=0;l<o;l++){var c=t+l,y=c<n.length?this.executePattern(a,n[c],r):void 0;if(void 0===y){if(l>=s)break;return}d(r,e.assignTo,y),u.push(y)}return u}},{key:"executeArrayElementGroupPattern",value:function(e,t,n,r){var a=e.elements,i=e.range,s=i.start,o=i.stop,u=[],l=!0,c=!1,y=void 0;try{for(var h,p=a[Symbol.iterator]();!(l=(h=p.next()).done);l=!0)for(var f=h.value,d=0;d<o;d++){var v=this.executeArrayPatternElement(f,t,n,r);if(void 0===v)return d>=s?u:void 0;u=u.concat(v),t+=v.length}}catch(e){c=!0,y=e}finally{try{l||null==p.return||p.return()}finally{if(c)throw y}}return u}},{key:"executeGenerator",value:function(e,t){var n=this,r=function(r){var a=n.executeGenerator(e.left.expression,t);if(void 0!==a&&"number"==typeof a){var i=n.executeGenerator(e.right.expression,t);if(void 0!==i&&"number"==typeof i)return r(a,i)}};switch(e.type){case"get-value":return t[e.name];case"get-property":var a=this.executeGenerator(e.left,t);return p(a)?a[e.right]:void 0;case"add":return r(function(e,t){return e+t});case"subtract":return r(function(e,t){return e-t});case"multiply":return r(function(e,t){return e*t});case"divide":return r(function(e,t){return e/t});case"invoke":var i=e.args.map(function(e){return n.executeGenerator(e.expression,t)});return this.createType(e.name,i);case"array":return e.value.map(function(e){return n.executeGenerator(e.expression,t)});case"boolean":case"null":case"number":case"string":case"undefined":return e.value;case"object":var s={},o=!0,u=!1,l=void 0;try{for(var c,y=e.value[Symbol.iterator]();!(o=(c=y.next()).done);o=!0){var h=c.value;s[h.name]=this.executeGenerator(h.expression,t)}}catch(e){u=!0,l=e}finally{try{o||null==y.return||y.return()}finally{if(u)throw l}}return s;default:return void this.addError("Unrecognized generator expression type: '".concat(e.type,"'"))}}},{key:"createType",value:function(e,t){var n;return e in this.typeCreators?(n=this.typeCreators)[e].apply(n,s(t)):"*"in this.typeCreators?this.typeCreators["*"](e,t):void 0}}],[{key:"fromSource",value:function(t){var n=new e;return n.addDefinitionsFromSource(t),n}},{key:"fromTable",value:function(t){var n=new e;return n.addDefinitionsFromTable(t),n}}]),e}();function d(e,t,n){null!=t&&(t in e&&console.log("warning: overwriting ".concat(t," in symbol table")),e[t]=n)}var v=function(){function e(t,r){n(this,e),this.name=t,this.args=r}return a(e,null,[{key:"arc",value:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return x(e.ARC,n,["center","radiusX","radiusY","startRadians","endRadians"])}},{key:"quadraticBezier",value:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return x(e.QUADRATIC_BEZIER,n,["p1","p2","p3"])}},{key:"cubicBezier",value:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return x(e.CUBIC_BEZIER,n,["p1","p2","p3","p4"])}},{key:"circle",value:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return x(e.CIRCLE,n,["center","radius"])}},{key:"ellipse",value:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return x(e.ELLIPSE,n,["center","radiusX","radiusY"])}},{key:"line",value:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return x(e.LINE,n,["p1","p2"])}},{key:"path",value:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return x(e.PATH,n,["segments"])}},{key:"polygon",value:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return x(e.POLYGON,n,["points"])}},{key:"polyline",value:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return x(e.POLYLINE,n,["point"])}},{key:"rectangle",value:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return x(e.RECTANGLE,n,["topLeft","bottomRight"])}}]),e}();function x(e,t,n){var r;1===t.length?(t=t[0],r=e):r=e+"Array";var a=m.execute("type ".concat(r),t);if(void 0===a)throw new TypeError("".concat(e," is not in a recognizable format: ").concat(JSON.stringify(t)));var i=n.map(function(e){return a[e]});return new v(e,i)}v.ARC="Arc",v.QUADRATIC_BEZIER="Bezier2",v.CUBIC_BEZIER="Bezier3",v.CIRCLE="Circle",v.ELLIPSE="Ellipse",v.LINE="Line",v.PATH="Path",v.POLYGON="Polygon",v.POLYLINE="Polyline",v.RECTANGLE="Rectangle";var m=f.fromSource("\ntransform Center =\n    Point2D(x, y) <=\n            { center: { x: number as x, y: number as y } }\n        |   { center: [ number as x, number as y ] }\n        |   { cx: number as x, cy: number as y }\n        |   { centerX: number as x, centerY: number as y }\n\ntransform Radii =\n    // the generator could also be _, but I like being explicit\n    { rx, ry } <=\n            { radii: { x: number as rx, y: number as ry } }\n        |   { radii: [ number as rx, number as ry ] }\n        |   { rx: number as rx, ry: number as ry }\n        |   { radiusX: number as rx, radiusY: number as ry }\n        \ntransform P1 =\n    Point2D(x, y) <=\n            { p1: { x: number as x, y: number as y } }\n        |   { p1: [ number as x, number as y ] }\n        \ntransform P2 =\n    Point2D(x, y) <=\n            { p2: { x: number as x, y: number as y } }\n        |   { p2: [ number as x, number as y ] }\n        |   { p2x: number as x, p2y: number as y }\n        \ntransform P3 =\n    Point2D(x, y) <=\n            { p3: { x: number as x, y: number as y } }\n        |   { p3: [ number as x, number as y ] }\n        |   { p3x: number as x, p3y: number as y }\n        \ntransform P4 =\n    Point2D(x, y) <=\n            { p4: { x: number as x, y: number as y } }\n        |   { p4: [ number as x, number as y ] }\n        |   { p4x: number as x, p4y: number as y }\n\ntransform Number =\n    _ <= number\n            \ntype ".concat(v.ARC," = {\n    // collect some values so we don't have to repeat queries\n    radii = transform Radii;\n    \n    center: transform Center,\n    radiusX: radii.rx,\n    radiusY: radii.ry,\n    startRadians: transform Number,\n    endRadians: transform Number\n}\n\ntype ").concat(v.ARC,"Array = {\n    elements =\n        _ <= [\n            number as centerX,\n            number as centerY,\n            number as radiusX,\n            number as radiusY,\n            number as startRadians,\n            number as endRadians\n        ];\n    \n    center: Point2D(elements.centerX, elements.centerY),\n    radiusX: elements.radiusX,\n    radiusY: elements.radiusY,\n    startRadians: elements.startRadians,\n    endRadians: elements.endRadians\n}\n\ntype ").concat(v.QUADRATIC_BEZIER," = {\n    p1: transform P1,\n    p2: transform P2,\n    p3: transform P3\n}\n\ntype ").concat(v.CUBIC_BEZIER," = {\n    p1: transform P1,\n    p2: transform P2,\n    p3: transform P3,\n    p4: transform P4\n}\n\ntype ").concat(v.CIRCLE," = {\n    center: transform Center,\n    radius: radius <=\n            { r: number as radius}\n        |   { radius: number as radius }\n}\n\ntype ").concat(v.CIRCLE,"Array = {\n    elements =\n        _ <=\n                [ number as centerX, number as centerY, number as radius ]\n            |   [ { x: number as centerX, y: number as centerY }, number as radius ];\n    \n    center: Point2D(elements.centerX, elements.centerY),\n    radius: elements.radius\n}\n\ntype ").concat(v.ELLIPSE," = {\n    // collect some values so we don't have to repeat queries\n    radii = transform Radii;\n    \n    center: transform Center,\n    radiusX: radii.rx,\n    radiusY: radii.ry\n}\n\ntype ").concat(v.ELLIPSE,"Array = {\n    elements =\n        _ <=\n                [ number as centerX, number as centerY, number as radiusX, number as radiusY ]\n            |   [ { x: number as centerX, y: number as centerY }, number as radiusX, number as radiusY ];\n    \n    center: Point2D(elements.centerX, elements.centerY),\n    radiusX: elements.radiusX,\n    radiusY: elements.radiusY\n}\n\ntype ").concat(v.LINE," = {\n    p1: transform P1,\n    p2: transform P2\n}\n\ntype ").concat(v.LINE,"Array = {\n    elements =\n        _ <=\n                [ number as p1x, number as p1y, number as p2x, number as p2y ]\n            |   [ { x: number as p1x, y: number as p1y }, { x: number as p2x, y: number as p2y } ];\n        \n    p1: Point2D(elements.p1x, elements.p1y),\n    p2: Point2D(elements.p2x, elements.p2y)\n}\n\ntype ").concat(v.PATH," = {\n    segments:\n        PathData(data) <= { d: string as data }\n}\n\ntype ").concat(v.POLYGON," = {\n    points:\n        ListOfCoords(coords) <= { points: [ (number, number); 0..] as coords };\n        ListOfPoints(points) <= { points: [ { x: number, y: number }; 0.. ] as points }\n}\n\ntype ").concat(v.POLYGON,"Array = {\n    elements =\n        ListOfCoords(coords) <=\n                [ (number, number); 0..] as coords;\n        \n    points: elements\n}\n\ntype ").concat(v.POLYLINE," = {\n    points:\n        ListOfCoords(coords) <= { points: [ (number, number); 0..] as coords };\n        ListOfPoints(points) <= { points: [ { x: number, y: number }; 0.. ] as points }\n}\n\ntype ").concat(v.POLYLINE,"Array = {\n    elements =\n        ListOfCoords(coords) <=\n                [ (number, number); 0..] as coords;\n        \n    points: elements\n}\n\ntype ").concat(v.RECTANGLE," = {\n    // collect top-left point in case we need to do math with it for\n    // bottom-right\n    topLeft =\n        // could also be _\n        { x, y } <=\n                { topLeft: { x: number as x, y: number as y } }\n            |   { topLeft: [ number as x, number as y ] }\n            |   { x: number as x, y: number as y }\n            |   { top: number as x, left: number as y };\n\n    topLeft:\n        Point2D(topLeft.x, topLeft.y),\n\n    bottomRight:\n        Point2D(x, y) <=\n                { bottomRight: { x: number as x, y: number as y } }\n            |   { bottomRight: [ number as x, number as y ] };\n        Point2D(topLeft.x + w, topLeft.y + h) <=\n                { w: number as w, h: number as h }\n            |   { width: number as w, height: number as h }\n            |   { size: { x: number as w, y: number as h } }\n            |   { size: [ number as w, number as h ] }\n}\n\ntype ").concat(v.RECTANGLE,"Array = {\n    elements =\n        _ <=\n                [ number as x, number as y, number as width, number as height ]\n            |   [ { x: number as x, y: number as y }, { x: number as width, y: number as height } ];\n    \n    topLeft: Point2D(elements.x, elements.y),\n    bottomRight: Point2D(elements.x + elements.width, elements.y + elements.height)\n}\n"));m.typeCreators.Point2D=function(e,t){return new o(e,t)},m.typeCreators.ListOfCoords=function(e){for(var t=[],n=0;n<e.length;n+=2){var r=e[n],a=e[n+1];t.push(new o(r,a))}return t},m.typeCreators.ListOfPoints=function(e){return e.map(function(e){return new o(e.x,e.y)})};var b=2*Math.PI,g=new u(1,0);function w(e){return null==e}function E(e){var t=e%b;return t<0?t+b:t}function k(e,t,n,r,a,i){if(0===e.points.length)return e;var s=new N("No Intersection"),o=E(a),l=E(i);l<o&&(l+=b),console.log("[startRadians = ".concat(a," endRadians = ").concat(i,"]")),console.log("[startNormal = ".concat(o," endRadians = ").concat(l,"]"));var c=!0,y=!1,h=void 0;try{for(var p,f=e.points[Symbol.iterator]();!(c=(p=f.next()).done);c=!0){var d=p.value,v=E(g.angleBetween(u.fromPoints(t,d)));o<=v&&v<=l&&s.appendPoint(d)}}catch(e){y=!0,h=e}finally{try{c||null==f.return||f.return()}finally{if(y)throw h}}return s.points.length>0&&(s.status="Intersection"),s}function P(e){var t=e.slice();return t.push(e[0]),t}var N=function(){function e(t){n(this,e),this.init(t)}return a(e,[{key:"init",value:function(e){this.status=e,this.points=[]}},{key:"appendPoint",value:function(e){this.points.push(e)}},{key:"appendPoints",value:function(e){this.points=this.points.concat(e)}}],[{key:"intersect",value:function(t,n){var r;if(w(t)||w(n))r=new e("No Intersection");else if("Path"===t.name)r=e.intersectPathShape(t,n);else if("Path"===n.name)r=e.intersectPathShape(n,t);else if("Arc"===t.name)r=e.intersectArcShape(t,n);else if("Arc"===n.name)r=e.intersectArcShape(n,t);else{var a,i;if(t.name<n.name?(a="intersect"+t.name+n.name,i=t.args.concat(n.args)):(a="intersect"+n.name+t.name,i=n.args.concat(t.args)),!(a in e))throw new TypeError("Intersection not available: "+a);r=e[a].apply(null,i)}return r}},{key:"intersectPathShape",value:function(t,n){var r=new e("No Intersection"),a=!0,i=!1,s=void 0;try{for(var o,u=t.args[Symbol.iterator]();!(a=(o=u.next()).done);a=!0){var l=o.value,c=e.intersect(l,n);r.appendPoints(c.points)}}catch(e){i=!0,s=e}finally{try{a||null==u.return||u.return()}finally{if(i)throw s}}return r.points.length>0&&(r.status="Intersection"),r}},{key:"intersectArcShape",value:function(t,n){var r=i(t.args,5),a=r[0],s=r[1],o=r[2],u=r[3],l=r[4],c=new v(v.ELLIPSE,[a,s,o]);return k(e.intersect(c,n),a,0,0,u,l)}},{key:"intersectBezier2Bezier2",value:function(t,n,r,a,i,s){var u,l,c=new e("No Intersection");u=n.multiply(-2);var h=t.add(u.add(r));u=t.multiply(-2),l=n.multiply(2);var p=u.add(l),f=new o(t.x,t.y);u=i.multiply(-2);var d=a.add(u.add(s));u=a.multiply(-2),l=i.multiply(2);var v=u.add(l),x=new o(a.x,a.y);u=h.x*p.y-p.x*h.y,l=d.x*p.y-p.x*d.y;var m=v.x*p.y-p.x*v.y,b=p.x*(f.y-x.y)+p.y*(-f.x+x.x),g=d.x*h.y-h.x*d.y,w=v.x*h.y-h.x*v.y,E=h.x*(f.y-x.y)+h.y*(-f.x+x.x),k=new y(-g*g,-2*g*w,u*l-w*w-2*g*E,u*m-2*w*E,u*b-E*E).getRoots(),P=!0,N=!1,T=void 0;try{for(var I,R=k[Symbol.iterator]();!(P=(I=R.next()).done);P=!0){var A=I.value;if(0<=A&&A<=1){var M=new y(h.x,p.x,f.x-x.x-A*v.x-A*A*d.x);M.simplifyEquals();var S=M.getRoots(),_=new y(h.y,p.y,f.y-x.y-A*v.y-A*A*d.y);_.simplifyEquals();var L=_.getRoots();if(S.length>0&&L.length>0){var Y=!0,C=!1,X=void 0;try{e:for(var $,D=S[Symbol.iterator]();!(Y=($=D.next()).done);Y=!0){var B=$.value;if(0<=B&&B<=1)for(var O=0;O<L.length;O++)if(Math.abs(B-L[O])<1e-4){c.points.push(d.multiply(A*A).add(v.multiply(A).add(x)));break e}}}catch(e){C=!0,X=e}finally{try{Y||null==D.return||D.return()}finally{if(C)throw X}}}}}}catch(e){N=!0,T=e}finally{try{P||null==R.return||R.return()}finally{if(N)throw T}}return c.points.length>0&&(c.status="Intersection"),c}},{key:"intersectBezier2Bezier3",value:function(t,n,r,a,i,s,u){var l,c,h,p,f=new e("No Intersection");l=n.multiply(-2);var d=t.add(l.add(r));l=t.multiply(-2),c=n.multiply(2);var v=l.add(c),x=new o(t.x,t.y);l=a.multiply(-1),c=i.multiply(3),h=s.multiply(-3),p=l.add(c.add(h.add(u)));var m=new o(p.x,p.y);l=a.multiply(3),c=i.multiply(-6),h=s.multiply(3),p=l.add(c.add(h));var b=new o(p.x,p.y);l=a.multiply(-3),c=i.multiply(3),h=l.add(c);var g=new o(h.x,h.y),w=new o(a.x,a.y),E=x.x*x.x,k=x.y*x.y,P=v.x*v.x,N=v.y*v.y,T=d.x*d.x,I=d.y*d.y,R=w.x*w.x,A=w.y*w.y,M=g.x*g.x,S=g.y*g.y,_=b.x*b.x,L=b.y*b.y,Y=m.x*m.x,C=m.y*m.y,X=new y(-2*d.x*d.y*m.x*m.y+T*C+I*Y,-2*d.x*d.y*b.x*m.y-2*d.x*d.y*b.y*m.x+2*I*b.x*m.x+2*T*b.y*m.y,-2*d.x*g.x*d.y*m.y-2*d.x*d.y*g.y*m.x-2*d.x*d.y*b.x*b.y+2*g.x*I*m.x+I*_+T*(2*g.y*m.y+L),2*x.x*d.x*d.y*m.y+2*x.y*d.x*d.y*m.x+v.x*v.y*d.x*m.y+v.x*v.y*d.y*m.x-2*w.x*d.x*d.y*m.y-2*d.x*w.y*d.y*m.x-2*d.x*g.x*d.y*b.y-2*d.x*d.y*g.y*b.x-2*x.x*I*m.x-2*x.y*T*m.y+2*w.x*I*m.x+2*g.x*I*b.x-N*d.x*m.x-P*d.y*m.y+T*(2*w.y*m.y+2*g.y*b.y),2*x.x*d.x*d.y*b.y+2*x.y*d.x*d.y*b.x+v.x*v.y*d.x*b.y+v.x*v.y*d.y*b.x-2*w.x*d.x*d.y*b.y-2*d.x*w.y*d.y*b.x-2*d.x*g.x*d.y*g.y-2*x.x*I*b.x-2*x.y*T*b.y+2*w.x*I*b.x-N*d.x*b.x-P*d.y*b.y+M*I+T*(2*w.y*b.y+S),2*x.x*d.x*d.y*g.y+2*x.y*d.x*g.x*d.y+v.x*v.y*d.x*g.y+v.x*v.y*g.x*d.y-2*w.x*d.x*d.y*g.y-2*d.x*w.y*g.x*d.y-2*x.x*g.x*I-2*x.y*T*g.y+2*w.x*g.x*I-N*d.x*g.x-P*d.y*g.y+2*T*w.y*g.y,-2*x.x*x.y*d.x*d.y-x.x*v.x*v.y*d.y-x.y*v.x*v.y*d.x+2*x.x*d.x*w.y*d.y+2*x.y*w.x*d.x*d.y+v.x*w.x*v.y*d.y+v.x*v.y*d.x*w.y-2*w.x*d.x*w.y*d.y-2*x.x*w.x*I+x.x*N*d.x+x.y*P*d.y-2*x.y*T*w.y-w.x*N*d.x-P*w.y*d.y+E*I+k*T+R*I+T*A).getRootsInInterval(0,1),$=!0,D=!1,B=void 0;try{for(var O,z=X[Symbol.iterator]();!($=(O=z.next()).done);$=!0){var U=O.value,V=new y(d.x,v.x,x.x-w.x-U*g.x-U*U*b.x-U*U*U*m.x).getRoots(),q=new y(d.y,v.y,x.y-w.y-U*g.y-U*U*b.y-U*U*U*m.y).getRoots();if(V.length>0&&q.length>0){var j=!0,G=!1,F=void 0;try{e:for(var Q,H=V[Symbol.iterator]();!(j=(Q=H.next()).done);j=!0){var Z=Q.value;if(0<=Z&&Z<=1)for(var J=0;J<q.length;J++)if(Math.abs(Z-q[J])<1e-4){f.points.push(m.multiply(U*U*U).add(b.multiply(U*U).add(g.multiply(U).add(w))));break e}}}catch(e){G=!0,F=e}finally{try{j||null==H.return||H.return()}finally{if(G)throw F}}}}}catch(e){D=!0,B=e}finally{try{$||null==z.return||z.return()}finally{if(D)throw B}}return f.points.length>0&&(f.status="Intersection"),f}},{key:"intersectBezier2Circle",value:function(t,n,r,a,i){return e.intersectBezier2Ellipse(t,n,r,a,i,i)}},{key:"intersectBezier2Ellipse",value:function(t,n,r,a,i,s){var u,l=new e("No Intersection");u=n.multiply(-2);var c=t.add(u.add(r));u=t.multiply(-2);var h=n.multiply(2),p=u.add(h),f=new o(t.x,t.y),d=i*i,v=s*s,x=new y(v*c.x*c.x+d*c.y*c.y,2*(v*c.x*p.x+d*c.y*p.y),v*(2*c.x*f.x+p.x*p.x)+d*(2*c.y*f.y+p.y*p.y)-2*(v*a.x*c.x+d*a.y*c.y),2*(v*p.x*(f.x-a.x)+d*p.y*(f.y-a.y)),v*(f.x*f.x+a.x*a.x)+d*(f.y*f.y+a.y*a.y)-2*(v*a.x*f.x+d*a.y*f.y)-d*v).getRoots(),m=!0,b=!1,g=void 0;try{for(var w,E=x[Symbol.iterator]();!(m=(w=E.next()).done);m=!0){var k=w.value;0<=k&&k<=1&&l.points.push(c.multiply(k*k).add(p.multiply(k).add(f)))}}catch(e){b=!0,g=e}finally{try{m||null==E.return||E.return()}finally{if(b)throw g}}return l.points.length>0&&(l.status="Intersection"),l}},{key:"intersectBezier2Line",value:function(t,n,r,a,i){var s,l=a.min(i),c=a.max(i),h=new e("No Intersection");s=n.multiply(-2);var p=t.add(s.add(r));s=t.multiply(-2);var f=n.multiply(2),d=s.add(f),v=new o(t.x,t.y),x=new u(a.y-i.y,i.x-a.x),m=a.x*i.y-i.x*a.y,b=new y(x.dot(p),x.dot(d),x.dot(v)+m).getRoots(),g=!0,w=!1,E=void 0;try{for(var k,P=b[Symbol.iterator]();!(g=(k=P.next()).done);g=!0){var N=k.value;if(0<=N&&N<=1){var T=t.lerp(n,N),I=n.lerp(r,N),R=T.lerp(I,N);a.x===i.x?l.y<=R.y&&R.y<=c.y&&(h.status="Intersection",h.appendPoint(R)):a.y===i.y?l.x<=R.x&&R.x<=c.x&&(h.status="Intersection",h.appendPoint(R)):l.x<=R.x&&R.x<=c.x&&l.y<=R.y&&R.y<=c.y&&(h.status="Intersection",h.appendPoint(R))}}}catch(e){w=!0,E=e}finally{try{g||null==P.return||P.return()}finally{if(w)throw E}}return h}},{key:"intersectBezier2Polygon",value:function(t,n,r,a){return e.intersectBezier2Polyline(t,n,r,P(a))}},{key:"intersectBezier2Polyline",value:function(t,n,r,a){for(var i=new e("No Intersection"),s=a.length,o=0;o<s-1;o++){var u=a[o],l=a[o+1],c=e.intersectBezier2Line(t,n,r,u,l);i.appendPoints(c.points)}return i.points.length>0&&(i.status="Intersection"),i}},{key:"intersectBezier2Rectangle",value:function(t,n,r,a,i){var s=a.min(i),u=a.max(i),l=new o(u.x,s.y),c=new o(s.x,u.y),y=e.intersectBezier2Line(t,n,r,s,l),h=e.intersectBezier2Line(t,n,r,l,u),p=e.intersectBezier2Line(t,n,r,u,c),f=e.intersectBezier2Line(t,n,r,c,s),d=new e("No Intersection");return d.appendPoints(y.points),d.appendPoints(h.points),d.appendPoints(p.points),d.appendPoints(f.points),d.points.length>0&&(d.status="Intersection"),d}},{key:"intersectBezier3Bezier3",value:function(t,n,r,a,i,s,u,l){var c,h,p,f,d=new e("No Intersection");c=t.multiply(-1),h=n.multiply(3),p=r.multiply(-3),f=c.add(h.add(p.add(a)));var v=new o(f.x,f.y);c=t.multiply(3),h=n.multiply(-6),p=r.multiply(3),f=c.add(h.add(p));var x=new o(f.x,f.y);c=t.multiply(-3),h=n.multiply(3),p=c.add(h);var m=new o(p.x,p.y),b=new o(t.x,t.y);c=i.multiply(-1),h=s.multiply(3),p=u.multiply(-3),f=c.add(h.add(p.add(l)));var g=new o(f.x,f.y);c=i.multiply(3),h=s.multiply(-6),p=u.multiply(3),f=c.add(h.add(p));var w=new o(f.x,f.y);c=i.multiply(-3),h=s.multiply(3),p=c.add(h);var E=new o(p.x,p.y),k=new o(i.x,i.y);c=v.x*x.y-x.x*v.y,h=v.x*m.y-m.x*v.y;var P=v.x*b.y-b.x*v.y+k.x*v.y-v.x*k.y,N=E.x*v.y-v.x*E.y,T=w.x*v.y-v.x*w.y,I=g.x*v.y-v.x*g.y;f=v.x*m.y-m.x*v.y;var R=v.x*b.y+x.x*m.y-m.x*x.y-b.x*v.y+k.x*v.y-v.x*k.y,A=E.x*v.y-v.x*E.y,M=w.x*v.y-v.x*w.y,S=g.x*v.y-v.x*g.y,_=x.x*b.y-b.x*x.y+k.x*x.y-x.x*k.y,L=E.x*x.y-x.x*E.y,Y=w.x*x.y-x.x*w.y,C=g.x*x.y-x.x*g.y,X=v.x*b.y-b.x*v.y+k.x*v.y-v.x*k.y,$=E.x*v.y-v.x*E.y,D=w.x*v.y-v.x*w.y,B=g.x*v.y-v.x*g.y,O=x.x*b.y-b.x*x.y+k.x*x.y-x.x*k.y,z=E.x*x.y-x.x*E.y,U=w.x*x.y-x.x*w.y,V=g.x*x.y-x.x*g.y,q=m.x*b.y-b.x*m.y+k.x*m.y-m.x*k.y,j=E.x*m.y-m.x*E.y,G=w.x*m.y-m.x*w.y,F=g.x*m.y-m.x*g.y,Q=new y(-I*S*B,-I*S*D-I*M*B-T*S*B,-I*S*$-I*M*D-T*S*D-I*A*B-T*M*B-N*S*B,-I*S*X-I*M*$-T*S*$-I*A*D-T*M*D-N*S*D-I*R*B-T*A*B-N*M*B-P*S*B+h*C*B+I*f*V-c*C*V+c*S*F,-I*M*X-T*S*X-I*A*$-T*M*$-N*S*$-I*R*D-T*A*D-N*M*D-P*S*D+h*C*D-T*R*B-N*A*B-P*M*B+h*Y*B+I*f*U-c*C*U+T*f*V-c*Y*V+c*S*G+c*M*F,-I*A*X-T*M*X-N*S*X-I*R*$-T*A*$-N*M*$-P*S*$+h*C*$-T*R*D-N*A*D-P*M*D+h*Y*D-N*R*B-P*A*B+h*L*B+I*f*z-c*C*z+T*f*U-c*Y*U+N*f*V-c*L*V+c*S*j+c*M*G+c*A*F,-I*R*X-T*A*X-N*M*X-P*S*X+h*C*X-T*R*$-N*A*$-P*M*$+h*Y*$-N*R*D-P*A*D+h*L*D-P*R*B+h*_*B+I*f*O-c*C*O+T*f*z-c*Y*z+N*f*U-c*L*U+P*f*V-c*_*V+c*S*q+c*M*j+c*A*G-h*f*F+c*R*F,-T*R*X-N*A*X-P*M*X+h*Y*X-N*R*$-P*A*$+h*L*$-P*R*D+h*_*D+T*f*O-c*Y*O+N*f*z-c*L*z+P*f*U-c*_*U+c*M*q+c*A*j-h*f*G+c*R*G,-N*R*X-P*A*X+h*L*X-P*R*$+h*_*$+N*f*O-c*L*O+P*f*z-c*_*z+c*A*q-h*f*j+c*R*j,-P*R*X+h*_*X+P*f*O-c*_*O-h*f*q+c*R*q);Q.simplifyEquals();var H=Q.getRootsInInterval(0,1),Z=!0,J=!1,K=void 0;try{for(var W,ee=H[Symbol.iterator]();!(Z=(W=ee.next()).done);Z=!0){var te=W.value,ne=new y(v.x,x.x,m.x,b.x-k.x-te*E.x-te*te*w.x-te*te*te*g.x);ne.simplifyEquals();var re=ne.getRoots(),ae=new y(v.y,x.y,m.y,b.y-k.y-te*E.y-te*te*w.y-te*te*te*g.y);ae.simplifyEquals();var ie=ae.getRoots();if(re.length>0&&ie.length>0){var se=!0,oe=!1,ue=void 0;try{e:for(var le,ce=re[Symbol.iterator]();!(se=(le=ce.next()).done);se=!0){var ye=le.value;if(0<=ye&&ye<=1)for(var he=0;he<ie.length;he++)if(Math.abs(ye-ie[he])<1e-4){d.points.push(g.multiply(te*te*te).add(w.multiply(te*te).add(E.multiply(te).add(k))));break e}}}catch(e){oe=!0,ue=e}finally{try{se||null==ce.return||ce.return()}finally{if(oe)throw ue}}}}}catch(e){J=!0,K=e}finally{try{Z||null==ee.return||ee.return()}finally{if(J)throw K}}return d.points.length>0&&(d.status="Intersection"),d}},{key:"intersectBezier3Circle",value:function(t,n,r,a,i,s){return e.intersectBezier3Ellipse(t,n,r,a,i,s,s)}},{key:"intersectBezier3Ellipse",value:function(t,n,r,a,i,s,u){var l,c,h,p,f=new e("No Intersection");l=t.multiply(-1),c=n.multiply(3),h=r.multiply(-3),p=l.add(c.add(h.add(a)));var d=new o(p.x,p.y);l=t.multiply(3),c=n.multiply(-6),h=r.multiply(3),p=l.add(c.add(h));var v=new o(p.x,p.y);l=t.multiply(-3),c=n.multiply(3),h=l.add(c);var x=new o(h.x,h.y),m=new o(t.x,t.y),b=s*s,g=u*u,w=new y(d.x*d.x*g+d.y*d.y*b,2*(d.x*v.x*g+d.y*v.y*b),2*(d.x*x.x*g+d.y*x.y*b)+v.x*v.x*g+v.y*v.y*b,2*d.x*g*(m.x-i.x)+2*d.y*b*(m.y-i.y)+2*(v.x*x.x*g+v.y*x.y*b),2*v.x*g*(m.x-i.x)+2*v.y*b*(m.y-i.y)+x.x*x.x*g+x.y*x.y*b,2*x.x*g*(m.x-i.x)+2*x.y*b*(m.y-i.y),m.x*m.x*g-2*m.y*i.y*b-2*m.x*i.x*g+m.y*m.y*b+i.x*i.x*g+i.y*i.y*b-b*g).getRootsInInterval(0,1),E=!0,k=!1,P=void 0;try{for(var N,T=w[Symbol.iterator]();!(E=(N=T.next()).done);E=!0){var I=N.value;f.points.push(d.multiply(I*I*I).add(v.multiply(I*I).add(x.multiply(I).add(m))))}}catch(e){k=!0,P=e}finally{try{E||null==T.return||T.return()}finally{if(k)throw P}}return f.points.length>0&&(f.status="Intersection"),f}},{key:"intersectBezier3Line",value:function(t,n,r,a,i,s){var o,l,c,h,p=i.min(s),f=i.max(s),d=new e("No Intersection");o=t.multiply(-1),l=n.multiply(3),c=r.multiply(-3),h=o.add(l.add(c.add(a)));var v=new u(h.x,h.y);o=t.multiply(3),l=n.multiply(-6),c=r.multiply(3),h=o.add(l.add(c));var x=new u(h.x,h.y);o=t.multiply(-3),l=n.multiply(3),c=o.add(l);var m=new u(c.x,c.y),b=new u(t.x,t.y),g=new u(i.y-s.y,s.x-i.x),w=i.x*s.y-s.x*i.y,E=new y(g.dot(v),g.dot(x),g.dot(m),g.dot(b)+w).getRoots(),k=!0,P=!1,N=void 0;try{for(var T,I=E[Symbol.iterator]();!(k=(T=I.next()).done);k=!0){var R=T.value;if(0<=R&&R<=1){var A=t.lerp(n,R),M=n.lerp(r,R),S=r.lerp(a,R),_=A.lerp(M,R),L=M.lerp(S,R),Y=_.lerp(L,R);i.x===s.x?p.y<=Y.y&&Y.y<=f.y&&(d.status="Intersection",d.appendPoint(Y)):i.y===s.y?p.x<=Y.x&&Y.x<=f.x&&(d.status="Intersection",d.appendPoint(Y)):p.x<=Y.x&&Y.x<=f.x&&p.y<=Y.y&&Y.y<=f.y&&(d.status="Intersection",d.appendPoint(Y))}}}catch(e){P=!0,N=e}finally{try{k||null==I.return||I.return()}finally{if(P)throw N}}return d}},{key:"intersectBezier3Polygon",value:function(t,n,r,a,i){return e.intersectBezier3Polyline(t,n,r,a,P(i))}},{key:"intersectBezier3Polyline",value:function(t,n,r,a,i){for(var s=new e("No Intersection"),o=i.length,u=0;u<o-1;u++){var l=i[u],c=i[u+1],y=e.intersectBezier3Line(t,n,r,a,l,c);s.appendPoints(y.points)}return s.points.length>0&&(s.status="Intersection"),s}},{key:"intersectBezier3Rectangle",value:function(t,n,r,a,i,s){var u=i.min(s),l=i.max(s),c=new o(l.x,u.y),y=new o(u.x,l.y),h=e.intersectBezier3Line(t,n,r,a,u,c),p=e.intersectBezier3Line(t,n,r,a,c,l),f=e.intersectBezier3Line(t,n,r,a,l,y),d=e.intersectBezier3Line(t,n,r,a,y,u),v=new e("No Intersection");return v.appendPoints(h.points),v.appendPoints(p.points),v.appendPoints(f.points),v.appendPoints(d.points),v.points.length>0&&(v.status="Intersection"),v}},{key:"intersectCircleCircle",value:function(t,n,r,a){var i,s=n+a,u=Math.abs(n-a),l=t.distanceFrom(r);if(l>s)i=new e("Outside");else if(l<u)i=new e("Inside");else{i=new e("Intersection");var c=(n*n-a*a+l*l)/(2*l),y=Math.sqrt(n*n-c*c),h=t.lerp(r,c/l),p=y/l;i.points.push(new o(h.x-p*(r.y-t.y),h.y+p*(r.x-t.x))),i.points.push(new o(h.x+p*(r.y-t.y),h.y-p*(r.x-t.x)))}return i}},{key:"intersectCircleEllipse",value:function(t,n,r,a,i){return e.intersectEllipseEllipse(t,n,n,r,a,i)}},{key:"intersectCircleLine",value:function(t,n,r,a){var i,s=(a.x-r.x)*(a.x-r.x)+(a.y-r.y)*(a.y-r.y),o=2*((a.x-r.x)*(r.x-t.x)+(a.y-r.y)*(r.y-t.y)),u=o*o-4*s*(t.x*t.x+t.y*t.y+r.x*r.x+r.y*r.y-2*(t.x*r.x+t.y*r.y)-n*n);if(u<0)i=new e("Outside");else if(0===u)i=new e("Tangent");else{var l=Math.sqrt(u),c=(-o+l)/(2*s),y=(-o-l)/(2*s);(c<0||c>1)&&(y<0||y>1)?i=new e(c<0&&y<0||c>1&&y>1?"Outside":"Inside"):(i=new e("Intersection"),0<=c&&c<=1&&i.points.push(r.lerp(a,c)),0<=y&&y<=1&&i.points.push(r.lerp(a,y)))}return i}},{key:"intersectCirclePolygon",value:function(t,n,r){return e.intersectCirclePolyline(t,n,P(r))}},{key:"intersectCirclePolyline",value:function(t,n,r){for(var a,i=new e("No Intersection"),s=r.length,o=0;o<s-1;o++){var u=r[o],l=r[o+1];a=e.intersectCircleLine(t,n,u,l),i.appendPoints(a.points)}return i.points.length>0?i.status="Intersection":i.status=a.status,i}},{key:"intersectCircleRectangle",value:function(t,n,r,a){var i=r.min(a),s=r.max(a),u=new o(s.x,i.y),l=new o(i.x,s.y),c=e.intersectCircleLine(t,n,i,u),y=e.intersectCircleLine(t,n,u,s),h=e.intersectCircleLine(t,n,s,l),p=e.intersectCircleLine(t,n,l,i),f=new e("No Intersection");return f.appendPoints(c.points),f.appendPoints(y.points),f.appendPoints(h.points),f.appendPoints(p.points),f.points.length>0?f.status="Intersection":f.status=c.status,f}},{key:"intersectEllipseEllipse",value:function(t,n,r,a,i,s){for(var u,l,c,h,p,f,d,v,x,m,b,g,w,E,k,P=[r*r,0,n*n,-2*r*r*t.x,-2*n*n*t.y,r*r*t.x*t.x+n*n*t.y*t.y-n*n*r*r],N=[s*s,0,i*i,-2*s*s*a.x,-2*i*i*a.y,s*s*a.x*a.x+i*i*a.y*a.y-i*i*s*s],T=(l=N,c=(u=P)[0]*l[1]-l[0]*u[1],h=u[0]*l[2]-l[0]*u[2],p=u[0]*l[3]-l[0]*u[3],f=u[0]*l[4]-l[0]*u[4],d=u[0]*l[5]-l[0]*u[5],v=u[1]*l[2]-l[1]*u[2],x=u[1]*l[4]-l[1]*u[4],m=u[1]*l[5]-l[1]*u[5],b=u[2]*l[3]-l[2]*u[3],g=u[3]*l[4]-l[3]*u[4],w=u[3]*l[5]-l[3]*u[5],new y(c*v-h*h,c*(k=x-b)+p*v-2*h*f,c*(E=m+g)+p*k-f*f-2*h*d,c*w+p*E-2*f*d,p*w-d*d)).getRoots(),I=.001*(P[0]*P[0]+2*P[1]*P[1]+P[2]*P[2]),R=.001*(N[0]*N[0]+2*N[1]*N[1]+N[2]*N[2]),A=new e("No Intersection"),M=0;M<T.length;M++)for(var S=new y(P[0],P[3]+T[M]*P[1],P[5]+T[M]*(P[4]+T[M]*P[2])).getRoots(),_=0;_<S.length;_++){var L=(P[0]*S[_]+P[1]*T[M]+P[3])*S[_]+(P[2]*T[M]+P[4])*T[M]+P[5];Math.abs(L)<I&&(L=(N[0]*S[_]+N[1]*T[M]+N[3])*S[_]+(N[2]*T[M]+N[4])*T[M]+N[5],Math.abs(L)<R&&A.appendPoint(new o(S[_],T[M])))}return A.points.length>0&&(A.status="Intersection"),A}},{key:"intersectEllipseLine",value:function(t,n,r,a,i){var s,o=new u(a.x,a.y),l=u.fromPoints(a,i),c=new u(t.x,t.y),y=o.subtract(c),h=new u(l.x/(n*n),l.y/(r*r)),p=new u(y.x/(n*n),y.y/(r*r)),f=l.dot(h),d=l.dot(p),v=d*d-f*(t=y.dot(p)-1);if(v<0)s=new e("Outside");else if(v>0){var x=Math.sqrt(v),m=(-d-x)/f,b=(-d+x)/f;(m<0||1<m)&&(b<0||1<b)?s=new e(m<0&&b<0||m>1&&b>1?"Outside":"Inside"):(s=new e("Intersection"),0<=m&&m<=1&&s.appendPoint(a.lerp(i,m)),0<=b&&b<=1&&s.appendPoint(a.lerp(i,b)))}else{var g=-d/f;0<=g&&g<=1?(s=new e("Intersection")).appendPoint(a.lerp(i,g)):s=new e("Outside")}return s}},{key:"intersectEllipsePolygon",value:function(t,n,r,a){return e.intersectEllipsePolyline(t,n,r,P(a))}},{key:"intersectEllipsePolyline",value:function(t,n,r,a){for(var i=new e("No Intersection"),s=a.length,o=0;o<s-1;o++){var u=a[o],l=a[o+1],c=e.intersectEllipseLine(t,n,r,u,l);i.appendPoints(c.points)}return i.points.length>0&&(i.status="Intersection"),i}},{key:"intersectEllipseRectangle",value:function(t,n,r,a,i){var s=a.min(i),u=a.max(i),l=new o(u.x,s.y),c=new o(s.x,u.y),y=e.intersectEllipseLine(t,n,r,s,l),h=e.intersectEllipseLine(t,n,r,l,u),p=e.intersectEllipseLine(t,n,r,u,c),f=e.intersectEllipseLine(t,n,r,c,s),d=new e("No Intersection");return d.appendPoints(y.points),d.appendPoints(h.points),d.appendPoints(p.points),d.appendPoints(f.points),d.points.length>0&&(d.status="Intersection"),d}},{key:"intersectLineLine",value:function(t,n,r,a){var i,s=(a.x-r.x)*(t.y-r.y)-(a.y-r.y)*(t.x-r.x),u=(n.x-t.x)*(t.y-r.y)-(n.y-t.y)*(t.x-r.x),l=(a.y-r.y)*(n.x-t.x)-(a.x-r.x)*(n.y-t.y);if(0!==l){var c=s/l,y=u/l;0<=c&&c<=1&&0<=y&&y<=1?(i=new e("Intersection")).points.push(new o(t.x+c*(n.x-t.x),t.y+c*(n.y-t.y))):i=new e("No Intersection")}else i=new e(0===s||0===u?"Coincident":"Parallel");return i}},{key:"intersectLinePolygon",value:function(t,n,r){return e.intersectLinePolyline(t,n,P(r))}},{key:"intersectLinePolyline",value:function(t,n,r){for(var a=new e("No Intersection"),i=r.length,s=0;s<i-1;s++){var o=r[s],u=r[s+1],l=e.intersectLineLine(t,n,o,u);a.appendPoints(l.points)}return a.points.length>0&&(a.status="Intersection"),a}},{key:"intersectLineRectangle",value:function(t,n,r,a){var i=r.min(a),s=r.max(a),u=new o(s.x,i.y),l=new o(i.x,s.y),c=e.intersectLineLine(i,u,t,n),y=e.intersectLineLine(u,s,t,n),h=e.intersectLineLine(s,l,t,n),p=e.intersectLineLine(l,i,t,n),f=new e("No Intersection");return f.appendPoints(c.points),f.appendPoints(y.points),f.appendPoints(h.points),f.appendPoints(p.points),f.points.length>0&&(f.status="Intersection"),f}},{key:"intersectPolygonPolygon",value:function(t,n){return e.intersectPolylinePolyline(P(t),P(n))}},{key:"intersectPolygonPolyline",value:function(t,n){return e.intersectPolylinePolyline(P(t),n)}},{key:"intersectPolygonRectangle",value:function(t,n,r){return e.intersectPolylineRectangle(P(t),n,r)}},{key:"intersectPolylinePolyline",value:function(t,n){for(var r=new e("No Intersection"),a=t.length,i=0;i<a-1;i++){var s=t[i],o=t[i+1],u=e.intersectLinePolyline(s,o,n);r.appendPoints(u.points)}return r.points.length>0&&(r.status="Intersection"),r}},{key:"intersectPolylineRectangle",value:function(t,n,r){var a=n.min(r),i=n.max(r),s=new o(i.x,a.y),u=new o(a.x,i.y),l=e.intersectLinePolyline(a,s,t),c=e.intersectLinePolyline(s,i,t),y=e.intersectLinePolyline(i,u,t),h=e.intersectLinePolyline(u,a,t),p=new e("No Intersection");return p.appendPoints(l.points),p.appendPoints(c.points),p.appendPoints(y.points),p.appendPoints(h.points),p.points.length>0&&(p.status="Intersection"),p}},{key:"intersectRectangleRectangle",value:function(t,n,r,a){var i=t.min(n),s=t.max(n),u=new o(s.x,i.y),l=new o(i.x,s.y),c=e.intersectLineRectangle(i,u,r,a),y=e.intersectLineRectangle(u,s,r,a),h=e.intersectLineRectangle(s,l,r,a),p=e.intersectLineRectangle(l,i,r,a),f=new e("No Intersection");return f.appendPoints(c.points),f.appendPoints(y.points),f.appendPoints(h.points),f.appendPoints(p.points),f.points.length>0&&(f.status="Intersection"),f}},{key:"intersectRayRay",value:function(t,n,r,a){var i,s=(a.x-r.x)*(t.y-r.y)-(a.y-r.y)*(t.x-r.x),u=(n.x-t.x)*(t.y-r.y)-(n.y-t.y)*(t.x-r.x),l=(a.y-r.y)*(n.x-t.x)-(a.x-r.x)*(n.y-t.y);if(0!==l){var c=s/l;(i=new e("Intersection")).points.push(new o(t.x+c*(n.x-t.x),t.y+c*(n.y-t.y)))}else i=new e(0===s||0===u?"Coincident":"Parallel");return i}}]),e}(),T=function(){function e(t,r){n(this,e),this.type=t,this.text=r}return a(e,[{key:"typeis",value:function(e){return this.type===e}}]),e}();T.UNDEFINED=0,T.COMMAND=1,T.NUMBER=2,T.EOD=3;var I=function(){function e(t){n(this,e),null==t&&(t=""),this.setPathData(t)}return a(e,[{key:"setPathData",value:function(e){if("string"!=typeof e)throw new TypeError("The first parameter must be a string");this._pathData=e}},{key:"getNextToken",value:function(){for(var e=null,t=this._pathData;null===e;)if(null===t||""===t)e=new T(T.EOD,"");else if(t.match(/^([ \t\r\n,]+)/))t=t.substr(RegExp.$1.length);else if(t.match(/^([AaCcHhLlMmQqSsTtVvZz])/))e=new T(T.COMMAND,RegExp.$1),t=t.substr(RegExp.$1.length);else{if(!t.match(/^(([-+]?\d+(\.\d*)?|[-+]?\.\d+)([eE][-+]?\d+)?)/))throw new SyntaxError("Unrecognized path data: ".concat(t));e=new T(T.NUMBER,RegExp.$1),t=t.substr(RegExp.$1.length)}return this._pathData=t,e}}]),e}(),R=function(){function e(){n(this,e),this._lexer=new I,this._handler=null}return a(e,[{key:"parseData",value:function(t){if("string"!=typeof t)throw new TypeError("The first parameter must be a string: ".concat(t));null!==this._handler&&"function"==typeof this._handler.beginParse&&this._handler.beginParse();var n=this._lexer;n.setPathData(t);for(var r="BOP",a=null,i=n.getNextToken();!1===i.typeis(T.EOD);){var s=void 0,o=[];switch(i.type){case T.COMMAND:if("BOP"===r&&"M"!==i.text&&"m"!==i.text)throw new SyntaxError("New paths must begin with a moveto command. Found '".concat(i.text,"'"));r=i.text,s=e.PARAMCOUNT[i.text.toUpperCase()],i=n.getNextToken();break;case T.NUMBER:if("BOP"===r)throw new SyntaxError("New paths must begin with a moveto command. Found '".concat(i.text,"'"));s=e.PARAMCOUNT[r.toUpperCase()];break;default:throw new SyntaxError("Unrecognized command type: ".concat(i.type))}for(var u=0;u<s;u++){switch(i.type){case T.COMMAND:throw new SyntaxError("Parameter must be a number. Found '".concat(i.text,"'"));case T.NUMBER:o[u]=parseFloat(i.text);break;case T.EOD:throw new SyntaxError("Unexpected end of string");default:throw new SyntaxError("Unrecognized parameter type. Found type '".concat(i.type,"'"))}i=n.getNextToken()}if(null!==this._handler){var l=this._handler,c=e.METHODNAME[r];"a"!==r&&"A"!==r||(o[3]=0!==o[3],o[4]=0!==o[4]),null!==l&&"function"==typeof l[c]&&l[c].apply(l,o)}switch(r){case"M":r="L";break;case"m":r="l";break;case"Z":case"z":r="BOP"}if(i===a)throw new SyntaxError("Parser stalled on '".concat(i.text,"'"));a=i}null!==this._handler&&"function"==typeof this._handler.endParse&&this._handler.endParse()}},{key:"setHandler",value:function(e){this._handler=e}}]),e}();R.PARAMCOUNT={A:7,C:6,H:1,L:2,M:2,Q:4,S:4,T:2,V:1,Z:0},R.METHODNAME={A:"arcAbs",a:"arcRel",C:"curvetoCubicAbs",c:"curvetoCubicRel",H:"linetoHorizontalAbs",h:"linetoHorizontalRel",L:"linetoAbs",l:"linetoRel",M:"movetoAbs",m:"movetoRel",Q:"curvetoQuadraticAbs",q:"curvetoQuadraticRel",S:"curvetoCubicSmoothAbs",s:"curvetoCubicSmoothRel",T:"curvetoQuadraticSmoothAbs",t:"curvetoQuadraticSmoothRel",V:"linetoVerticalAbs",v:"linetoVerticalRel",Z:"closePath",z:"closePath"};var A=2*Math.PI;function M(e,t,n,r,a,i,s){a=a*Math.PI/180;var o=Math.cos(a),l=Math.sin(a),c=e.subtract(t).multiply(.5),y=c.x*o+c.y*l,h=c.x*-l+c.y*o,p=y*y,f=h*h,d=p/((n=Math.abs(n))*n)+f/((r=Math.abs(r))*r);if(d>1){var v=Math.sqrt(d);n*=v,r*=v}var x=n*n,m=r*r,b=x*f,g=m*p,w=(x*m-b-g)/(b+g);Math.abs(w)<1e-6&&(w=0);var E=Math.sqrt(w);i===s&&(E=-E);var k,P,N=e.add(t).multiply(.5),T=E*n*h/r,I=E*-r*y/n,R=(y-T)/n,M=(y+T)/n,S=(h-I)/r,_=(h+I)/r,L=new u(1,0).angleBetween(new u(R,S)),Y=(k=new u(R,S).angleBetween(new u(-M,-_)),(P=k%A)<0?P+A:P);return!1===s&&(Y-=A),[T*o-I*l+N.x,T*l+I*o+N.y,n,r,L,L+Y]}var S=function(){function e(){n(this,e),this.shapes=[],this.firstX=null,this.firstY=null,this.lastX=null,this.lastY=null,this.lastCommand=null}return a(e,[{key:"beginParse",value:function(){this.shapes=[],this.firstX=null,this.firstY=null,this.lastX=null,this.lastY=null,this.lastCommand=null}},{key:"addShape",value:function(e){this.shapes.push(e)}},{key:"arcAbs",value:function(e,t,n,r,a,i,u){if(0===e||0===t)this.addShape(Y.line(this.lastX,this.lastY,i,u));else{var l=M(new o(this.lastX,this.lastY),new o(i,u),e,t,n,r,a);this.addShape(Y.arc.apply(Y,s(l)))}this.lastCommand="A",this.lastX=i,this.lastY=u}},{key:"arcRel",value:function(e,t,n,r,a,i,u){if(0===e||0===t)this.addShape(Y.line(this.lastX,this.lastY,this.lastX+i,this.lastY+u));else{var l=M(new o(this.lastX,this.lastY),new o(this.lastX+i,this.lastY+u),e,t,n,r,a);this.addShape(Y.arc.apply(Y,s(l)))}this.lastCommand="a",this.lastX+=i,this.lastY+=u}},{key:"curvetoCubicAbs",value:function(e,t,n,r,a,i){this.addShape(Y.cubicBezier(this.lastX,this.lastY,e,t,n,r,a,i)),this.lastX=a,this.lastY=i,this.lastCommand="C"}},{key:"curvetoCubicRel",value:function(e,t,n,r,a,i){this.addShape(Y.cubicBezier(this.lastX,this.lastY,this.lastX+e,this.lastY+t,this.lastX+n,this.lastY+r,this.lastX+a,this.lastY+i)),this.lastX+=a,this.lastY+=i,this.lastCommand="c"}},{key:"linetoHorizontalAbs",value:function(e){this.addShape(Y.line(this.lastX,this.lastY,e,this.lastY)),this.lastX=e,this.lastCommand="H"}},{key:"linetoHorizontalRel",value:function(e){this.addShape(Y.line(this.lastX,this.lastY,this.lastX+e,this.lastY)),this.lastX+=e,this.lastCommand="h"}},{key:"linetoAbs",value:function(e,t){this.addShape(Y.line(this.lastX,this.lastY,e,t)),this.lastX=e,this.lastY=t,this.lastCommand="L"}},{key:"linetoRel",value:function(e,t){this.addShape(Y.line(this.lastX,this.lastY,this.lastX+e,this.lastY+t)),this.lastX+=e,this.lastY+=t,this.lastCommand="l"}},{key:"movetoAbs",value:function(e,t){this.firstX=e,this.firstY=t,this.lastX=e,this.lastY=t,this.lastCommand="M"}},{key:"movetoRel",value:function(e,t){this.firstX+=e,this.firstY+=t,this.lastX+=e,this.lastY+=t,this.lastCommand="m"}},{key:"curvetoQuadraticAbs",value:function(e,t,n,r){this.addShape(Y.quadraticBezier(this.lastX,this.lastY,e,t,n,r)),this.lastX=n,this.lastY=r,this.lastCommand="Q"}},{key:"curvetoQuadraticRel",value:function(e,t,n,r){this.addShape(Y.quadraticBezier(this.lastX,this.lastY,this.lastX+e,this.lastY+t,this.lastX+n,this.lastY+r)),this.lastX+=n,this.lastY+=r,this.lastCommand="q"}},{key:"curvetoCubicSmoothAbs",value:function(e,t,n,r){var a,i;if(this.lastCommand.match(/^[SsCc]$/)){var s=this.shapes[this.shapes.length-1].args[2];a=2*this.lastX-s.x,i=2*this.lastY-s.y}else a=this.lastX,i=this.lastY;this.addShape(Y.cubicBezier(this.lastX,this.lastY,a,i,e,t,n,r)),this.lastX=n,this.lastY=r,this.lastCommand="S"}},{key:"curvetoCubicSmoothRel",value:function(e,t,n,r){var a,i;if(this.lastCommand.match(/^[SsCc]$/)){var s=this.shapes[this.shapes.length-1].args[2];a=2*this.lastX-s.x,i=2*this.lastY-s.y}else a=this.lastX,i=this.lastY;this.addShape(Y.cubicBezier(this.lastX,this.lastY,a,i,this.lastX+e,this.lastY+t,this.lastX+n,this.lastY+r)),this.lastX+=n,this.lastY+=r,this.lastCommand="s"}},{key:"curvetoQuadraticSmoothAbs",value:function(e,t){var n,r;if(this.lastCommand.match(/^[QqTt]$/)){var a=this.shapes[this.shapes.length-1].args[1];n=2*this.lastX-a.x,r=2*this.lastY-a.y}else n=this.lastX,r=this.lastY;this.addShape(Y.quadraticBezier(this.lastX,this.lastY,n,r,e,t)),this.lastX=e,this.lastY=t,this.lastCommand="T"}},{key:"curvetoQuadraticSmoothRel",value:function(e,t){var n,r;if(this.lastCommand.match(/^[QqTt]$/)){var a=this.shapes[this.shapes.length-1].args[1];n=2*this.lastX-a.x,r=2*this.lastY-a.y}else n=this.lastX,r=this.lastY;this.addShape(Y.quadraticBezier(this.lastX,this.lastY,n,r,this.lastX+e,this.lastY+t)),this.lastX+=e,this.lastY+=t,this.lastCommand="t"}},{key:"linetoVerticalAbs",value:function(e){this.addShape(Y.line(this.lastX,this.lastY,this.lastX,e)),this.lastY=e,this.lastCommand="V"}},{key:"linetoVerticalRel",value:function(e){this.addShape(Y.line(this.lastX,this.lastY,this.lastX,this.lastY+e)),this.lastY+=e,this.lastCommand="v"}},{key:"closePath",value:function(){this.addShape(Y.line(this.lastX,this.lastY,this.firstX,this.firstY)),this.lastX=this.firstX,this.lastY=this.firstY,this.lastCommand="z"}}]),e}(),_=new R,L=new S;_.setHandler(L);var Y=function(){function e(){n(this,e)}return a(e,null,[{key:"arc",value:function(e,t,n,r,a,i){if(isNaN(e))throw TypeError("Expected centerX to be a number, but found ".concat(e));if(isNaN(t))throw TypeError("Expected centerY to be a number, but found ".concat(t));if(isNaN(n))throw TypeError("Expected radiusX to be a number, but found ".concat(n));if(isNaN(r))throw TypeError("Expected radiusY to be a number, but found ".concat(r));if(isNaN(a))throw TypeError("Expected startRadians to be a number, but found ".concat(a));if(isNaN(i))throw TypeError("Expected endRadians to be a number, but found ".concat(i));return new v(v.ARC,[new o(e,t),n,r,a,i])}},{key:"quadraticBezier",value:function(e,t,n,r,a,i){if(isNaN(e))throw TypeError("Expected p1x to be a number, but found ".concat(e));if(isNaN(t))throw TypeError("Expected p1y to be a number, but found ".concat(t));if(isNaN(n))throw TypeError("Expected p2x to be a number, but found ".concat(n));if(isNaN(r))throw TypeError("Expected p2y to be a number, but found ".concat(r));if(isNaN(a))throw TypeError("Expected p3x to be a number, but found ".concat(a));if(isNaN(i))throw TypeError("Expected p3y to be a number, but found ".concat(i));return new v(v.QUADRATIC_BEZIER,[new o(e,t),new o(n,r),new o(a,i)])}},{key:"cubicBezier",value:function(e,t,n,r,a,i,s,u){if(isNaN(e))throw TypeError("Expected p1x to be a number, but found ".concat(e));if(isNaN(t))throw TypeError("Expected p1y to be a number, but found ".concat(t));if(isNaN(n))throw TypeError("Expected p2x to be a number, but found ".concat(n));if(isNaN(r))throw TypeError("Expected p2y to be a number, but found ".concat(r));if(isNaN(a))throw TypeError("Expected p3x to be a number, but found ".concat(a));if(isNaN(i))throw TypeError("Expected p3y to be a number, but found ".concat(i));if(isNaN(s))throw TypeError("Expected p4x to be a number, but found ".concat(s));if(isNaN(u))throw TypeError("Expected p4y to be a number, but found ".concat(u));return new v(v.CUBIC_BEZIER,[new o(e,t),new o(n,r),new o(a,i),new o(s,u)])}},{key:"circle",value:function(e,t,n){if(isNaN(e))throw TypeError("Expected centerX to be a number, but found ".concat(e));if(isNaN(t))throw TypeError("Expected centerY to be a number, but found ".concat(t));if(isNaN(n))throw TypeError("Expected radius to be a number, but found ".concat(n));return new v(v.CIRCLE,[new o(e,t),n])}},{key:"ellipse",value:function(e,t,n,r){if(isNaN(e))throw TypeError("Expected centerX to be a number, but found ".concat(e));if(isNaN(t))throw TypeError("Expected centerY to be a number, but found ".concat(t));if(isNaN(n))throw TypeError("Expected radiusX to be a number, but found ".concat(n));if(isNaN(r))throw TypeError("Expected radiusY to be a number, but found ".concat(r));return new v(v.ELLIPSE,[new o(e,t),n,r])}},{key:"line",value:function(e,t,n,r){if(isNaN(e))throw TypeError("Expected p1x to be a number, but found ".concat(e));if(isNaN(t))throw TypeError("Expected p1y to be a number, but found ".concat(t));if(isNaN(n))throw TypeError("Expected p2x to be a number, but found ".concat(n));if(isNaN(r))throw TypeError("Expected p2y to be a number, but found ".concat(r));return new v(v.LINE,[new o(e,t),new o(n,r)])}},{key:"path",value:function(e){if("string"!=typeof e)throw TypeError("Expected pathData to be a string, but found ".concat(e));return _.parseData(e),new v(v.PATH,L.shapes)}},{key:"polygon",value:function(e){if(!1===Array.isArray(e))throw TypeError("Expected points to be an Array, but found ".concat(e));if(e.some(function(e){return isNaN(e)}))throw TypeError("Expected all members of coords to be numbers");for(var t=[],n=0;n<e.length;n+=2)t.push(new o(e[n],e[n+1]));return new v(v.POLYGON,[t])}},{key:"polyline",value:function(e){if(!1===Array.isArray(e))throw TypeError("Expected points to be an Array, but found ".concat(e));if(e.some(function(e){return isNaN(e)}))throw TypeError("Expected all members of coords to be numbers");for(var t=[],n=0;n<e.length;n+=2)t.push(new o(e[n],e[n+1]));return new v(v.POLYLINE,[t])}},{key:"rectangle",value:function(t,n,r,a){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(isNaN(t))throw TypeError("Expected x to be a number, but found ".concat(t));if(isNaN(n))throw TypeError("Expected y to be a number, but found ".concat(n));if(isNaN(r))throw TypeError("Expected width to be a number, but found ".concat(r));if(isNaN(a))throw TypeError("Expected height to be a number, but found ".concat(a));if(isNaN(i))throw TypeError("Expected rx to be a number, but found ".concat(i));if(isNaN(s))throw TypeError("Expected ry to be a number, but found ".concat(s));if(0===i&&0===s)return new v(v.RECTANGLE,[new o(t,n),new o(t+r,n+a)]);0===i&&(i=s),0===s&&(s=i),i>.5*r&&(i=.5*r),s>.5*a&&(s=.5*a);var u=t,l=n,c=t+i,y=n+s,h=t+r-i,p=n+a-s,f=t+r,d=n+a,x=.5*Math.PI,m=[];return m.push(e.arc(c,y,i,s,2*x,3*x)),m.push(e.line(c,l,h,l)),m.push(e.arc(h,y,i,s,3*x,4*x)),m.push(e.line(f,y,f,p)),m.push(e.arc(h,p,i,s,0,x)),m.push(e.line(h,d,c,d)),m.push(e.arc(c,p,i,s,x,2*x)),m.push(e.line(u,p,u,y)),v(v.PATH,m)}}]),e}(),C=function(){function e(){n(this,e)}return a(e,null,[{key:"arc",value:function(e,t,n,r,a){if(e instanceof o==!1)throw TypeError("Expected center to be a Point2D, but found ".concat(e));if(isNaN(t))throw TypeError("Expected radiusX to be a number, but found ".concat(t));if(isNaN(n))throw TypeError("Expected radiusY to be a number, but found ".concat(n));if(isNaN(r))throw TypeError("Expected startRadians to be a number, but found ".concat(r));if(isNaN(a))throw TypeError("Expected endRadians to be a number, but found ".concat(a));return new v(v.ARC,[e,t,n,r,a])}},{key:"quadraticBezier",value:function(e,t,n){if(e instanceof o==!1)throw TypeError("Expected p1 to be a Point2D, but found ".concat(e));if(t instanceof o==!1)throw TypeError("Expected p2 to be a Point2D, but found ".concat(t));if(n instanceof o==!1)throw TypeError("Expected p3 to be a Point2D, but found ".concat(n));return new v(v.QUADRATIC_BEZIER,[e,t,n])}},{key:"cubicBezier",value:function(e,t,n,r){if(e instanceof o==!1)throw TypeError("Expected p1 to be a Point2D, but found ".concat(e));if(t instanceof o==!1)throw TypeError("Expected p2 to be a Point2D, but found ".concat(t));if(n instanceof o==!1)throw TypeError("Expected p3 to be a Point2D, but found ".concat(n));if(r instanceof o==!1)throw TypeError("Expected p4 to be a Point2D, but found ".concat(r));return new v(v.CUBIC_BEZIER,[e,t,n,r])}},{key:"circle",value:function(e,t){if(e instanceof o==!1)throw TypeError("Expected center to be a Point2D, but found ".concat(e));if(isNaN(t))throw TypeError("Expected radius to be a number, but found ".concat(t));return new v(v.CIRCLE,[e,t])}},{key:"ellipse",value:function(e,t,n){if(e instanceof o==!1)throw TypeError("Expected center to be a Point2D, but found ".concat(e));if(isNaN(t))throw TypeError("Expected radiusX to be a number, but found ".concat(t));if(isNaN(n))throw TypeError("Expected radiusY to be a number, but found ".concat(n));return new v(v.ELLIPSE,[e,t,n])}},{key:"line",value:function(e,t){if(e instanceof o==!1)throw TypeError("Expected p1 to be a Point2D, but found ".concat(e));if(t instanceof o==!1)throw TypeError("Expected p2 to be a Point2D, but found ".concat(t));return new v(v.LINE,[e,t])}},{key:"path",value:function(e){return Y.path(e)}},{key:"polygon",value:function(e){if(!1===Array.isArray(e))throw TypeError("Expected points to be an Array, but found ".concat(e));if(e.some(function(e){return e instanceof o==!1}))throw TypeError("Expected all members of points to be Point2Ds");return new v(v.POLYGON,[e])}},{key:"polyline",value:function(e){if(e.some(function(e){return e instanceof o==!1}))throw TypeError("Expected all members of points to be Point2Ds");return new v(v.POLYLINE,[e])}},{key:"rectangle",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(e instanceof o==!1)throw TypeError("Expected topLeft to be a Point2D, but found ".concat(e));if(t instanceof u==!1)throw TypeError("Expected size to be a Vector2D, but found ".concat(t));if(isNaN(n))throw TypeError("Expected rx to be a number, but found ".concat(n));if(isNaN(r))throw TypeError("Expected ry to be a number, but found ".concat(r));return Y.rectangle(e.x,e.y,t.x,t.y,n,r)}}]),e}(),X=function(){function e(){n(this,e)}return a(e,null,[{key:"circle",value:function(e){if(e instanceof SVGCircleElement==!1)throw new TypeError("Expected SVGCircleElement, but found ".concat(e));var t=new o(e.cx.baseVal.value,e.cy.baseVal.value),n=e.r.baseVal.value;return new v(v.CIRCLE,[t,n])}},{key:"ellipse",value:function(e){if(e instanceof SVGEllipseElement==!1)throw new TypeError("Expected SVGEllipseElement, but found ".concat(e));var t=new o(e.cx.baseVal.value,e.cy.baseVal.value),n=e.rx.baseVal.value,r=e.ry.baseVal.value;return new v(v.ELLIPSE,[t,n,r])}},{key:"line",value:function(e){if(e instanceof SVGLineElement==!1)throw new TypeError("Expected SVGLineElement, but found ".concat(e));var t=new o(e.x1.baseVal.value,e.y1.baseVal.value),n=new o(e.x2.baseVal.value,e.y2.baseVal.value);return new v(v.LINE,[t,n])}},{key:"path",value:function(e){if(e instanceof SVGPathElement==!1)throw new TypeError("Expected SVGPathElement, but found ".concat(e));var t=e.getAttributeNS(null,"d");return Y.path(t)}},{key:"polygon",value:function(e){if(e instanceof SVGPolygonElement==!1)throw new TypeError("Expected SVGPolygonElement, but found ".concat(e));for(var t=[],n=0;n<e.points.numberOfItems;n++){var r=e.points.getItem(n);t.push(new o(r.x,r.y))}return new v(v.POLYGON,[t])}},{key:"polyline",value:function(e){if(e instanceof SVGPolylineElement==!1)throw new TypeError("Expected SVGPolylineElement, but found ".concat(e));for(var t=[],n=0;n<e.points.numberOfItems;n++){var r=e.points.getItem(n);t.push(new o(r.x,r.y))}return new v(v.POLYLINE,[t])}},{key:"rect",value:function(e){if(e instanceof SVGRectElement==!1)throw new TypeError("Expected SVGRectElement, but found ".concat(e));return Y.rectangle(e.x.baseVal.value,e.y.baseVal.value,e.width.baseVal.value,e.height.baseVal.value,e.rx.baseVal.value,e.ry.baseVal.value)}},{key:"element",value:function(t){if(t instanceof SVGElement==!1)throw new TypeError("Expected SVGElement, but found ".concat(t));var n=t.tagName;switch(n){case"circle":return e.circle(t);case"ellipse":return e.ellipse(t);case"line":return e.line(t);case"path":return e.path(t);case"polygon":return e.polygon(t);case"polyline":return e.polyline(t);case"rect":return e.rect(t);default:throw new TypeError("Unrecognized element type: '".concat(n,"'"))}}}]),e}(),$={pointInCircle:function(e,t,n){return u.fromPoints(t,e).length()<=n},pointInEllipse:function(e,t,n,r){var a=e.subtract(t);return a.x*a.x/(n*n)+a.y*a.y/(r*r)<=1},pointInPolyline:function(e,t){for(var n,r=t.length,a=0,i=t[0],s=1;s<=r;s++){var o=t[s%r],u=Math.min(i.y,o.y),l=Math.max(i.y,o.y),c=Math.max(i.x,o.x);i.y!==o.y&&u<e.y&&e.y<=l&&e.x<=c&&(n=(e.y-i.y)*(o.x-i.x)/(o.y-i.y)+i.x,(i.x===o.x||e.x<=n)&&a++),i=o}return a%2==1}};$.pointInPolygon=$.pointInPolyline,$.pointInRectangle=function(e,t,n){return t.x<=e.x&&e.x<n.x&&t.y<=e.y&&e.y<n.y},e.AffineShapes=C,e.Intersection=N,e.IntersectionArgs=v,e.IntersectionQuery=$,e.Matrix2D=l,e.Point2D=o,e.ShapeInfo=v,e.Shapes=Y,e.SvgShapes=X,e.Vector2D=u,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=index-umd.min.js.map
